<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- **************************************************************		-->
<!-- 1. 프로그램 id   : p_attend_annual_1h.html                       	-->
<!-- 2. 유형(시나리오):  조회및 입력												-->
<!-- 3. 기 능 정 의   :  연차초기화                       					-->
<!-- 4. 변 경 이 력   :  권미생 작성												-->
<!-- 5. 관련프로그램  :																	-->
<!-- 6. 특 기 사 항   :																	-->
<!-- *************************************************************		-->
<HTML>
<LINK rel="stylesheet" type="text/css" href="/werp/erpw.css">
<HEAD>
<META http-equiv=Content-Type content="text/html; charset=ks_c_5601-1987">
<META content="MSHTML 6.00.2716.2200" name=GENERATOR>
<SCRIPT SRC="../../../comm_function/comm_calendar.js"></SCRIPT> 
<SCRIPT SRC="../../../comm_function/comm_function.js"></SCRIPT> 
<SCRIPT language=JavaScript>

var gs_home = parent.frames['security'].gs_home.value

var is_work_date 
var is_work_year
var is_sort      = " "
var is_ds_1_addr = gs_home + '/general/p_web/06/p_attend_annual_1q.jsp?arg_work_year='          //조회용 &arg_bb=
var is_ds_2_addr = gs_home + '/general/p_web/06/p_pers_master_1q.jsp?arg_work_date='          //조회용 &arg_bb=
var is_tr_1_addr = gs_home + '/general/p_web/06/p_attend_annual_1tr.jsp'                                //수정용 
var is_focus_enter='N'
var is_success_tag='Y'	// 집계시 오류나면 'N'
//------------------------------------------------------------------------
function btnquery_onclick()                     // 조회  
//------------------------------------------------------------------------
{
	ds_1.DataID = is_ds_1_addr + is_work_year              // jsp와 아규먼트값셋팅 
	ds_1.SyncLoad=true
	ds_1.Reset()
	
	div_btnquery_onclick()
}
//------------------------------------------------------------------------
function div_btnquery_onclick()                     // 내부조회  
//------------------------------------------------------------------------
{
	var is_date
	var is_year
	
	is_aa = is_work_year.substr(0,4)
	is_year = parseInt(is_aa,10) - 1
	is_work_date = is_year + '.12.01'

	ds_2.DataID = is_ds_2_addr + is_work_date              // jsp와 아규먼트값셋팅 
	ds_2.SyncLoad=true
	ds_2.Reset()
}
//-----------------------------------------------------------------------
function Fn_SetColumn()   // 커서위치 세팅
//-----------------------------------------------------------------------
{
    gd_1.Focus();
    gd_1.SetColumn("annual_day");
}
//-----------------------------------------------------------------------
function init_move()               // 초기값세팅
//-----------------------------------------------------------------------
{
    
    ds_1.NameValue(ds_1.RowPosition,"work_year") = is_work_year
    bt_emp_no()
    Fn_SetColumn()
 }   
//-----------------------------------------------------------------------
function btnadd_onclick()                       // 추가 
//------------------------------------------------------------------------
{
	 	ds_1.AddRow()

 	init_move()
}
//-----------------------------------------------------------------------
function btninsert_onclick()                    // 삽입
//-----------------------------------------------------------------------
{

		if (ds_1.RowPosition == 0){     //한건도 없을경우는  0 
		  btnadd_onclick()
		  return
		}  
		ds_1.InsertRow(ds_1.RowPosition)

	 init_move()

}
//------------------------------------------------------------------------
function btndelete_onclick()                    // 삭제 
//------------------------------------------------------------------------
{
		   if (gd_1.MultiRowSelect){               // multi row select 일 경우
			   for (i=ds_1.CountRow ;i > 0 ;i--) {
			       if (ds_1.RowMark(i) == 1)
			       	  ds_1.DeleteRow(i)
			   }   
			   ds_1.MarkRows(ds_1.RowPosition,ds_1.RowPosition)  //삭제작업완료후 MARK
		   }
   		   else{ 
			   ds_1.DeleteRow(ds_1.RowPosition)
		   }
}
//---------------------------------------------------------------------------
function bt_emp_no()                     //사원 찾기
//---------------------------------------------------------------------------
{

	var result;
	var send_arg;
	var array = new Array();
	is_comp_code = ""
	is_emp_no    = ""
	send_arg = is_comp_code + '@' + ds_1.NameValue(ds_1.RowPosition,"emp_name")
	result = window.showModalDialog(gs_home + "/general/p_web/99/p_emp_no_attend_find_1h.html",send_arg,"dialogWidth:700px;dialogHeight:500px");

	if(result == "") return;
	array = result.split("@");

 	ds_1.NameValue(ds_1.RowPosition,"emp_no") 			= array[0]
 	ds_1.NameValue(ds_1.RowPosition,"emp_name") 			= array[1]
 	ds_1.NameValue(ds_1.RowPosition,"dept_code") 		= array[2]
 	ds_1.NameValue(ds_1.RowPosition,"grade_code") 		= array[3]
 	ds_1.NameValue(ds_1.RowPosition,"group_join_date") = array[7]
 	ds_1.NameValue(ds_1.RowPosition,"join_date") 		= array[8]
 	ds_1.NameValue(ds_1.RowPosition,"resident_no") 		= array[10]
}
//-------------------------------------------------------------------------------
function annual_reset()                  //연차초기화 
//--------------------------------------------------------------------------------
{
	//if  (ds_1.CountRow > 0 ) {
		//if (confirm("내역이 이미 존재합니다: 재집계 하시겠습니까?")){
		//		arg_cmd = " delete from p_attend_annual " +
		//					 " where work_year  = '" + is_work_year + "' " 
		//		f_update_sql(arg_cmd) 						  
		//		
		//	}
		//	else{
		//		return
		//	}		
	//}			
	
	var ls_msg
   if (ds_1.CountRow > 0 )
		ls_msg = "내역이 이미 존재합니다: 재집계 하시겠습니까?"
	else
		ls_msg = "자료를 집계하시겠습니까?"

	if (confirm(ls_msg)) {
		ds_spcall.DataID = 'sp_p_attend_annual.jsp?arg_work_year=' + is_work_year
		ds_spcall.SyncLoad = true
		ds_spcall.reset()
		
		if (is_success_tag == 'Y')
			alert("정상처리되었습니다...")
		
		btnquery_onclick() 
   }
}
//---------------------------------------------------------------------------
function btnsave_onclick()                       // 저장
//---------------------------------------------------------------------------
{
		  if (ds_1.IsUpdated){
			 var ll_dup
			 ll_dup = f_dup_chk("ds_1","work_year@resident_no")
			 if (ll_dup > 0) {
			     alert("사원이 중복되었습니다: 수정하십시요 ")
			     ds_1.RowPosition = ll_dup
			     return
			 }
			 else{
		    if  (confirm("변경되었습니다 저장하시겠습니까?"))
		    	
		        tr_1.Post()
		    }
		  }
	
}
//----------------------------------------------------------------------------
function btncancel_onclick()                     // 취소
//---------------------------------------------------------------------------- 
{
     ds_1.Undo(ds_1.RowPosition)
}
//----------------------------------------------------------------------------
function btnexit_onclick(ls_arg)                 // 종료 
//-----------------------------------------------------------------------------
{
	  if (ds_1.IsUpdated){
		btnsave_onclick() 
	  }

}
//-------------------------------------------------------------------------------
function select_yymm()                  // 년월 선택 
//--------------------------------------------------------------------------------
{
   is_work_year = em_work_year.text.substr(0,4) + ".01.01"
   btnquery_onclick()

}   
//------------------------------------------------------------------------------
function gd_1_bt_excel()               //엑셀  붙여넣기
//------------------------------------------------------------------------------
{
   // 엑셀자료를 복사한후 GRID에 붙여넣기 하였을경우에 엑셀의 자료를 GRID에 복사및 추가 한다
   // arg_ds      : dataset명칭            예) 'ds_1'
   // arg_gd      : 그리드 명칭            예) 'gd_1'
   // arg_row     : current row            예)  ds_1.RowPosition
   // arg_tot_row : 총 건수                예)  ds_1.CountRow
   // arg_col_type: 컬럼 id와 정보(배열명) 예)  'name','S','cnt_qty','N'      type: S는 스트링   N: NUMERIC 필드 H:는 옮기지않음
   // arg_auto_insert: 복사할 row가 많으면 자동 addrow         예) 'Y': 자동 ADDROW   'N': ADDROW하지않음  
  
  var arg_auto_insert = 'N'   //자동 삽입 
  var ls_col_type = new Array() 
  
  ls_col_type = ['annual_day','N']
  
  ll_a = gf_excel_copy_row_col('ds_1','gd_1',ds_1.RowPosition,ds_1.CountRow,ls_col_type,arg_auto_insert)     
  if (ll_a == 'err') { 
     alert('화면의 시작 셀을 정확히 클릭하십시요')
     return
  }
}
//---------------------------------------------------------------------------
function window_onload()                      // window open event
//---------------------------------------------------------------------------
{
  if (f_reject_window()) return 
   top.frames['main_title'].mouse_over()

	is_work_date = f_sysdate()
	is_work_year = is_work_date.substr(0,4) + ".01.01"
	em_work_year.text = is_work_year
	 
	ll_cnt = f_ds_select_q("ds_select1","select dept_code select_1, long_name select_2 from z_code_dept order by dept_code") //부서
	ll_cnt = f_ds_select_q("ds_select2","select grade_code select_1, grade_name select_2 from p_code_grade order by grade_code")	//직위
	tr_1.Action = is_tr_1_addr                   // jsp update용 

	btnquery_onclick()

}
</SCRIPT>
<script language=JavaScript for=gd_1 event=onClick(row,colid)>
  if (row == 0) {
  		if (is_sort == "+" + colid)
   	  ds_1.SortExpr = "-" + colid;
  	   else
   	  ds_1.SortExpr = "+" + colid;
   	  
  	  is_sort = ds_1.SortExpr;
  	  ds_1.Sort();
  }   
</script>
<script language=JavaScript for=ds_1 event=OnRowPosChanged(row)>
	//조회된 로우의 자료는 수정불가
	if (ds_1.NameValue(row, "ret_tag") == 'Y')
		gd_1.ColumnProp('emp_name','Edit')='None'
	else
		gd_1.ColumnProp('emp_name','Edit')=''
</script>

<SCRIPT language="javascript" for=gd_1 event=OnPopup(row,colid,data)>
	 if (colid == "emp_name") {
	    bt_emp_no()
	    return
	 }    
</SCRIPT>
<script language=JavaScript for=gd_1 event=OnKeyPress(kcode)>
if (kcode == 13) {
    if (ds_1.RowPosition == ds_1.CountRow)  
        btnadd_onclick()
    else     
        ds_1.RowPosition++
}
</script>
</HEAD>

<BODY style="FONT-SIZE: 12px"  onload=window_onload() oncontextmenu="return false" >

<SCRIPT language=JavaScript for=ds_1 event=OnLoadError()>
  alert("Error Code ds_1: " + ds_1.ErrorCode + "\n" + "Error Message : " + ds_1.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_2 event=OnLoadError()>
  alert("Error Code ds_1: " + ds_1.ErrorCode + "\n" + "Error Message : " + ds_1.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_1 event=OnFail()>
  alert("Error Code : " + tr_1.ErrorCode + "\n" + "Error Message : " + tr_1.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_update event=OnLoadError()>
  alert("Error Code(ds_update) : " + ds_update.ErrorCode + "\n" + "Error Message : " + ds_update.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_spcall event=OnLoadError()>
  alert("Error Code ds_spcall: " + ds_spcall.ErrorCode + "\n" + "Error Message : " + ds_spcall.ErrorMsg + "\n");
  is_success_tag = 'N'
</SCRIPT>

<SCRIPT language=JavaScript for=em_work_year event=onKillFocus()>
   if (is_focus_enter == em_work_year.text) {   // on killfocus에서 enter를 치면 on kill focus가 발생하므로 2번 읽지않기위해서
		return
	}   
   else { 
	   is_focus_enter = em_work_year.text
		select_yymm()
	}
</SCRIPT>        	
<SCRIPT language=JavaScript for=em_work_year event=onKeyDown(kcode,scode)>
	if (kcode == 13 ){ 
	   is_focus_enter=em_work_year.text
		select_yymm()
	}
</SCRIPT>   

<OBJECT id=ds_sysdate 
    style="Z-INDEX: 101; LEFT: 300px; POSITION: absolute; parent: 20px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
	<PARAM NAME="DataID" VALUE="">
</OBJECT>	
<OBJECT id=ds_spcall 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49>
</OBJECT>
<OBJECT id=ds_select1 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49>
</OBJECT>
<OBJECT id=ds_select2 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49>
</OBJECT>
<OBJECT id=ds_select3 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49>
</OBJECT>
<OBJECT id=ds_select4 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49>
</OBJECT>
<OBJECT id=ds_update 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49>
</OBJECT>
<OBJECT id=ds_1 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49>
</OBJECT>
<OBJECT id=ds_2
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49>
</OBJECT>
<OBJECT id=tr_1 
    style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
    classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:p_attend_annual_1tr=ds_1)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT>
	
<DIV id=hdept_page_1
         style="Z-INDEX: 111; LEFT: 3px; WIDTH: 160px; POSITION: absolute; TOP: 4px; HEIGHT: 27px;FONT-SIZE: 12px" >
      <table width="100%" height="100%"  BORDER="1"  align="center"   CELLSPACING="0" style="FONT-SIZE: 12px">
         <tr BGCOLOR="white" >
             <td width="37%" BGCOLOR="#BBE0F4" style="COLOR: BLACK"> 
	       <div align="right">지급년도</div></td>
	  	<td width="63%" >
	       <OBJECT id=em_work_year style="WIDTH: 80px " 
		 classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
		     <PARAM NAME="Alignment" VALUE="1">
		     <PARAM NAME="IsComma" VALUE="0">
		     <PARAM NAME="MaxLength" VALUE="4">
		     <PARAM NAME="Format" VALUE="YYYY">
	        <param name=ClipMode       value=false>
		     <PARAM NAME="Numeric" VALUE="0">
		     <PARAM NAME="SelectAll" VALUE="-1">
		</OBJECT>
		<img src="../../../image/icon/calender_on.gif"  id=img_fr OnClick="var result = gn_Cal_Yyyymmdd(); 
				if(!is_null(result)){ em_work_year.text = result.substr(0,8);} ; select_yymm()" 
				style=" WIDTH: 20px; POSITION: absolute; TOP: 4px; HEIGHT:20px"></td>
         </tr>                 
      </table>
</DIV>      

<DIV id=gd_1_button 
style="Z-INDEX: 107; LEFT: 750px; WIDTH: 300px; POSITION: absolute; TOP: 7px; HEIGHT: 20px">

<input id=bt_prev_copy type="button" value="연차초기화" 
			style="filter='progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr=#C7E2E2, EndColorStr=#FFFFFF)';
			 font-size: 10pt; border:1 solid #000000; CURSOR: hand; border:1 #A1A9A9 solid;
          onmouseover="this.style.backgroundColor='#C0E8DB'; this.style.color='#EF315E'" 
          onmouseout="this.style.backgroundColor='#E9F5F5'; this.style.color='#0E4433'
          "  onclick=annual_reset()>
<input id=bt_excel_copy type="button" value="엑셀붙여넣기" 
			style="filter='progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr=#C7E2E2, EndColorStr=#FFFFFF)';
			 font-size: 10pt; border:1 solid #000000; CURSOR: hand; border:1 #A1A9A9 solid; 
          onmouseover="this.style.backgroundColor='#C0E8DB'; this.style.color='#EF315E'" 
          onmouseout="this.style.backgroundColor='#E9F5F5'; this.style.color='#0E4433'
          "  onclick=gd_1_bt_excel()>			
</DIV>

  <OBJECT id=gd_1 
      style="POSITION: absolute; LEFT: 3px; TOP: 35px; WIDTH: 1005px; HEIGHT: 99%; Z-INDEX: 102;FONT-SIZE: 12px " 
      classid=clsid:1F57AEAD-DB12-11D2-A4F9-00608CEBEE49>
  	<PARAM NAME="MultiRowSelect" VALUE="-1">
  	<PARAM NAME="AutoInsert" VALUE="-1">
  	<PARAM NAME="AllShowEdit" VALUE="-1">
  	<PARAM NAME="Editable" VALUE="-1">
  	<PARAM NAME="ColSizing" VALUE="-1">
  	<param name="ViewSummary"    value=1>
  	<param name=SortView value="Right">
  	<PARAM NAME="DataID" VALUE="ds_1">
  	<PARAM NAME="Format" VALUE="
       <C> Name='성명'  	id=emp_name Editstyle=Popup 	width=100 sort=true  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK 
       		SumText='인원수'  SumColor=Black SumBgColor=Pink </C>
       <C> Name='부서명'  	id=dept_code 	edit=none EditStyle=Lookup Data='ds_select1:select_1:select_2'	width=250  sort=true  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')} HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK 
       		SumText=@count  SumColor=Black SumBgColor=Pink </C>
       <C> Name='직위'  	id=grade_code  edit=none EditStyle=Lookup Data='ds_select2:select_1:select_2'	width=100  sort=true  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')} HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK 
       		SumText=''  SumColor=Black SumBgColor=Pink </C>
       <C> Name='그룹입사일'  	id=group_join_date edit=none align=center	  width=100  sort=true  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK 
       		SumText=''  SumColor=Black SumBgColor=Pink </C>
       <C> Name='입사일'  	id=join_date  edit=none align=center width=100  sort=true  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK 
       		SumText=''  SumColor=Black SumBgColor=Pink </C>
       <C> Name='연차일수'  	id=annual_day  width=80 align=center  sort=true  BgColor='#FFFFC8'  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK 
       		SumText=@sum  SumColor=Black SumBgColor=Pink </C>
       ">
  </OBJECT>
</BODY></HTML>