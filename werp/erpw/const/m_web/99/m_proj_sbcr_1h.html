<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- **************************************************************	-->
<!-- 1. 프로그램 id   : m_proj_sbcr_1h.html 								   -->
<!-- 2. 유형(시나리오): 조회및 입력												-->
<!-- 3. 기 능 정 의   : 현장구매업체 등록		  	  							-->
<!-- 4. 변 경 이 력   : 김동우 작성												-->
<!-- 5. 관련프로그램  :																-->
<!-- 6. 특 기 사 항   :																-->
<!-- *************************************************************	-->
<HTML><HEAD>
<META http-equiv=Content-Type content="text/html; charset=ks_c_5601-1987">
<META content="MSHTML 6.00.2716.2200" name=GENERATOR>
<LINK rel="stylesheet" type="text/css" href="../../../erpw.css">
<SCRIPT SRC="../../../comm_function/comm_function.js"></SCRIPT> 


<SCRIPT SRC="../../../comm_function/comm_wid.js"></SCRIPT>

<SCRIPT SRC="../../../comm_function/comm_wid.js"></SCRIPT>
<SCRIPT language=JavaScript>

var gs_home = top.frames['security'].gs_home.value
var is_ds_1_addr = gs_home + '/const/m_web/99/m_proj_sbcr_1q.jsp?arg_sbcr_name='
var is_tr_1_addr = gs_home + '/const/m_web/99/m_proj_sbcr_1tr.jsp'
var is_sbcr_name=''
//------------------------------------------------------------------------
function btnquery_onclick()                     // 조회  
//------------------------------------------------------------------------
{
	ds_1.DataID = is_ds_1_addr + is_sbcr_name
	ds_1.SyncLoad=true
	ds_1.Reset()
}
//-----------------------------------------------------------------------
function btnadd_onclick()                       // 추가 
//------------------------------------------------------------------------
{
	var bsi_num = "",ll_cnt
	bsi_num = getBusiNum()
	if (bsi_num == null) return;
	bsi_num = bsi_num.replace(/[ ]/gi,"")
	if (bsi_num == "") return;
	ll_cnt = f_select2_q("select nvl(count(*),0) select_1 from s_sbcr where businessman_number = rtrim('" + bsi_num + "')")
	if (ds_select2.ErrorCode != 0) {
		alert("에러발생");return;
	}
	if (ds_select2.NameValue(ds_select2.RowPosition,'select_1') > 0) {
		alert("기존에 동일한 사업자 번호가 존재합니다.");
		return;
	}
	ds_1.AddRow()
	sbcr_code(bsi_num)
}
//-----------------------------------------------------------------------
function btninsert_onclick()                    // 삽입
//-----------------------------------------------------------------------
{
	var bsi_num = "",ll_cnt
	bsi_num = getBusiNum()
	if (bsi_num == null) return;
	bsi_num = bsi_num.replace(/[ ]/gi,"")
	if (bsi_num == "") return;
	ll_cnt = f_select2_q("select nvl(count(*),0) select_1 from s_sbcr where businessman_number = rtrim('" + bsi_num + "')")
	if (ds_select2.ErrorCode != 0) {
		alert("에러발생");return;
	}
	if (ds_select2.NameValue(ds_select2.RowPosition,'select_1') > 0) {
		alert("기존에 동일한 사업자 번호가 존재합니다.");
		return;
	}
	ds_1.InsertRow(ds_1.RowPosition)
	sbcr_code(bsi_num)
}
//-----------------------------------------------------------------------
function sbcr_code(bsi_num)                    // 업체코드구하기
//-----------------------------------------------------------------------
{
	var ll_cnt,ll_seq,ls_sbcr_code
	
	ll_cnt = f_select2_q("select substrb(max(sbcr_code),2,length(max(sbcr_code)))! 1 select_1 from s_sbcr where sbcr_class = '2'")
	if (ds_select2.ErrorCode != 0) {
		alert("에러발생");return;
	}
	if (ll_cnt > 0) {
		ll_seq = parseInt(ds_select2.NameValue(ds_select2.RowPosition,'select_1'))
		if ( ll_seq < 10) {
			ls_sbcr_code = 'M0000' + ll_seq;
		}
		else {
			if (ll_seq < 100) {
				ls_sbcr_code = 'M000' + ll_seq;
			}
			else {
				if (ll_seq < 1000) {
					ls_sbcr_code = 'M00' + ll_seq;
				}
				else {
					if (ll_seq < 10000) {
						ls_sbcr_code = 'M0' + ll_seq;
					}
					else {
						ls_sbcr_code = 'M' + ll_seq;
					}
				}
			}
		}
	}
	else {
		ls_sbcr_code = 'M00001'
	}
	ds_1.NameValue(ds_1.RowPosition,'sbcr_code') = ls_sbcr_code
	ds_1.NameValue(ds_1.RowPosition,'businessman_number') = bsi_num
	ds_1.NameValue(ds_1.RowPosition,'sbcr_class') = '2'
	ds_1.NameValue(ds_1.RowPosition,'bill_dis_pay') = 'Y'
	ds_1.NameValue(ds_1.RowPosition,'chg_degree') = 0
	tr_1.Post()
	gd_1.SetColumn("sbcr_name");
}
//------------------------------------------------------------------------
function btndelete_onclick()                    // 삭제 
//------------------------------------------------------------------------
{
	if (top.frames['security'].user_id.value != "kilee" && top.frames['security'].user_id.value != "seosw") {
		alert("전산실에 문의 하세요");return;
	}
	var ll_cnt,ls_sbcr_code
	ls_sbcr_code = ds_1.NameValue(ds_1.RowPosition,'sbcr_code')
	ll_cnt = f_select2_q("select nvl(count(*),0) select_1 from m_input where sbcr_code = '" + ls_sbcr_code + "'")
	if (ds_select2.ErrorCode != 0) {
		alert("에러발생");return;
	}
	if ( ll_cnt > 0 ) {
		ll_chk = ds_select2.NameValue(ds_select2.RowPosition,'select_1')
		if (ll_chk > 0) {
			alert('자재에서 투입된 자료가 존재함으로 삭제하실 수 없습니다...')
			return
		}
	}
	ds_1.DeleteRow(ds_1.RowPosition)  
 }
//---------------------------------------------------------------------------
function btnsave_onclick()                       // 저장
//---------------------------------------------------------------------------
{
	// DUP CHECK
	if (ds_1.IsUpdated){
		var ll_dup
		ll_dup = f_dup_chk("ds_1","businessman_number")
		if (ll_dup > 0) {
			alert("사업자번호 중복되었습니다: 수정하십시요 ")
			ds_1.RowPosition = ll_dup
			gd_1.SetColumn("businessman_number");
			return
		}
	}
	if (ds_1.IsUpdated){
		if  (confirm("변경되었습니다 저장하시겠습니까?"))
		tr_1.Post()
	} 
}
//----------------------------------------------------------------------------
function btncancel_onclick()                     // 취소
//---------------------------------------------------------------------------- 
{
	ds_1.Undo(ds_1.RowPosition)
}
//----------------------------------------------------------------------------
function btnexit_onclick(ls_arg)                 // 종료 
//-----------------------------------------------------------------------------

{
	if (ds_1.IsUpdated) {
	   if  (confirm("변경되었습니다 저장하시겠습니까?")) 
	       {  //저장 routine
	       }   
 
}     
top.frames['main_ct'].location.href(ls_arg)
top.frames['main_title'].div_r.style.visibility="hidden"             
top.frames['main_title'].div_u.style.visibility="hidden"             

// top.frames['main_ct'].window.close()     
}
//--------------------------------------------------------------------------
function   sbcr_search()
//----------------------------------------------------------------
{
	if (tx_sbcr_search_name.value == '') {
		is_sbcr_name = ''
	}
	else {
		is_sbcr_name = tx_sbcr_search_name.value
	}
	btnquery_onclick()
}

//---------------------------------------------------------------------------
function window_onload()                      // window open event
//---------------------------------------------------------------------------
{
   if (f_reject_window()) return 
   top.frames['main_title'].mouse_over()
	ds_1.DataID=is_ds_1_addr
	ds_1.SyncLoad=true
	ds_1.reset()
	tr_1.Action = is_tr_1_addr 
}
</SCRIPT>

<script language="javascript" for=gd_1 event=OnPopup(row,colid,data)>
	var result,ls_temp
	var array = new Array();

	if  (colid == "zip_number1") {                                //우편번호 찾기 
		ls_temp = ''
		result = window.showModalDialog(gs_home + "/comm_search/z_zip_find_1h.html", ls_temp,"dialogWidth:640px;dialogHeight:500px");
		if(result == "") return;
	
		array = result.split("@");
		ds_1.NameValue(row,'zip_number1') = array[0]
		ds_1.NameValue(row,'address1')    = array[1]
	}
</SCRIPT>

</HEAD>
<SCRIPT language=JavaScript for=ds_1 event=OnLoadError()>
  alert("Error Code : " + ds_1.ErrorCode + "\n" + "Error Message : " + ds_1.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_select2 event=OnLoadError()>
  alert("Error Code(ds_select2) : " + ds_select2.ErrorCode + "\n" + "Error Message : " + ds_select2.ErrorMsg + "\n");
</SCRIPT>

<SCRIPT language=JavaScript for=tr_1 event=OnFail()>
  alert("Error Code : " + tr_1.ErrorCode + "\n" + "Error Message : " + tr_1.ErrorMsg + "\n");
</SCRIPT>

<BODY style="FONT-SIZE: 12px" onload=setTimeout('window_onload()',1) oncontextmenu="return false" >
<comment id="__NSID__"><OBJECT id=ds_1 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49></OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><Object id=ds_select2
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 10px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49> </OBJECT></comment> <script> __ws__(__NSID__);</script>      
<comment id="__NSID__"><OBJECT id=tr_1 
    classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
   <PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:m_proj_sbcr_1tr=ds_1)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>	
<DIV id=gd_1_button 
	style="Z-INDEX: 107; LEFT: 4px; WIDTH: 304px; POSITION: absolute; TOP: 3px; HEIGHT: 30px">
      <table width="100%" height="100%"  BORDER="1"  align="center"   CELLSPACING="0" style="FONT-SIZE: 12px">
         <tr BGCOLOR="white" > 
				<td width="30%"   BGCOLOR="#53A9FF" style="COLOR: WHITE " colspan=6 > 
					<div align="right">업체명검색</div></td>
				<td width="70%" colspan=14> 
			  	<INPUT id=tx_sbcr_search_name   size=20 onchange="sbcr_search()"  >
			  	<INPUT id=bt_sbcr_name  type=button   value=검색 onclick=sbcr_search()>
				</td>
         </tr>                 
      </table>
</DIV>

<comment id="__NSID__"><OBJECT id=gd_1 
    style="POSITION: absolute; LEFT: 2px;TOP: 40px;  WIDTH: 1010px; HEIGHT: 95%; Z-INDEX: 102;FONT-SIZE: 12px " 
    classid=clsid:1F57AEAD-DB12-11D2-A4F9-00608CEBEE49>
	<PARAM NAME="MultiRowSelect" VALUE="0">
	<PARAM NAME="AutoInsert" VALUE="-1">
	<PARAM NAME="AllShowEdit" VALUE="-1">
	<PARAM NAME="BorderStyle" VALUE="4">
	<PARAM NAME="Editable" VALUE="-1">
	<PARAM NAME="ColSizing" VALUE="-1">
	<PARAM NAME="DataID" VALUE="ds_1">
	<PARAM NAME="Format" VALUE="
     <C> Name='업체명'  id=sbcr_name  width=150  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
     <C> Name='사업자번호' Edit=none id=businessman_number  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
     <C> Name='대표자'  id=rep_name1  width=60 BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Align=Center </C>
     <C> Name='우편번호'  id=zip_number1 EditStyle=Popup width=60 BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  </C>
     <C> Name='주소'  id=address1  width=250 BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  </C>
     <C> Name='전화번호'  id=tel_number1  width=100 BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  </C>
     <C> Name='팩스번호'  id=fax_number  width=100 BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  </C>
     <C> Name='업태'  id=kind_bussinesstype  width=100 BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  </C>
     <C> Name='업종'  id=kinditem  width=100 BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  </C>
     <C> Name='담당자'  id=chrg_name1  width=60 BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Align=Center </C>
     <C> Name='담당자H.P'  id=chrg_hp  width=100 BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  </C>
     ">
</OBJECT></comment> <script> __ws__(__NSID__);</script>
</DIV>
</BODY>

<SCRIPT language=VBScript>
Function getBusiNum()
	getBusiNum = inputBox("사업자번호를 입력하세요")
End Function
</SCRIPT>

</HTML>
