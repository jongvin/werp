<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- **************************************************************		-->
<!-- 1. 프로그램 id   : m_request_1h.html					-->
<!-- 2. 유형(시나리오): 조회및 입력						-->
<!-- 3. 기 능 정 의   : 자재청구내역입력  		                      	-->
<!-- 4. 변 경 이 력   : 김동우 작성						-->
<!-- 5. 관련프로그램  :								-->
<!-- 6. 특 기 사 항   :								-->
<!-- *************************************************************		-->
<HTML><HEAD>
<META http-equiv=Content-Type content="text/html; charset=ks_c_5601-1987">
<META content="MSHTML 6.00.2716.2200" name=GENERATOR>
<LINK rel="stylesheet" type="text/css" href="../../../erpw.css">
<SCRIPT SRC="../../../comm_function/comm_function.js"></SCRIPT> 
<SCRIPT SRC="../../../comm_function/comm_calendar.js"></SCRIPT> 


<SCRIPT SRC="../../../comm_function/comm_wid.js"></SCRIPT>

<SCRIPT SRC="../../../comm_function/comm_wid.js"></SCRIPT>
<SCRIPT language=JavaScript>
// <LINK rel="stylesheet" type="text/css" href="../../../comm_function/env.css">
var gs_home = top.frames['security'].gs_home.value
var is_dept_code = top.frames['security'].gs_dept_code.value
var is_dept_name = top.frames['security'].gs_dept_name.value
var is_work_date = top.frames['security'].gs_sysdate.value
var il_screen = 1, il_save = 0
var is_filter='tot',ls_seq

var is_ds_1_addr = 'm_request_1q.jsp?arg_dept_code='                        //청구 목록 
var is_ds_2_addr = 'm_request_detail_1q.jsp?arg_dept_code='                     //청구내역
var is_ds_3_addr = 'm_mat_request_work_1q.jsp?arg_dept_code='                     //작업조회
var is_tr_1_addr = gs_home + '/const/m_web/01/m_request_1tr.jsp'
var is_tr_2_addr = gs_home + '/const/m_web/01/m_request_detail_1tr.jsp'
var is_ds_seq_addr = gs_home + '/const/m_web/00/m_spec_unq_no_1q.jsp'                 // seq_no구하기 
</SCRIPT>
<!-- ======================================================================= -->
<!--                                 Function                                -->
<!-- ======================================================================= -->
<SCRIPT language=JavaScript>
//------------------------------------------------------------------------
function btnquery_onclick()                     // 조회  
//------------------------------------------------------------------------
{
	if (il_screen > 1){
		div_btnquery_onclick()
		return
	}   
	ds_1.DataID = is_ds_1_addr + is_dept_code
	ds_1.SyncLoad=true
	ds_1.Reset()
	div_btnquery_onclick()

}
//-----------------------------------------------------------------------
function Fn_SetColumn()   // 커서위치 세팅
//-----------------------------------------------------------------------
{
	gd_1.Focus();
	gd_1.SetColumn("approtitle");
}
//-----------------------------------------------------------------------
function init_seq()                       // 청구번호 구하기
//------------------------------------------------------------------------
{
	var ls_filter,ll_seq
	if ( is_filter == "tot" ) {
		if  (ds_1.CountRow > 0) {
			ll_seq = ds_1.Max(2,0,0)
			ls_seq = ll_seq + 1
		}
		else {
			ls_seq = 1
		}
	}
	else {
		ls_filter = is_filter 
		is_filter = "tot"
		gd_1.ReDraw = false
		ds_1.Filter()

		if  (ds_1.CountRow > 0) {
			ll_seq = ds_1.Max(2,0,0)
			ls_seq = ll_seq + 1
		}
		else {
			ls_seq = 1
		}
		is_filter = ls_filter
		ds_1.Filter()
		gd_1.ReDraw = true
	}
}
//-----------------------------------------------------------------------
function init_move()                       // 초기값 세팅 
//------------------------------------------------------------------------
{
	init_seq()

	ds_1.NameValue(ds_1.RowPosition,"dept_code") = is_dept_code
	ds_1.NameValue(ds_1.RowPosition,"requestseq") = ls_seq
	ds_1.NameValue(ds_1.RowPosition,"chg_cnt") = 1
	ds_1.NameValue(ds_1.RowPosition,"approve_class") = '1'
	ds_1.NameValue(ds_1.RowPosition,"order_class") = '1'

	gd_1.Editable="true"
	gd_2.Editable="true"

	Fn_SetColumn()
}

//-----------------------------------------------------------------------
function btnadd_onclick()                       // 추가 
//------------------------------------------------------------------------
{
	if  (is_dept_code == "") {
		alert("현장을 선택하십시요(검색을 누르십시요)")
		return
	}
	if (il_screen > 1) {
		div_btnadd_onclick()
		return
	}
	btninsert_onclick()
}
//-----------------------------------------------------------------------
function btninsert_onclick()                    // 삽입
//-----------------------------------------------------------------------
{
	if (is_dept_code == "") {
		alert("현장을 선택하십시요(검색을 누르십시요)")
		return
	}
	if (bt_1.checked) {
		alert("청구 자료에서는 입력할수 없습니다")
		return
	}
	if (il_screen > 1) {
		div_btninsert_onclick()
	return
	}
	if (ds_1.CountRow > 0) {
		ds_1.RowPosition=1
		if (ds_1.SysStatus(ds_1.RowPosition) != 0) {
			alert('저장부터 하시고 추가하십시오...')
			return
		}
		ds_1.InsertRow(ds_1.RowPosition)
	} else {
		ds_1.AddRow()
	}
	init_move()
}
//------------------------------------------------------------------------
function btndelete_onclick()                    // 삭제 
//------------------------------------------------------------------------
{
	var arg_cmd,ll_requestseq,ll_chg_cnt
	if (il_screen > 1) {
		div_btndelete_onclick()
		return
	}
	if (ds_1.NameValue(ds_1.RowPosition,"requestdate") != '' || ds_1.NameValue(ds_1.RowPosition,"approve_class") != '1') return

	if (ds_2.CountRow > 0 ) {
		if  (confirm("하위에 자료도 모두 삭제됩니다 계속하시겠습니까?")){
			ll_requestseq = ds_1.NameValue(ds_1.RowPosition,'requestseq')
			ll_chg_cnt = ds_1.NameValue(ds_1.RowPosition,'chg_cnt')
		  	arg_cmd = " delete from m_request_detail " +
		      		  "  WHERE DEPT_CODE = " + "'" + is_dept_code + "'" +
		      		  "    AND requestseq = " + ll_requestseq + 
		      		  "    AND chg_cnt = " + ll_chg_cnt
			f_update_sql(arg_cmd)
		}
		else {
			return
		}
  	}
  	ds_1.DeleteRow(ds_1.RowPosition)
 	tr_1.Action = is_tr_1_addr
	tr_1.Post()
	ds_2.ClearData()	
	div_btnquery_onclick()
 }
//---------------------------------------------------------------------------
function btnsave_onclick()                       // 저장
//---------------------------------------------------------------------------
{
	il_save = 1
	if (il_screen > 1) {
		div_btnsave_onclick()
		div_btnquery_onclick()
		il_save = 0
		return
	}
	if (ds_1.IsUpdated){
		if  (confirm("변경되었습니다 저장하시겠습니까?"))
		tr_1.Post()
		il_save = 0
	}
}
//----------------------------------------------------------------------------
function btncancel_onclick()                     // 취소
//---------------------------------------------------------------------------- 
{
	if (il_screen > 1) {
		div_btncancel_onclick()
		return
	}   
	ds_1.Undo(ds_1.RowPosition)
}
//-----------------------------------------------------------------------
function div_Fn_SetColumn()   // 커서위치 세팅
//-----------------------------------------------------------------------
{
	gd_2.Focus();
	gd_2.SetColumn("requestdetailseq");
}

//----------------------------------------------------------------------
function div_init_move()                         //하위 공통 initial move
//----------------------------------------------------------------------
{
	var ls_chk
	ds_seq.SyncLoad=true;             // seq no 구하기
 	ds_seq.reset()
 
	ds_2.NameValue(ds_2.RowPosition,"dept_code") = is_dept_code
	ds_2.NameValue(ds_2.RowPosition,"requestseq") = ds_1.NameValue(ds_1.RowPosition,"requestseq")
	ds_2.NameValue(ds_2.RowPosition,"chg_cnt") = ds_1.NameValue(ds_1.RowPosition,"chg_cnt")
	ds_2.NameValue(ds_2.RowPosition,"pre_chg_cnt") = ds_1.NameValue(ds_1.RowPosition,"chg_cnt")
	ds_2.NameValue(ds_2.RowPosition,"request_unq_num") = ds_seq.NameValue(1,"nextval")
	if  (ds_2.CountRow > 1) {
		ll_seq = ds_2.Max(5,1,ds_2.CountRow)
		ds_2.NameValue(ds_2.RowPosition,"requestdetailseq") = ll_seq + 1
	}
	else {
		ds_2.NameValue(ds_2.RowPosition,"requestdetailseq") = 1
	}
	ls_chk = ds_1.NameValue(ds_1.RowPosition,"order_class")
	if (ls_chk == '1' ) {               //총액발주 시
		material_search()
	}
	else {										//단가발주 시
//		iron_rtn()
	}
	div_Fn_SetColumn()
}
//------------------------------------------------------------------------
function div_btnquery_onclick()                     // 하위 조회  
//------------------------------------------------------------------------
{
	if (ds_1.CountRow < 1) {
		ds_2.ClearData()	
		return
	}
	
	ds_2.DataID = is_ds_2_addr +  is_dept_code + "&arg_requestseq=" + ds_1.NameValue(ds_1.RowPosition,"requestseq") + 
						"&arg_chg_cnt=" + ds_1.NameValue(ds_1.RowPosition,"chg_cnt")
	ds_2.SyncLoad=true
	ds_2.Reset()
}
//-----------------------------------------------------------------------
function div_btnadd_onclick()                    //하위 추가
//-----------------------------------------------------------------------
{
	if (ds_1.NameValue(ds_1.RowPosition,"requestdate") != '' || ds_1.NameValue(ds_1.RowPosition,"approve_class") != '1') return
	if (ds_1.IsUpdated){
		if  (confirm("변경되었습니다 저장하시겠습니까?")){
			tr_1.Post()
			il_save = 0
		}
		else {
			return
		}
	}
	if (ds_1.NameValue(ds_1.RowPosition,"order_class") == '1') {
		ds_2.AddRow()
	}
	div_init_move()
}
//-----------------------------------------------------------------------
function div_btninsert_onclick()                    //하위 삽입.
//-----------------------------------------------------------------------
{
	if (ds_1.NameValue(ds_1.RowPosition,"requestdate") != '' || ds_1.NameValue(ds_1.RowPosition,"approve_class") != '1') return
	if (ds_1.IsUpdated){
		if  (confirm("변경되었습니다 저장하시겠습니까?")){
			tr_1.Post()
			il_save = 0
		}
		else {
			return
		}
	}
	if (ds_1.NameValue(ds_1.RowPosition,"order_class") == '1') {
		ds_2.InsertRow(ds_2.RowPosition)
	}
	div_init_move()
}

//------------------------------------------------------------------------
function div_btndelete_onclick()                //하위 삭제
//------------------------------------------------------------------------
{
	if (ds_1.NameValue(ds_1.RowPosition,"requestdate") != '' || ds_1.NameValue(ds_1.RowPosition,"approve_class") != '1') return
	
	if  (gd_2.MultiRowSelect){               // multi row select 일 경우
		for (i=ds_2.CountRow ;i >0 ;i--)
		{
			if (ds_2.RowMark(i) == 1){
				if (ds_1.NameValue(ds_1.RowPosition,'chg_cnt') == ds_2.NameValue(ds_2.RowPosition,'pre_chg_cnt')){
			       ds_2.DeleteRow(i)
			   }
			}
		}  
		if  (ds_2.RowPosition != 0)          {
			ds_2.MarkRows(ds_2.RowPosition,ds_2.RowPosition)  //삭제작업완료후 MARK
		}
	}
	else {
		if (ds_1.NameValue(ds_1.RowPosition,'chg_cnt') == ds_2.NameValue(ds_2.RowPosition,'pre_chg_cnt')){
			ds_2.DeleteRow(ds_2.RowPosition)
		}
		
	}
 }
//---------------------------------------------------------------------------
function div_btnsave_onclick()                  //하위 저장 
//---------------------------------------------------------------------------
{
	var ls_chk=0
	
	
	if ((ds_2.IsUpdated) || (ds_1.IsUpdated)) {
		if  (confirm("변경되었습니다 저장하시겠습니까?")){
		      if (ds_1.IsUpdated) {
					il_save = 1
		         tr_1.Post()
					il_save = 0
		      }
		   	for (i=1; i<= ds_2.CountRow; i++){
			   	if (ds_2.NameValue(i,"mtrcode") == ''){
		   			ls_chk++
	   			}
	   		}
	   		if (ls_chk == 0) {
		       		tr_2.Post()
	       		}
       			else {
		   		alert("자재코드를 반드시 입력하십시오 \n        저장되지않았습니다.")
		       	}
	       	}
	}
}
//----------------------------------------------------------------------------
function div_btncancel_onclick()                     // 취소
//---------------------------------------------------------------------------- 
{
	ds_2.Undo(ds_2.RowPosition)
}


//----------------------------------------------------------------------------
function btnexit_onclick(ls_arg)                 // 종료 
//-----------------------------------------------------------------------------
{
	if (ds_1.IsUpdated) {
		if  (confirm("변경되었습니다 저장하시겠습니까?")) 
		{  //저장 routine
		}   
	
	}     
	top.frames['main_ct'].location.href(ls_arg)
	top.frames['main_title'].div_r.style.visibility="hidden"             
	top.frames['main_title'].div_u.style.visibility="hidden"             
	
	// top.frames['main_ct'].window.close()     
}
//---------------------------------------------------------------------------
function dept_code_find()                       //현장 찾기 
//---------------------------------------------------------------------------
{
	result = f_dept_code_find(dept_name.value)
	if (result==false)return
	
	is_dept_code = top.frames['security'].gs_dept_code.value
	is_dept_name = top.frames['security'].gs_dept_name.value
	
	il_screen = 1
	dept_name.value = is_dept_name
	btnquery_onclick()
}   
//--------------------------------------------------------------------------
function   rd_request_onclick()
//----------------------------------------------------------------
{
	bt_request.style.visibility="hidden"
	bt_norequest.style.visibility="visible"
	if (is_sec == 'r') {
	   bt_request.style.visibility='hidden'
	   bt_norequest.style.visibility='hidden'
//	   bt_chg_request.style.visibility='hidden'
	}

	bt_1.checked=true
	bt_2.checked=false
	bt_3.checked=false
	is_filter = "request"
	filter_function()
}  
//--------------------------------------------------------------------------
function   rd_norequest_onclick()
//----------------------------------------------------------------
{
	bt_request.style.visibility="visible"
	bt_norequest.style.visibility="hidden"
	if (is_sec == 'r') {
	   bt_request.style.visibility='hidden'
	   bt_norequest.style.visibility='hidden'
//	   bt_chg_request.style.visibility='hidden'
	}
	bt_1.checked=false
	bt_2.checked=true
	bt_3.checked=false
	is_filter = "norequest"
	filter_function()
}  
//--------------------------------------------------------------------------
function   rd_tot_onclick()
//----------------------------------------------------------------
{
	bt_request.style.visibility="visible"
	bt_norequest.style.visibility="visible"
	if (is_sec == 'r') {
	   bt_request.style.visibility='hidden'
	   bt_norequest.style.visibility='hidden'
//	   bt_chg_request.style.visibility='hidden'
	}

	bt_1.checked=false
	bt_2.checked=false
	bt_3.checked=true
	is_filter = "tot"
	filter_function()
}  
//--------------------------------------------------------------------------
function   filter_function()
//----------------------------------------------------------------
{
	gd_1.ReDraw = false
	ds_1.Filter()
	if (ds_1.CountRow < 1) {	
   		ds_2.ClearData()
   	}
	gd_1.ReDraw = true
}  
//--------------------------------------------------------------------------
function   request_process()
//----------------------------------------------------------------
{
	var ls_chk,i
	if (ds_1.CountRow < 1) return
//	if (il_screen > 1) return

	if ( ds_1.NameValue(ds_1.RowPosition,"requestdate") != '' ) return

	if ( ds_1.NameValue(ds_1.RowPosition,"approve_class") != '1' ) {
		alert("작성중이 아닌 자료는 청구할 수 없습니다...")
		return
	}
	if (ds_1.IsUpdated || ds_2.IsUpdated){
		alert('먼저 저장을 하시고 청구를 하십시오...')
		return
	}

	ls_chk = 0;
	for (i=1; i<= ds_2.CountRow; i++){
   	if (ds_2.NameValue(i,"requiredtime") == ''){
			alert(i + '번째 항목에 소요일자가 입력되지않아 청구하실 수 없습니다...')
			return
		}
   	if (ds_2.NameValue(i,"spec_unq_num") == '' || ds_2.NameValue(i,"spec_unq_num") == 0){
   		ls_chk++;
   	}
	}
	if (ls_chk > 0){
		if (confirm("미연계 내역이 있습니다. 계속 진행하시겠습니까?")){
		}
		else {
			return
		}
	}	
	if (confirm("선택한 내역을 청구하시겠습니까?")){
		ds_1.NameValue(ds_1.RowPosition,"requestdate") = is_work_date
		ds_1.NameValue(ds_1.RowPosition,"approve_class") = '2'
		il_save = 1
     	tr_1.Post()
     	il_save = 0
     	btnquery_onclick()
		gd_1.Editable="false"
		gd_2.Editable="false"
		tx_proj_content.contentEditable=false
		tx_proj_content.style.color="gray"

	}
}
//--------------------------------------------------------------------------
function   request_cancel()
//----------------------------------------------------------------
{
	var ll_date='',ll_cnt,ll_seq,ll_chg
	
	if (ds_1.CountRow < 1) return

	if ( ds_1.NameValue(ds_1.RowPosition,"requestdate") == '' ) return

//	if (il_screen > 1) return

	ll_seq = ds_1.NameValue(ds_1.RowPosition,'requestseq')
	ll_chg = ds_1.NameValue(ds_1.RowPosition,'chg_cnt')
	
	ll_cnt = f_select1_q(" select receipdate select_1 from m_request " +
								 " where dept_code = '" + is_dept_code + "'" +
								 "   and requestseq = " + ll_seq + 
								 "   and chg_cnt = " + ll_chg )

	if (ll_cnt > 0) {
		ll_date = ds_select1.NameValue(ds_select1.RowPosition,'select_1')
	}
	
	if ( ll_date != '' ) {
		alert("이미 본사에서 접수되었기에 취소할 수 없습니다")
		return
	}
	if (confirm("청구된 내역을 취소하시겠습니까?")){
		ds_1.NameValue(ds_1.RowPosition,"requestdate") = ''
		ds_1.NameValue(ds_1.RowPosition,"approve_class") = '1'
		il_save = 1
 		tr_1.Post()
 		il_save = 0
 		btnquery_onclick()
	}
}  

//------------------------------------------------------------------------
function date_rtn()                       //소요일자적용
//------------------------------------------------------------------------
{
	var i
	
   if ( em_work_dt.text == '') return
   if (ds_1.RowPosition < 1) return
   if (ds_2.CountRow < 1) return
   
	if (confirm("입력된 소요일자를 적용하시겠습니까?")){
		for (i=1; i<= ds_2.CountRow; i++){
			if (ds_2.NameValue(i,'requiredtime') == '' ) {
		   	ds_2.NameValue(i,"requiredtime") = em_work_dt.text.substr(0,4) + '.' + em_work_dt.text.substr(4,2) + '.' + em_work_dt.text.substr(6,2)
			}
		}
	}
}
//------------------------------------------------------------------------
function keyDown()                       //검색어 입력후 enter를 쳤을경우
//------------------------------------------------------------------------
{
	if (window.event.keyCode == 13) { 
		dept_code_find();
	} 
	return
}
//------------------------------------------------------------------------
function chg_request()                       //변경청구
//------------------------------------------------------------------------
{
	
	if (ds_1.NameValue(ds_1.RowPosition,"order_class") != "1") {
		alert("총액발주만 변경청구 할실수 있습니다.")
		return;
	}
	var ls_receipdate,ll_cnt,ll_degree,ll_org_degree,ll_requestseq,arg_cmd

	if (ds_1.RowPosition < 1 ) return
	
	if (ds_1.IsUpdated){
		il_save = 1
		tr_1.Post()
		il_save = 0
	}
	ls_receipdate = ds_1.NameValue(ds_1.RowPosition,"receipdate")
	ll_requestseq = ds_1.NameValue(ds_1.RowPosition,"requestseq")
	if (ls_receipdate == '') {
		alert('접수되지않은 자료는 청구취소로 처리하십시오...')
		return
	}
	ll_cnt = f_select2_q("select nvl(max(chg_cnt),0) select_1 from m_request " +
							 "where dept_code = '" + is_dept_code + "' and " +
							 "requestseq = " + ll_requestseq  )
	if (ll_cnt > 0){
		ll_org_degree = parseInt(ds_select2.NameValue(ds_select2.RowPosition,"select_1"),10)
		ll_degree     = ll_org_degree + 1;
	}
	
	arg_cmd = " INSERT INTO M_REQUEST  " +
     			 " SELECT DEPT_CODE,REQUESTSEQ," + ll_degree + ",APPROTITLE,'','',PROJ_CONTENT,HEAD_CONTENT,'1'," +
				 "        ORDER_CLASS,OWNER,CHECK_METHOD  " +
       		 "  FROM M_REQUEST  " +
      		 " WHERE DEPT_CODE = '" + is_dept_code + "'" +
      		 "   AND REQUESTSEQ = " + ll_requestseq +
      		 "   AND CHG_CNT = " + ll_org_degree

   f_update_sql(arg_cmd)
	
	arg_cmd = " INSERT INTO M_REQUEST_DETAIL  " +
				 " SELECT DEPT_CODE,REQUESTSEQ," + ll_degree + ",request_unq_num,REQUESTDETAILSEQ,MTRCODE, " +
				 "        NAME,SSIZE,UNITCODE,0,0,0,REQUIREDTIME,HO_BUY_QTY,SITE_BUY_QTY,TRANS_QTY," +
				 "        TRANS_DEPT_CODE,USAGE,SPEC_NO_SEQ,SPEC_UNQ_NUM,0,REMARK1," +
				 "        BUD_QTY,BUD_PRICE,BUD_AMT,PRE_REQUEST_QTY  + QTY, pre_chg_cnt " +
       		 "  FROM M_REQUEST_DETAIL  " +
      		 " WHERE DEPT_CODE = '" + is_dept_code + "'" +
      		 "   AND REQUESTSEQ = " + ll_requestseq +
      		 "   AND CHG_CNT = " + ll_org_degree

   f_update_sql(arg_cmd)
	btnquery_onclick()
}
//------------------------------------------------------------------------
function material_search()                       //자재 코드 찾기
//------------------------------------------------------------------------
{
	var result,ls_mat_code,ll_cnt,i,ll_row,row,ll_seq,ll_chk;
	var array = new Array();

   row = ds_2.RowPosition
//   ls_arg = is_dept_code
//   if (row > 0){
//   	ls_arg = ls_arg + '@' + ds_2.NameValue(row-1,'name')
//   }
//   else{
//     ls_arg = ls_arg + '@' + ""
//   }
   if (row > 0){
   	ls_arg = ds_2.NameValue(row-1,'name')
   }
   else{
     ls_arg =  ""
   }
	result = window.showModalDialog(gs_home + "/const/m_web/00/m_code_material_find_1h.html",ls_arg,"dialogWidth:560px;dialogHeight:510px");

	if(result == "") {
      ds_2.DeleteRow(row)
		return;
	}
	array = result.split("@");
	ds_2.NameString(row,"mtrcode") = array[0];   // 코드 
	ds_2.NameString(row,"name") = array[1];  // 명칭
	ds_2.NameString(row,"ssize") = array[2];     // 규격
	ds_2.NameString(row,"unitcode") = array[3];     // 단위
	
	ls_mat_code = array[0]

	ds_3.DataID = is_ds_3_addr +  is_dept_code + "&arg_mat_code=" + ls_mat_code
	ds_3.SyncLoad=true
	ds_3.Reset()
	
	ll_cnt = ds_3.CountRow
	
	if (ll_cnt < 1 ) return;
	ll_row = row
	ll_chk = 0;
	
	for (i=1;i<=ll_cnt;i++){
		if (ds_3.NameValue(i,"remaind_qty") > 0 ){
			if (ll_row != row) {
				ds_2.AddRow()
				ll_row = ds_2.RowPosition
				ds_seq.SyncLoad=true;             // seq no 구하기
			 	ds_seq.reset()
				ll_seq = ds_2.Max(5,1,ds_2.CountRow)
				ds_2.NameValue(ll_row,"dept_code")        = is_dept_code
				ds_2.NameValue(ll_row,"requestseq")       = ds_1.NameValue(ds_1.RowPosition,"requestseq")
				ds_2.NameValue(ll_row,"chg_cnt")          = ds_1.NameValue(ds_1.RowPosition,"chg_cnt")
				ds_2.NameValue(ll_row,"request_unq_num")  = ds_seq.NameValue(1,"nextval")
				ds_2.NameValue(ll_row,"requestdetailseq") = ll_seq + 1
				ds_2.NameValue(ll_row,"mtrcode")          = array[0];   // 코드 
				ds_2.NameValue(ll_row,"name")             = array[1];  // 명칭
				ds_2.NameValue(ll_row,"ssize")            = array[2];     // 규격
				ds_2.NameValue(ll_row,"unitcode")         = array[3];     // 단위
				ds_2.NameValue(ll_row,"pre_chg_cnt")      = ds_1.NameValue(ds_1.RowPosition,"chg_cnt");     // 단위
			}
			ds_2.NameValue(ll_row,"spec_no_seq")     = ds_3.NameValue(i,"spec_no_seq")
			ds_2.NameValue(ll_row,"spec_unq_num")    = ds_3.NameValue(i,"spec_unq_num")
			ds_2.NameValue(ll_row,"spec_name")       = ds_3.NameValue(i,"spec_name")
			ds_2.NameValue(ll_row,"bud_qty")         = ds_3.NameValue(i,"qty")
			ds_2.NameValue(ll_row,"bud_price")       = ds_3.NameValue(i,"price")
			ds_2.NameValue(ll_row,"bud_amt")         = ds_3.NameValue(i,"amt")
			ds_2.NameValue(ll_row,"pre_request_qty") = ds_3.NameValue(i,"request_qty")
			ds_2.NameValue(ll_row,"qty")             = ds_3.NameValue(i,"remaind_qty")
			ds_2.NameValue(ll_row,"nappr_qty")             = ds_3.NameValue(i,"remaind_qty")
			ds_2.NameValue(ll_row,"remaind_qty")     = ds_3.NameValue(i,"remaind_qty")
			ll_row ++;
			ll_chk++;
		}
	}
	if (ll_chk > 0) {
      if (ds_1.IsUpdated) {
		il_save = 1
		tr_1.Post()
		il_save = 0
      }

		tr_2.Post()
	}
	return
}
//------------------------------------------------------------------------
function iron_rtn() // 철근또는 레미콘일경우 청구내역을 생성한다.
//------------------------------------------------------------------------
{
//	var ls_mat_code,ls_chk,ll_requestseq,ll_chg_cnt,arg_cmd,i
//
//   ls_chk = ccom_class.CodeValue;
//   
//   if (ls_chk == '') {
//   	alert('단가발주 항목을 반드시 선택하십시오...')
//   	return
//   }
//   if (ls_chk == '1') {
//   	if (confirm("철근자재를 추가하시겠습니까? \n 기존에 기청구되지않은 자료는 삭제됩니다...")){
//   	}
//   	else {
//   		return
//   	}
//   }
//   else {
//   	if (confirm("레미콘을 추가하시겠습니까? \n 기존에 기청구되지않은 자료는 삭제됩니다...")){
//   	}
//   	else {
//   		return
//   	}
//   }
//   if (ds_1.IsUpdated) {
//	  il_save = 1
//      tr_1.Post()
//      il_save = 0
//   }
//   ll_requestseq = ds_1.NameValue(ds_1.RowPosition,"requestseq")
//   ll_chg_cnt    = ds_1.NameValue(ds_1.RowPosition,"chg_cnt")
//   arg_cmd = "delete from m_request_detail   " +   
//                 "  where dept_code = '" + is_dept_code + "'"   + 
//                 "    and requestseq = " + ll_requestseq + 
//                 "    and chg_cnt = " + ll_chg_cnt +
//                 "    and pre_request_qty = 0 " 
//   f_update_sql(arg_cmd)
//   if (ls_chk == '1') {
//		arg_cmd = "   INSERT INTO M_REQUEST_DETAIL  " +
//					 "   SELECT a.DEPT_CODE," + ll_requestseq + "," + ll_chg_cnt + ",m_spec_unq_no.nextval,rownum,a.mat_code, " +
//					 "  			b.NAME,b.SSIZE,b.UNITCODE,a.qty - nvl(c.qty,0),0,0,'',0,0,0,'','',a.SPEC_NO_SEQ,a.SPEC_UNQ_NUM, " +  
//					 "  			a.qty - nvl(c.qty,0),'',a.QTY,a.PRICE,a.AMT,nvl(c.qty,0)," + ll_chg_cnt +
//					 "     FROM y_budget_detail a,m_code_material b, " +
//					 "          (select max(dept_code) dept_code,max(spec_no_seq) spec_no_seq,max(spec_unq_num) spec_unq_num, " +
//					 "                  nvl(sum(qty),0) qty" +
//					 "             from m_request_detail  " +
//					 "          group by dept_code,spec_no_seq,spec_unq_num) c " +
//					 "    WHERE a.mat_code = b.mtrcode (!) " +
//					 "      AND a.dept_code = c.dept_code (!) " +
//					 "      AND a.spec_no_seq = c.spec_no_seq (!) " +
//					 "      AND a.spec_unq_num = c.spec_unq_num (!) " +
//					 "      AND a.dept_code = '" + is_dept_code + "'" + 
//					 "      AND substrb(a.mat_code,1,8) = '00100110'" +
//					 "      AND a.mat_code not in ( select mtrcode " +
//					 "                                from m_request_detail " +
//	             "                               where dept_code = '" + is_dept_code + "'"   + 
//	             "                                 and requestseq = " + ll_requestseq + 
//	             "                                 and chg_cnt = " + ll_chg_cnt + " ) "
//	   f_update_sql(arg_cmd)
//		arg_cmd = "   INSERT INTO M_REQUEST_DETAIL  " +
//					 "   SELECT '" + is_dept_code + "'," + ll_requestseq + "," + ll_chg_cnt + ",m_spec_unq_no.nextval,rownum,a.mtrcode, " +
//					 "  			a.NAME,a.SSIZE,a.UNITCODE,0,0,0,'',0,0,0,'','',0,0,0,'',0,0,0,0,  " + ll_chg_cnt +
//					 "     FROM m_code_material a " +
//					 "    WHERE substrb(a.mtrcode,1,8) = '00100110'" +
//					 "      AND a.mtrcode not in ( select mtrcode " +
//					 "                                from m_request_detail " +
//	             "                               where dept_code = '" + is_dept_code + "'"   + 
//	             "                                 and requestseq = " + ll_requestseq + 
//	             "                                 and chg_cnt = " + ll_chg_cnt + " ) "
//	   f_update_sql(arg_cmd)
//	}
//	else {
//		arg_cmd = "   INSERT INTO M_REQUEST_DETAIL  " +
//					 "   SELECT a.DEPT_CODE," + ll_requestseq + "," + ll_chg_cnt + ",m_spec_unq_no.nextval,rownum,a.mat_code, " +
//					 "  			b.NAME,b.SSIZE,b.UNITCODE,a.qty - nvl(c.qty,0),0,0,'',0,0,0,'','',a.SPEC_NO_SEQ,a.SPEC_UNQ_NUM, " +  
//					 "  			a.qty - nvl(c.qty,0),'',a.QTY,a.PRICE,a.AMT,nvl(c.qty,0),  " + ll_chg_cnt +
//					 "     FROM y_budget_detail a,m_code_material b, " +
//					 "          (select max(dept_code) dept_code,max(spec_no_seq) spec_no_seq,max(spec_unq_num) spec_unq_num, " +
//					 "                  nvl(sum(qty),0) qty" +
//					 "             from m_request_detail  " +
//					 "          group by dept_code,spec_no_seq,spec_unq_num) c " +
//					 "    WHERE a.mat_code = b.mtrcode (!) " +
//					 "      AND a.dept_code = c.dept_code (!) " +
//					 "      AND a.spec_no_seq = c.spec_no_seq (!) " +
//					 "      AND a.spec_unq_num = c.spec_unq_num (!) " +
//					 "      AND a.dept_code = '" + is_dept_code + "'" + 
//					 "      AND substrb(a.mat_code,1,6) = '001003'" +
//					 "      AND a.mat_code not in ( select mtrcode " +
//					 "                                from m_request_detail " +
//	             "                               where dept_code = '" + is_dept_code + "'"   + 
//	             "                                 and requestseq = " + ll_requestseq + 
//	             "                                 and chg_cnt = " + ll_chg_cnt + " ) "
//	   f_update_sql(arg_cmd)
//		arg_cmd = "   INSERT INTO M_REQUEST_DETAIL  " +
//					 "   SELECT '" + is_dept_code + "'," + ll_requestseq + "," + ll_chg_cnt + ",m_spec_unq_no.nextval,rownum,a.mtrcode, " +
//					 "  			a.NAME,a.SSIZE,a.UNITCODE,0,0,0,'',0,0,0,'','',0,0,0,'',0,0,0,0,  " + ll_chg_cnt +
//					 "     FROM m_code_material a " +
//					 "    WHERE substrb(a.mtrcode,1,6) = '001003'" +
//					 "      AND a.mtrcode not in ( select mtrcode " +
//					 "                                from m_request_detail " +
//	             "                               where dept_code = '" + is_dept_code + "'"   + 
//	             "                                 and requestseq = " + ll_requestseq + 
//	             "                                 and chg_cnt = " + ll_chg_cnt + " ) "
//	   f_update_sql(arg_cmd)
//	}
//
//
//	div_btnquery_onclick()
//	if (ds_2.CountRow > 0 ) {
//		ds_2.SortExpr = "+" + "MTRCODE";
//	   ds_2.Sort();
//		for (i=1;i<=ds_2.CountRow;i++) {
//			ds_2.NameValue(i,"requestdetailseq") = i
//		}
//	   if (ds_1.IsUpdated) {
//			il_save = 1
//	      tr_1.Post()
//     		il_save = 0
//
//	   }
//		tr_2.Post()
//	}
//	alert('정상처리되었습니다...')   
//	return
}
//------------------------------------------------------------------------
function get_focus(focus) // gd가 포커스를 받을때 동작.
//------------------------------------------------------------------------
{
	il_screen = focus
}

//---------------------------------------------------------------------------
function window_onload()                      // window open event
//---------------------------------------------------------------------------
{  
  if (f_reject_window()) return 
   top.frames['main_title'].mouse_over()
 ll_cnt = f_select_q("select etc_code select_1, child_name select_2  from z_code_etc_child where class_tag = '040' order by etc_code") //승인구분
   top.frames['main_title'].title_name.value = " " + "자재청구"  
	tr_1.Action = is_tr_1_addr
	tr_2.Action = is_tr_2_addr
   	ds_seq.DataID = is_ds_seq_addr                       // SEQ NO 의 DATAID
	dept_name.value = is_dept_name
//   ccom_class.CodeValue = '1';
	is_sec = gf_initial_security()
	if (is_sec == 'r') {
	   bt_request.style.visibility='hidden'
	   bt_norequest.style.visibility='hidden'
//	   bt_chg_request.style.visibility='hidden'
	}
   
	btnquery_onclick()
}
</SCRIPT>
<script language="javascript" for=gd_2 event=OnPopup(row,colid,data)>
	var result,ll_cnt,ll_spec_no_seq,ll_spec_unq_num,ll_bud_qty,ll_qty;
	var array = new Array();
	if  (colid == "spec_name") {                                //실행내역 찾기 
		result = window.showModalDialog(gs_home + "/comm_search/y_budget_find_1h.html","mat@" + is_dept_code+ "@" + ds_2.NameValue(row,"spec_unq_num"),"dialogWidth:1020px;dialogHeight:700px");
		if(result == "") return;
		array = result.split("@");
		if (ds_2.NameValue(row,"unitcode") != array[4]) {
	   	if (confirm("자재의 단위와 실행의 단위가 상이합니다 그래도 선택하시겠습니까?")){
				ds_2.NameString(row,"spec_no_seq") = array[0];   // 실행 상위 unq_no 
				ds_2.NameString(row,"spec_unq_num") = array[1];  // 실행내역 unq_no 
				ds_2.NameString(row,"spec_name") = array[6];          // 실행내역 명칭 
				ds_2.NameValue(row,"bud_qty") = array[7];
				ds_2.NameValue(row,"bud_price") = array[8];
				ds_2.NameValue(row,"bud_amt") = array[9];
				ll_spec_no_seq = array[0]
				ll_spec_unq_num = array[1]
				ll_bud_qty = array[7]
				ll_cnt = f_select2_q("select nvl(sum(qty),0) select_1 from m_request_detail " +
										 "where dept_code = '" + is_dept_code + "' and " +
										 "spec_no_seq = " + ll_spec_no_seq + " and spec_unq_num = " + ll_spec_unq_num )
				if ( ll_cnt > 0 ) {
					ll_qty = ds_select2.NameValue(ds_select2.RowPosition,"select_1")
					ds_2.NameValue(row,"pre_request_qty") = ll_qty
					ds_2.NameValue(row,"qty") = ll_bud_qty - ll_qty
					ds_2.NameValue(row,"nappr_qty") = ll_bud_qty - ll_qty
					ds_2.NameValue(row,"remaind_qty") = ll_bud_qty - ll_qty
			      if (ds_1.IsUpdated) {
						il_save = 1
			         tr_1.Post()
						il_save = 0
			      }
					tr_2.Post()
				}
				gd_2.ColumnProp('bud_qty', 'Edit') = 'None'
				gd_2.ColumnProp('bud_price', 'Edit') = 'None'
			}
			else {
				ds_2.NameString(row,"spec_no_seq") = 0;   // 실행 상위 unq_no 
				ds_2.NameString(row,"spec_unq_num") = 0;  // 실행내역 unq_no 
				ds_2.NameString(row,"spec_name") = '';          // 실행내역 명칭 
				ds_2.NameValue(row,"bud_qty") = 0;
				ds_2.NameValue(row,"bud_price") = 0;
				ds_2.NameValue(row,"bud_amt") = 0;
				ds_2.NameValue(row,"pre_request_qty") = 0
				ds_2.NameValue(row,"qty") = 0
				ds_2.NameValue(row,"nappr_qty") = 0
				ds_2.NameValue(row,"remaind_qty") = 0
				gd_2.ColumnProp('bud_qty', 'Edit') = 'Numeric'
				gd_2.ColumnProp('bud_price', 'Edit') = 'Numeric'
			}
		}
		else {
				ds_2.NameString(row,"spec_no_seq") = array[0];   // 실행 상위 unq_no 
				ds_2.NameString(row,"spec_unq_num") = array[1];  // 실행내역 unq_no 
				ds_2.NameString(row,"spec_name") = array[6];          // 실행내역 명칭 
				ds_2.NameValue(row,"bud_qty") = array[7];
				ds_2.NameValue(row,"bud_price") = array[8];
				ds_2.NameValue(row,"bud_amt") = array[9];
				ll_spec_no_seq = array[0]
				ll_spec_unq_num = array[1]
				ll_bud_qty = array[7]
				ll_cnt = f_select2_q("select nvl(sum(qty),0) select_1 from m_request_detail " +
										 "where dept_code = '" + is_dept_code + "' and " +
										 "spec_no_seq = " + ll_spec_no_seq + " and spec_unq_num = " + ll_spec_unq_num )
				if ( ll_cnt > 0 ) {
					ll_qty = ds_select2.NameValue(ds_select2.RowPosition,"select_1")
					ds_2.NameValue(row,"pre_request_qty") = ll_qty
					ds_2.NameValue(row,"qty") = ll_bud_qty - ll_qty
					ds_2.NameValue(row,"nappr_qty") = ll_bud_qty - ll_qty
					ds_2.NameValue(row,"remaind_qty") = ll_bud_qty - ll_qty
			      if (ds_1.IsUpdated) {
						il_save = 1
			         tr_1.Post()
						il_save = 0
			      }
					tr_2.Post()
				}
				gd_2.ColumnProp('bud_qty', 'Edit') = 'None'
				gd_2.ColumnProp('bud_price', 'Edit') = 'None'
		}
		return
	}
</SCRIPT>
<SCRIPT language=JavaScript for=ds_1 event=onFilter(row)>
      switch (is_filter) {
              case "request":
                         if (ds_1.NameValue(row,"requestdate") != '' ) return true
                         else return false;
                         break;
              case "norequest":
                         if (ds_1.NameValue(row,"requestdate") == '') return true
                         else return false;
                         break;
              case "tot":
                         return true
                         break;
        }
</SCRIPT>

<script language=JavaScript for=gd_1 event=OnCloseUp(row,colid)>
	if (colid == "order_class") {
		if (ds_2.CountRow > 0) {
			alert("하위에 자료가 존재함으로 발주구분값을 수정할 수 없습니다.")
			ds_1.NameValue(row,"order_class") = ds_1.OrgNameValue(row,"order_class")
		}
		if (ds_1.NameValue(row,"chg_cnt") > 1) {
			alert("변경청구에서는 발주구분값을 수정할 수 없습니다.")
			ds_1.NameValue(row,"order_class") = ds_1.OrgNameValue(row,"order_class")
		}
	}
</SCRIPT>


<script language=JavaScript for=gd_2 event=CanColumnPosChange(row,colid)>
	var ll_qty,ll_rem_qty,ll_input_qty,ll_pre_qty
	if (colid == "qty" ) {
		ll_qty     = ds_2.NameValue(row,"qty")
		ll_rem_qty = ds_2.NameValue(row,"remaind_qty")
		if (ll_qty > 0) {
			if (ll_qty > ll_rem_qty) {
				alert('당회청구수량이 실행잔여수량을 초과하여 청구하실 수 없습니다...')
				ds_2.NameValue(row,"qty") = ds_2.OrgNameValue(row,"qty")
				ds_2.NameValue(row,"nappr_qty") = ds_2.OrgNameValue(row,"qty")
				return false
			}
			else {
				return true
			}
		}
		else {
			ll_input_qty = ds_2.NameValue(row,'input_qty')
			ll_pre_qty = ds_2.NameValue(row,'pre_request_qty')
			ll_rem_qty  = (ll_pre_qty - ll_input_qty) * -1
			if (ll_qty < ll_rem_qty) {
				alert('당회청구수량이 청구잔량보다 적게 청구하실 수 없습니다...')
				ds_2.NameValue(row,"qty") = ds_2.OrgNameValue(row,"qty")
				ds_2.NameValue(row,"nappr_qty") = ds_2.OrgNameValue(row,"qty")
				return false
			}
			else{
				return true
			}
		}
	}
	return true
</SCRIPT>

<SCRIPT language=JavaScript for=ds_2 event=OnColumnChanged(row,colid)>
	if (colid == "bud_qty" || colid == 'bud_price') {
		ds_2.NameValue(row,"bud_amt") = parseInt(ds_2.NameValue(row,"bud_qty") * ds_2.NameValue(row,"bud_price"),10)
		ds_2.NameValue(row,"remaind_qty") = ds_2.NameValue(row,"bud_qty") - ds_2.NameValue(row,"pre_request_qty")
		if (colid == 'bud_qty') {
			ds_2.NameValue(row,'qty') = ds_2.NameValue(row,'bud_qty')
		}
	}
	if (colid == "qty" || colid == "unitprice" ) {
        	ds_2.NameValue(row,"amt") = parseInt(ds_2.NameValue(row,"qty") * ds_2.NameValue(row,"unitprice"))
        	ds_2.NameValue(row,"nappr_qty") = ds_2.NameValue(row,"qty")
	}   
</SCRIPT>

<SCRIPT language=JavaScript for=gd_2 event=OnColumnPosChanged(row,colid)>
	if (ds_1.NameValue(ds_1.RowPosition,'chg_cnt') == ds_2.NameValue(row,'pre_chg_cnt')) {
		gd_2.ColumnProp('ssize', 'Edit')   = ''
		gd_2.ColumnProp('unitcode', 'Edit') = ''
		gd_2.ColumnProp('spec_name', 'Edit') = 'Popup'
	} else {
		if (colid != "qty") {
			gd_2.ColumnProp('ssize', 'Edit')   = 'None'
			gd_2.ColumnProp('unitcode', 'Edit') = 'None'
			gd_2.ColumnProp('spec_name', 'Edit') = 'None'
		} else {
			gd_2.ColumnProp('ssize', 'Edit')   = ''
			gd_2.ColumnProp('unitcode', 'Edit') = ''
			gd_2.ColumnProp('spec_name', 'Edit') = 'Popup'
		}
	}
</SCRIPT>

<SCRIPT language=JavaScript event=OnRowPosChanged(row) for=ds_2>
	if (ds_2.NameValue(row,"spec_unq_num") == 0) {
		gd_2.ColumnProp('bud_qty', 'Edit') = ''
		gd_2.ColumnProp('bud_price', 'Edit') = ''
	}
	else{
		gd_2.ColumnProp('bud_qty', 'Edit') = 'None'
		gd_2.ColumnProp('bud_price', 'Edit') = 'None'
	}
</SCRIPT>
<SCRIPT language=JavaScript event=OnRowPosChanged(row) for=ds_1>
	if  (row < 1) return;
	if (ds_1.NameValue(row,"requestdate") != '' || ds_1.NameValue(row,"approve_class") != '1' ) {
		gd_1.Editable="false"
		gd_2.Editable="false"
		tx_proj_content.contentEditable=false
		tx_proj_content.style.color="gray"
	}
	else{
		gd_1.Editable="true"
		gd_2.Editable="true"
		tx_proj_content.contentEditable=true
		tx_proj_content.style.color="black"
	}
	div_btnquery_onclick()
</SCRIPT>

<script language=JavaScript for=ds_1 event=CanRowPosChange(row)>
	if(ds_2.IsUpdated){
		alert('반드시 저장처리를 한후 선택하시기 바랍니다...')
		il_screen = 2
		return false
	}
//	if (il_save == 0) {
//		if (ds_1.SysStatus(row) != 0){
//			btnsave_onclick()
//		}
//	}
//	if (il_save == 0) {
//		if (ds_1.SysStatus(row) != 0){
//			return false
//		}
//		else{
//			return true
//		}
//	}
</script>

<!-- ======================================================================= -->
<!--                                   Event                                 -->
<!-- ======================================================================= -->

<SCRIPT language=JavaScript for=ds_1 event=OnLoadError()>
  alert("Error Code(ds_1) : " + ds_1.ErrorCode + "\n" + "Error Message : " + ds_1.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_3 event=OnLoadError()>
  alert("Error Code(ds_3) : " + ds_3.ErrorCode + "\n" + "Error Message : " + ds_3.ErrorMsg + "\n");
</SCRIPT>

<SCRIPT language=JavaScript for=tr_1 event=OnFail()>
  alert("Error Code(tr_1) : " + tr_1.ErrorCode + "\n" + "Error Message : " + tr_1.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_2 event=OnLoadError()>
  alert("Error Code(ds_2) : " + ds_2.ErrorCode + "\n" + "Error Message : " + ds_2.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_select2 event=OnLoadError()>
  alert("Error Code(ds_select2) : " + ds_select2.ErrorCode + "\n" + "Error Message : " + ds_select2.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_update event=OnLoadError()>
  alert("Error Code(ds_update) : " + ds_update.ErrorCode + "\n" + "Error Message : " + ds_update.ErrorMsg + "\n");
</SCRIPT>

<SCRIPT language=JavaScript for=tr_2 event=OnFail()>
  alert("Error Code(tr_2) : " + tr_2.ErrorCode + "\n" + "Error Message : " + tr_2.ErrorMsg + "\n");
</SCRIPT>
<!-- ======================================================================= -->
<!--                                 Component                               -->
<!-- ======================================================================= -->
<comment id="__NSID__"><OBJECT id=ds_1
    style="Z-INDEX: 103; LEFT: 169px; POSITION: absolute; TOP: 3px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
    <param name=UseFilter       value=true></OBJECT></comment> <script> __ws__(__NSID__);</script>

<comment id="__NSID__"><OBJECT id=ds_2 
    style="Z-INDEX: 108; LEFT: 319px; POSITION: absolute; TOP: 7px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT></OBJECT></comment> <script> __ws__(__NSID__);</script>
    
<comment id="__NSID__"><OBJECT id=ds_3 
    style="Z-INDEX: 108; LEFT: 319px; POSITION: absolute; TOP: 7px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT></OBJECT></comment> <script> __ws__(__NSID__);</script>
 <comment id="__NSID__"><OBJECT id=ds_update
    style="Z-INDEX: 103; LEFT: 169px; POSITION: absolute; TOP: 3px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT></OBJECT></comment> <script> __ws__(__NSID__);</script>

<comment id="__NSID__"><OBJECT id=ds_seq 
    style="Z-INDEX: 102; LEFT: 244px; POSITION: absolute; TOP: 1px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT></OBJECT></comment> <script> __ws__(__NSID__);</script>
 <comment id="__NSID__"><Object id=ds_select
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>
 <comment id="__NSID__"><Object id=ds_select1
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>
 <comment id="__NSID__"><Object id=ds_select2
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 10px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>      
 <comment id="__NSID__"><Object id=ds_process
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>

<comment id="__NSID__"><OBJECT id=tr_1 
    style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
    classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:m_request_1tr=ds_1)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>
	
<comment id="__NSID__"><OBJECT id=tr_2 
    style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
    classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:m_request_detail_1tr=ds_2)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>
</HEAD>
<!-- ======================================================================= -->
<!--                                   Body                                  -->
<!-- ======================================================================= -->
<BODY style="FONT-SIZE: 12px; margin: 0;"  onload=setTimeout('window_onload()',1) oncontextmenu="return false" >
<div class=main_div>
<table width="100%"  height="100%"  BORDER="0"    CELLSPACING="0"  align="center"   style="FONT-SIZE: 12px; ">
	<tr >
		<td class=td_green height="20" colspan=3 >
	      <table width="100%" height="100%"  BORDER="0"  align="center" cellpadding=0  CELLSPACING="0" style="FONT-SIZE: 12px">
	         <tr> 
		         <td width="15px"><img src="../../../image/bullet3.gif" align="absmiddle" ></td>
	             <td class=font_green_bold width="43" >현장명</td>
	             <td width="166"><INPUT id=dept_name  ondblclick="dept_name.select()" style="ime-mode:active" style=" FONT-SIZE: 12px;" size=25 onkeyDown="keyDown()"></td>
					 <td><INPUT  type=button  class="img_btnFind"  value=검색 onclick=dept_code_find() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"></td>
					 <td width="40"></td>	
					 <td width="22"><input id=bt_2 type="radio" value="2"  onclick="rd_norequest_onclick()"></td>
					 <td width="65">미청구자료</td>
					 <td width="22"><input id=bt_1 type="radio" value="2"  onclick="rd_request_onclick()"></td>
					 <td width="55">청구자료 </td>
					 <td width="22"><input id=bt_3 type="radio" value="1"  defaultChecked=true checked=true onclick="rd_tot_onclick()"></td>					 					 				
					 <td width="60">전체</td>
					 <td width="58"><INPUT  id=bt_request  type=button  class="img_btn2_1"  value=청구 onclick=request_process() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"></td>
					 <td><INPUT  id=bt_norequest  type=button  class="img_btn4_1"  value=청구취소 onclick=request_cancel() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"></td>
	<!--						<INPUT  id=bt_chg_request  type=button  class="img_btn4_1"  value=변경청구 onclick=chg_request() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"> -->
					 </td>
					 <td width="70"></td>
		          <td width="15px"><img src="../../../image/bullet3.gif" align="absmiddle" ></td>
	             <td class=font_green_bold width="55">소요일자</td>
	             <td width="90">
							<comment id="__NSID__"><OBJECT id=em_work_dt
							       style="Z-INDEX: 101; WIDTH: 80px;background-color:white" 
							      classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
								    <PARAM NAME="Alignment" VALUE="1">
								    <PARAM NAME="IsComma" VALUE="0">
								    <PARAM NAME="MaxLength" VALUE="6">
								    <PARAM NAME="Format" VALUE="YYYY-MM-DD">
							       <param name=ClipMode       value=true>
								    <PARAM NAME="Numeric" VALUE="0">
								    <PARAM NAME="SelectAll" VALUE="-1">
							</OBJECT></comment> <script> __ws__(__NSID__);</script>
					 </td>
	             <td  colspan=1>
							<INPUT    type=button  class="img_btn2_1"  value=적용 onclick=date_rtn() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;">
					 </td>
	         </tr>                 
	      </table>
		</td>
	</tr>
	<tr>
		<td width="700" height="275">
			<comment id="__NSID__"><OBJECT id=gd_1 onfocus="get_focus(1)"
			    style="FONT-SIZE: 12px; Z-INDEX: 105;WIDTH:100%; HEIGHT: 100%" 
			    classid=clsid:1F57AEAD-DB12-11D2-A4F9-00608CEBEE49>
				<PARAM NAME="MultiRowSelect" VALUE="0">
				<PARAM NAME="AllShowEdit" VALUE="-1">
				<PARAM NAME="AutoInsert" VALUE="-1">
			   <PARAM NAME="BorderStyle"  VALUE=1>
				<PARAM NAME="Editable" VALUE="-1">
				<PARAM NAME="ColSizing" VALUE="-1">
				<PARAM NAME="DataID" VALUE="ds_1">
				<PARAM NAME="Format" VALUE=" 
				  <C> Name='번호' ID=requestseq Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK BgColor=#F2F2F2 Width=35 </C>
				  <C> Name='차수' ID=chg_cnt Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK BgColor=#F2F2F2 Width=35 </C>
				  <C> Name='*청구제목' ID=approtitle  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=250 </C> 
				  <C> Name='담당자' ID=owner  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=100 </C> 
				  <C> Name='구분' ID=approve_class Align=Center Edit=None EditStyle=Lookup Data='ds_select:select_1:select_2'  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK BgColor=#F2F2F2   Width=60 </C>
				  <C> Name='청구일자' ID=requestdate Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK BgColor=#F2F2F2 Width=90 </C> 
				  <C> Name='접수일자' ID=receipdate Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK BgColor=#F2F2F2 Width=90 </C> 
			      ">
			</OBJECT></comment> <script> __ws__(__NSID__);</script>
		</td>
		<td width="300" height="280" >
	      <table width="100%"  height="100%"  BORDER="1" cellpadding=0   CELLSPACING="0" style="FONT-SIZE: 12px; border-collapse:collapse" bordercolorlight="#000000" bordercolordark="#000000"  >
	         <tr BGCOLOR="white" height="24" > 
	             <td  BGCOLOR="#BBE0F4" style="COLOR: BLACK"  > 
	                 <div align="center">현장특기사항</div></td>
	         </tr> 
	         <tr BGCOLOR="white" > 
	             <td height="115" >
	                 <TEXTAREA  style="FONT-SIZE:12px; width:100% ;  height:100%" id=tx_proj_content rows=5 cols=45 
	                 maxLength="200" onChange="LimitTextLength(this)" onKeyUp="LimitTextLength(this)" ></TEXTAREA></td>
	         </tr> 
	         <tr BGCOLOR="white" height="24" > 
	             <td  BGCOLOR="#BBE0F4" style="COLOR: BLACK" > 
	                 <div align="center">본사특기사항</div></td>
	         </tr> 
	         <tr BGCOLOR="white" > 
	             <td height="115" >
	                 <TEXTAREA  style="FONT-SIZE:12px; width:100% ;  height:100% " id=tx_head_content rows=5 cols=45 ReadOnly
	                 maxLength="200" onChange="LimitTextLength(this)" onKeyUp="LimitTextLength(this)" ></TEXTAREA></td>
	         </tr> 
	       </table>                         
		</td>
	</tr>
	<tr height="*"><td colspan=3 height="5"></td></tr>
	<tr>
		<td colspan=3 width="100%" height="52%"> 
			<comment id="__NSID__"><OBJECT id=gd_2 onfocus="get_focus(2)"
			    style="FONT-SIZE: 12px; Z-INDEX: 105; LEFT: 2px; WIDTH:100%; HEIGHT:100% " 
			    classid=clsid:1F57AEAD-DB12-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
				<PARAM NAME="AutoInsert" VALUE="-1">
				<PARAM NAME="MultiRowSelect" VALUE="-1">
				<PARAM NAME="AllShowEdit" VALUE="-1">
			   <PARAM NAME="BorderStyle"  VALUE=1>
				<PARAM NAME="Editable" VALUE="-1">
				<PARAM NAME="ColSizing" VALUE="-1">
			   <param name="ViewSummary"    value=1>
				<PARAM NAME="DataID" VALUE="ds_2">
				<PARAM NAME="Format" VALUE=" 
					  <C> Name='번호' ID=requestdetailseq Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=30 </C> 
					  <C> Name='*명칭' ID=name Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK BgColor=#F2F2F2 Width=150 
					  		SumText='합 계'  SumColor=Black SumBgColor=Pink </C> 
					  <C> Name='규격' ID=ssize  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=100 </C> 
					  <C> Name='단위' ID=unitcode Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=35 </C> 
					  <C> Name='투입내역' ID=spec_name EditStyle=Popup  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=180 </C> 
					  <C> Name='소요일자' ID=requiredtime Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=70 </C> 
					  <G> Name='실행예산 '  ID=t_tit HeadAlign=Center  HeadBgColor=#BBE0F4  HeadColor=BLACK  
					  <C> Name='수량' ID=bud_qty decao=3  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  BgColor=#F2F2F2  Width=65 
					  		SumText={sum(decode(spec_unq_num,0,bud_qty,decode(rk,1,bud_qty,0)))}   SumColor=Black SumBgColor=Pink</C> 
					  <C> Name='단가' ID=bud_price    BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  BgColor=#F2F2F2  Width=70 </C> 
					  <C> Name='금액' ID=bud_amt Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadCo1or=BLACK BgColor=#F2F2F2 Width=85 
					  			SumText={sum(decode(spec_unq_num,0,bud_amt,decode(rk,1,bud_amt,0)))}  SumColor=Black SumBgColor=Pink </C> 
					  <G> Name='청구수량 ' decao=3  ID=t_tit HeadAlign=Center  HeadBgColor=#BBE0F4  HeadColor=BLACK  
					  <C> Name='기입고' ID=input_qty decao=3  Edit=None    BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  BgColor=#F2F2F2 
					  			SumText=@sum SumColor=Black SumBgColor=Pink Width=65 </C> 
					  <C> Name='기청구' ID=pre_request_qty decao=3  Edit=None    BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  BgColor=#F2F2F2 
					  			SumText=@sum SumColor=Black SumBgColor=Pink Width=65 </C> 
					  <C> Name='당회청구' ID=qty  decao=3   BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK 
					  			SumText=@sum SumColor=Black SumBgColor=Pink Width=75 </C> 
					  <C> Name='누계' ID=sum_qty   decao=3  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  BgColor=#F2F2F2  Width=75 
					  			value={pre_request_qty+qty} SumText={sum(pre_request_qty)+sum(qty)} Dec=3 SumColor=Black SumBgColor=Pink  </C>
					   </G>
					  <C> Name='현장구매정보' ID=remark1  Edit=None BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK BgColor=#F2F2F2  Width=270 </C> 
					  <C> Name='실행고유번호' ID=spec_unq_num  Edit=None BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK BgColor=#F2F2F2  Width=100 </C> 
					  
			      ">
			</OBJECT></comment> <script> __ws__(__NSID__);</script>	
		</td>
	</tr>
</table>		
</DIV>
		
<comment id="__NSID__"><OBJECT id=Bind_1 
    style="Z-INDEX: 107; LEFT: 241px; POSITION: absolute; TOP: 3px" 
    classid=clsid:9C9AB433-EA85-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
	<PARAM NAME="DataID" VALUE="ds_1">
	<PARAM NAME="BindInfo" VALUE="
	   <C>Col=proj_content Ctrl=tx_proj_content Param=value Enable=enable</C>
	   <C>Col=head_content Ctrl=tx_head_content Param=value Enable=enable</C>
          ">
 </OBJECT></comment> <script> __ws__(__NSID__);</script>
</div>
</BODY></HTML>
