<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- **************************************************************	-->
<!-- 1. 프로그램 id   : m_plan_1h.html											-->
<!-- 2. 유형(시나리오): 조회및 입력												-->
<!-- 3. 기 능 정 의   : 자재소요계획입력  		                      	-->
<!-- 4. 변 경 이 력   : 김동우 작성												-->
<!-- 5. 관련프로그램  :																-->
<!-- 6. 특 기 사 항   :																-->
<!-- *************************************************************	-->
<HTML><HEAD>
<META http-equiv=Content-Type content="text/html; charset=ks_c_5601-1987">
<META content="MSHTML 6.00.2716.2200" name=GENERATOR>
<LINK rel="stylesheet" type="text/css" href="../../../erpw.css">
<SCRIPT SRC="../../../comm_function/comm_function.js"></SCRIPT> 
<SCRIPT SRC="../../../comm_function/comm_calendar.js"></SCRIPT> 
<SCRIPT SRC="../../../comm_function/comm_wid.js"></SCRIPT>
<SCRIPT language=JavaScript>
// <LINK rel="stylesheet" type="text/css" href="../../../comm_function/env.css">
var gs_home = top.frames['security'].gs_home.value
var is_dept_code = top.frames['security'].gs_dept_code.value
var is_dept_name = top.frames['security'].gs_dept_name.value
var is_work_date = top.frames['security'].gs_sysdate.value
var il_screen = 1
var il_amt    = 0

var is_ds_1_addr = 'm_plan_1q.jsp?arg_dept_code='                        //청구 목록 
var is_ds_2_addr = 'm_plan_detail_1q.jsp?arg_dept_code='                     //청구내역
var is_ds_3_addr = 'm_calendar_yymm_1q.jsp?arg_from='                     //년도테이블
var is_tr_1_addr = gs_home + '/const/m_web/01/m_plan_1tr.jsp'
var is_tr_2_addr = gs_home + '/const/m_web/01/m_plan_detail_1tr.jsp'
</SCRIPT>
<!-- ======================================================================= -->
<!--                                 Function                                -->
<!-- ======================================================================= -->
<SCRIPT language=JavaScript>
//------------------------------------------------------------------------
function btnquery_onclick()                     // 조회  
//------------------------------------------------------------------------
{
	if (il_screen > 1){
		div_btnquery_onclick()
		return
	}   
	ds_1.DataID = is_ds_1_addr + is_dept_code
	ds_1.SyncLoad=true
	ds_1.Reset()
	div_btnquery_onclick()

}
//-----------------------------------------------------------------------
function Fn_SetColumn()   // 커서위치 세팅
//-----------------------------------------------------------------------
{
	gd_1.Focus();
	gd_1.SetColumn("mtrcode");
}

//-----------------------------------------------------------------------
function init_move()                       // 초기값 세팅 
//------------------------------------------------------------------------
{
	ds_1.NameValue(ds_1.RowPosition,"dept_code") = is_dept_code
	ds_1.NameValue(ds_1.RowPosition,"ditag") = '1'

	material_search()
	Fn_SetColumn()
} 

//-----------------------------------------------------------------------
function btnadd_onclick()                       // 추가 
//------------------------------------------------------------------------
{
	if  (is_dept_code == "") {
		alert("현장을 선택하십시요(검색을 누르십시요)")
		return
	 }     

	if (il_screen > 1) {
	   div_btnadd_onclick()
	   return
	}   
	btninsert_onclick()
}
//-----------------------------------------------------------------------
function btninsert_onclick()                    // 삽입
//-----------------------------------------------------------------------
{
	if  (is_dept_code == "") {
		alert("현장을 선택하십시요(검색을 누르십시요)")
		return
	}     
	if (il_screen > 1) {
		div_btninsert_onclick()
		return
	}  
	if  (ds_1.CountRow > 0) { 
		ds_1.RowPosition=1
		ds_1.InsertRow(ds_1.RowPosition)
	}    
	else {
		ds_1.AddRow()     
	}
	init_move()
}
//------------------------------------------------------------------------
function btndelete_onclick()                    // 삭제 
//------------------------------------------------------------------------
{
	if (il_screen > 1) {
		div_btndelete_onclick()
		return
	}
	if (ds_2.CountRow > 0) {
		alert("하위에 자료가있어 삭제할 수 없습니다")
		return
  	}
	if (ds_2.CountRow == 0) {
	    if (ds_2.IsUpdated) {
		    alert("하위에서 삭제된 자료를 먼저 저장하셔야 합니다")
		    il_screen = 2
	     	return
	    } 	
  	}
  	ds_1.DeleteRow(ds_1.RowPosition)
}
//---------------------------------------------------------------------------
function btnsave_onclick()                       // 저장
//---------------------------------------------------------------------------
{
	if (il_screen > 1) {
		div_btnsave_onclick()
		return
	}   
	if (ds_1.IsUpdated){
		if  (confirm("변경되었습니다 저장하시겠습니까?"))
		tr_1.Post()
	}
}
//----------------------------------------------------------------------------
function btncancel_onclick()                     // 취소
//---------------------------------------------------------------------------- 
{
	if (il_screen > 1) {
		div_btncancel_onclick()
		return
	}   
	ds_1.Undo(ds_1.RowPosition)
}
//-----------------------------------------------------------------------
function div_Fn_SetColumn()   // 커서위치 세팅
//-----------------------------------------------------------------------
{
	gd_2.Focus();
	gd_2.SetColumn("requestdetailseq");
}

//----------------------------------------------------------------------
function div_init_move()                         //하위 공통 initial move
//----------------------------------------------------------------------
{
	ds_2.NameValue(ds_2.RowPosition,"dept_code") = is_dept_code
	ds_2.NameValue(ds_2.RowPosition,"mtrcode")   = ds_1.NameValue(ds_1.RowPosition,"mtrcode")
	ds_2.NameValue(ds_2.RowPosition,"ditag")     = ds_1.NameValue(ds_1.RowPosition,"ditag")
	div_Fn_SetColumn()
}
//------------------------------------------------------------------------
function div_btnquery_onclick()                     // 하위 조회  
//------------------------------------------------------------------------
{
	if (ds_1.CountRow < 1) {
		ds_2.ClearData()	
		return
	}
	
	ds_2.DataID = is_ds_2_addr +  is_dept_code + "&arg_code=" + ds_1.NameValue(ds_1.RowPosition,"mtrcode")+
					  "&arg_ditag=" + ds_1.NameValue(ds_1.RowPosition,"ditag")
	ds_2.SyncLoad=true
	ds_2.Reset()
}
//-----------------------------------------------------------------------
function div_btnadd_onclick()                    //하위 추가
//-----------------------------------------------------------------------
{
	if (ds_1.NameValue(ds_1.RowPosition,"mtrcode") == '') return
	ds_2.AddRow()
	div_init_move()
}
//-----------------------------------------------------------------------
function div_btninsert_onclick()                    //하위 삽입.
//-----------------------------------------------------------------------
{
	if (ds_1.NameValue(ds_1.RowPosition,"mtrcode") == '') return
	ds_2.InsertRow(ds_2.RowPosition)
	div_init_move()
}

//------------------------------------------------------------------------
function div_btndelete_onclick()                //하위 삭제
//------------------------------------------------------------------------
{
	if (ds_1.NameValue(ds_1.RowPosition,"mtrcode") == '') return
	
	if  (gd_2.MultiRowSelect){               // multi row select 일 경우
		for (i=ds_2.CountRow ;i >0 ;i--)
		{
			if (ds_2.RowMark(i) == 1)
			       ds_2.DeleteRow(i)
		}  
		if  (ds_2.RowPosition != 0)          
			ds_2.MarkRows(ds_2.RowPosition,ds_2.RowPosition)  //삭제작업완료후 MARK
	}
	else
		ds_2.DeleteRow(ds_2.RowPosition)  
}
//---------------------------------------------------------------------------
function div_btnsave_onclick()                  //하위 저장 
//---------------------------------------------------------------------------
{
	var ls_chk=0
	
	tr_2.Action = is_tr_2_addr
	
	if ((ds_2.IsUpdated) || (ds_1.IsUpdated)) {
		if  (confirm("변경되었습니다 저장하시겠습니까?")){
		      if (ds_1.IsUpdated) 
		         tr_1.Post()
		   	for (i=1; i<= ds_2.CountRow; i++){
			   	if (ds_2.NameValue(i,"month") == ''){
		   			ls_chk++
	   			}
	   		}
	   		if (ls_chk == 0) {
		       		tr_2.Post()
	     		}
     			else {
			   		alert("계획년월을 반드시 입력하십시오 \n        저장되지않았습니다.")
			   		return false
	       	}
	  	}
	}
  return true	
}
//----------------------------------------------------------------------------
function div_btncancel_onclick()                     // 취소
//---------------------------------------------------------------------------- 
{
	ds_2.Undo(ds_2.RowPosition)
}


//----------------------------------------------------------------------------
function btnexit_onclick(ls_arg)                 // 종료 
//-----------------------------------------------------------------------------
{
	if (ds_1.IsUpdated) {
		if  (confirm("변경되었습니다 저장하시겠습니까?")) 
		{  //저장 routine
		}   
	
	}     
	top.frames['main_ct'].location.href(ls_arg)
	top.frames['main_title'].div_r.style.visibility="hidden"             
	top.frames['main_title'].div_u.style.visibility="hidden"             
	
	// top.frames['main_ct'].window.close()     
}
//---------------------------------------------------------------------------
function dept_code_find()                       //현장 찾기 
//---------------------------------------------------------------------------
{
	result = f_dept_code_find(dept_name.value)
	if (result==false)return
	
	is_dept_code = top.frames['security'].gs_dept_code.value
	is_dept_name = top.frames['security'].gs_dept_name.value

	dept_name.value = is_dept_name
	btnquery_onclick()
}   
//--------------------------------------------------------------------------
function   bid_process()
//----------------------------------------------------------------
{
	if  (confirm("실행내역의 자재수량,금액을 집계하시겠습니까? \n   기존자료는 모두 삭제됩니다")) {
		ds_spcall.DataID = 'm_create_bom_procedure.jsp?arg_dept_code=' + is_dept_code 
		ds_spcall.SyncLoad = true
		ds_spcall.reset()
		btnquery_onclick()
		alert('정상처리되었습니다...')
	}
}  
//--------------------------------------------------------------------------
function   div_process()
//----------------------------------------------------------------
{
	var ls_start_date,ls_end_date,ls_term,li_ds1_cnt,li_ds3_cnt,i,j
	var ll_qty,ll_amt,ls_mtrcode,ls_ditag,ll_tmp_qty,ll_tmp_amt,ll_sav_qty,ll_sav_amt
	
	li_ds1_cnt = ds_1.CountRow
	if (li_ds1_cnt < 1 ) {
		alert("작업할 내용이 없습니다")
		return
	}

   ll_cnt = f_select_q("select to_char(chg_const_start_date,'yyyy.mm.dd') select_1, " + 
                        " to_char(chg_const_end_date,'yyyy.mm.dd') select_2, " + 
                        " chg_const_term select_3 " +
                        " from z_code_dept where dept_code = '" + is_dept_code + "'")
	ls_start_date = ds_select.NameValue(1,"select_1")
   ls_end_date   = ds_select.NameValue(1,"select_2")
   ls_term       = ds_select.NameValue(1,"select_3")

	if(ls_start_date == '' || ls_end_date == ''){
		alert("공사기간이 등록되어있지 않아 작업할 수 없습니다")
		return
	}
	if (ls_term < 1) {
		alert("공사기간이 1개월이내이므로 작업할 수 없습니다")
		return
	}

   if (ds_1.NameValue(i,"bd_qty") == 0) {
      alert('수량이 0 이므로 작업할 수 없습니다')
      return
   }   


	ls_start_date = ls_start_date.substr(0,7) + '.01'
	ls_end_date = ls_end_date.substr(0,7) + '.01'

	if (confirm("기존에 입력된 월별 자료가 삭제됩니다 계속할까요?")){
		ls_mtrcode = ds_1.NameValue(ds_1.RowPosition,"mtrcode")
		ls_ditag   = ds_1.NameValue(ds_1.RowPosition,"ditag")

		arg_cmd = " DELETE FROM M_MONTH_PLAN  " +
			       " WHERE DEPT_CODE = " + "'" + is_dept_code + "'" +
      		    "    AND MTRCODE = " + "'" + ls_mtrcode + "'" + 
      		    "    AND DITAG = " + "'" + ls_ditag + "'"  
		f_update_sql(arg_cmd)
			
		ds_3.DataID = is_ds_3_addr + ls_start_date + "&arg_to=" + ls_end_date
		ds_3.SyncLoad=true
		ds_3.Reset()
 	
		li_ds3_cnt = ds_3.CountRow

		<!-- 해당 자재의 월별 계획만 처리 것으로 변경함  -->		
		i = ds_1.RowPosition
		
			ll_qty = ds_1.NameValue(i,"bd_qty")
			ll_amt = ds_1.NameValue(i,"bd_amt")
			ls_mtrcode = ds_1.NameValue(i,"mtrcode")
			ls_ditag   = ds_1.NameValue(i,"ditag")

<!-- 총수량이 100 이하면 소수 2자리로 분할,  500이하면 소수 1자리로 분할 -->			
			if (ll_qty <= 100) {     
				ll_tmp_qty = parseInt(ll_qty * 100 / li_ds3_cnt)
				ll_tmp_qty = ll_tmp_qty / 100
			}					
			else if (ll_qty <= 500)  {
				ll_tmp_qty = parseInt(ll_qty * 10 / li_ds3_cnt)
				ll_tmp_qty = ll_tmp_qty / 10
			}					
			else {
				ll_tmp_qty = parseInt(ll_qty / li_ds3_cnt)
			}					

			ll_tmp_amt = Math.round(ll_tmp_qty * Math.round(ll_amt / ll_qty ))  

			ll_sav_qty = 0
			ll_sav_amt = 0
			for (j=1;j <= li_ds3_cnt ;j++)
			{
				ls_date = ds_3.NameValue(j,"c_yymm")
				if (j == li_ds3_cnt) {
					ll_tmp_qty = ll_qty - ll_sav_qty
					ll_tmp_amt = ll_amt - ll_sav_amt
				}

				arg_cmd = " INSERT INTO M_MONTH_PLAN  " +
				  			 " VALUES ( " + "'" + is_dept_code + "'" + "," + "'" + ls_mtrcode + "'" + "," +
				  			 "'" + ls_ditag + "'" + "," + "'" + ls_date + "'" + ",0,0," + ll_tmp_qty + 
				  			 "," + ll_tmp_amt + ")"
				  			 
				f_update_sql(arg_cmd)
				ll_sav_qty = ll_sav_qty + ll_tmp_qty
				ll_sav_amt = ll_sav_amt + ll_tmp_amt
			}
		  
		btnquery_onclick()
	}
}  
//------------------------------------------------------------------------
function keyDown()                       //검색어 입력후 enter를 쳤을경우
//------------------------------------------------------------------------
{
	if (window.event.keyCode == 13) { 
		dept_code_find();
	} 
}
//------------------------------------------------------------------------
function material_search()                       //자재 코드 찾기
//------------------------------------------------------------------------
{
   row = ds_1.RowPosition
	var result;
	var array = new Array();
		result = window.showModalDialog(gs_home + "/const/m_web/00/m_code_material_find_1h.html","","dialogWidth:550px;dialogHeight:510px");
		if(result == "") return;
		array = result.split("@");
		ds_1.NameString(row,"mtrcode") = array[0];   // 코드 
		ds_1.NameString(row,"name") = array[1];  // 명칭
		ds_1.NameString(row,"ssize") = array[2];     // 규격
		ds_1.NameString(row,"unitcode") = array[3];     // 단위
		ds_1.NameString(row,"ditag") = array[4];     // 직/간접재구분
		return
}	

//------------------------------------------------------------------------
function get_focus(focus) // gd가 포커스를 받을때 동작.
//------------------------------------------------------------------------
{
	il_screen = focus
}

//---------------------------------------------------------------------------
function window_onload()                      // window open event
//---------------------------------------------------------------------------
{
  if (f_reject_window()) return 
   top.frames['main_title'].mouse_over()
	tr_1.Action = is_tr_1_addr
	tr_2.Action = is_tr_2_addr
	dept_name.value = is_dept_name
	btnquery_onclick()
}
//---------------------------------------------------------------------------
function rate_calc()                  // 요율계산
//---------------------------------------------------------------------------
{
   if (( rate.text > 100)|| ( rate.text < 0 ))
	{
	   alert('요율이 유효하지 않습니다.')
		return ;
	}

	var ls_start_date,ls_end_date,ls_term,li_ds1_cnt,li_ds3_cnt,i,j
   var total_amt=0 , total_rate=0 , total_qty = 0 , tmp_amt = 0 
   var i_cnt = 0

//-- validation check --	
	li_ds1_cnt = ds_1.CountRow
	if (li_ds1_cnt < 1 ) {
		alert("작업할 내용이 없습니다")
		return
	}

   ll_cnt = f_select_q("select to_char(chg_const_start_date,'yyyy.mm.dd') select_1, " + 
                        " to_char(chg_const_end_date,'yyyy.mm.dd') select_2, " + 
                        " chg_const_term select_3 " +
                        " from z_code_dept where dept_code = '" + is_dept_code + "'")
	ls_start_date = ds_select.NameValue(1,"select_1")
   ls_end_date   = ds_select.NameValue(1,"select_2")
   ls_term       = ds_select.NameValue(1,"select_3")

	if(ls_start_date == '' || ls_end_date == ''){
		alert("공사기간이 등록되어있지 않아 작업할 수 없습니다")
		return
	}
	if (ls_term < 1) {
		alert("공사기간이 1개월이내이므로 작업할 수 없습니다")
		return
	}

   if (ds_1.NameValue(i,"bd_qty") == 0) {
      alert('수량이 0 이므로 작업할 수 없습니다')
      return
   }   


	for (i=1  ;i <= ds_2.CountRow  ;i++)
	{
		if (ds_2.RowMark(i) == 1)
		{
			ds_2.NameValue(i,'this_bd_qty')	= 0 
			ds_2.NameValue(i,'this_bd_amt')	= 0 
			i_cnt++
		}
		else
		{
			tmp_amt +=  ds_2.NameValue(i,'this_bd_amt')		
		}
	}	
 
   total_rate = ( 1 - ( tmp_amt / ds_1.NameValue(ds_1.RowPosition,'bd_amt') ) )
	tatal_qty = ds_1.NameValue(ds_1.RowPosition,'bd_qty')

   
//	alert(tmp_amt +'/'+ ds_1.NameValue(ds_1.RowPosition,'bd_amt') +'='+total_rate );
   
	
	for (i=1  ;i <= ds_2.CountRow  ;i++)
	{

		if (ds_2.RowMark(i) == 1)
		{
//		alert(i_cnt);
		   if ( total_rate > 0 )
		   {
				if ( i_cnt == 1 )  
				{
					ds_2.NameValue(i,'this_bd_qty')	= Math.round(total_rate * ds_1.NameValue(ds_1.RowPosition,'bd_qty') * 100000 ) / 100000 
					ds_2.NameValue(i,'this_bd_amt')	= Math.round(total_rate * ds_1.NameValue(ds_1.RowPosition,'bd_amt') * 100000 ) / 100000 
					return ; 
				}
				
			   if ( ( rate.text / 100 )  < total_rate  )
			   {
//			      alert( ( rate.text / 100 )  +":"+  total_rate  ) ;
					ds_2.NameValue(i,'this_bd_qty')	= Math.round(( rate.text / 100 ) * ds_1.NameValue(ds_1.RowPosition,'bd_qty')* 100000 ) / 100000 
					ds_2.NameValue(i,'this_bd_amt')	= Math.round(( rate.text / 100 ) * ds_1.NameValue(ds_1.RowPosition,'bd_amt')* 100000 ) / 100000 

					total_rate -= (rate.text / 100 )  
				}
				else
				{
//			      alert( ( rate.text / 100 )  +":"+  total_rate  ) ;
					ds_2.NameValue(i,'this_bd_qty')	= Math.round(total_rate * ds_1.NameValue(ds_1.RowPosition,'bd_qty') * 100000 ) / 100000 
					ds_2.NameValue(i,'this_bd_amt')	= Math.round(total_rate * ds_1.NameValue(ds_1.RowPosition,'bd_amt') * 100000 ) / 100000 
					
					total_rate -= (rate.text / 100 ) 				
				}
			}
			else
			{

				ds_2.NameValue(i,'this_bd_qty')	= 0 
				ds_2.NameValue(i,'this_bd_amt')	= 0				
			}	
			
			i_cnt--  // 멀티셀레트 카운터			
		}
		else
		{

		}
	}			
	  
   

}
</SCRIPT>
<!-- ======================================================================= -->
<!--                                   Event                                 -->
<!-- ======================================================================= -->
<script language="javascript" for=gd_1 event=OnPopup(row,colid,data)>
	var result;
	var array = new Array();
	if  (colid == "mtrcode") {                                //자재코드 찾기 
		result = window.showModalDialog(gs_home + "/const/m_web/00/m_code_material_find_1h.html","","dialogWidth:550px;dialogHeight:510px");
		if(result == "") return;
		array = result.split("@");
		ds_1.NameString(row,"mtrcode") = array[0];   // 코드 
		ds_1.NameString(row,"name") = array[1];  // 명칭
		ds_1.NameString(row,"ssize") = array[2];     // 규격
		ds_1.NameString(row,"unitcode") = array[3];     // 단위
		ds_1.NameString(row,"ditag") = array[4];     // 직/간접재구분
		return
	}
</SCRIPT>

<script language=JavaScript for=gd_1 event=OnKeyPress(kcode)>
	if (kcode == 13) {
	    if (ds_1.RowPosition == ds_1.CountRow)  
	        btnadd_onclick()
	    else     
	        ds_1.RowPosition++
	}
</SCRIPT>
<script language=JavaScript for=gd_2 event=OnKeyPress(kcode)>
	if (kcode == 13) {
	    if (ds_2.RowPosition == ds_2.CountRow)  
	        div_btnadd_onclick()
	    else     
	        ds_2.RowPosition++
	}
</SCRIPT>
<script language=JavaScript for=ds_1 event=CanRowPosChange(row)>
	if (ds_2.IsUpdated){
		return div_btnsave_onclick()
	}
</SCRIPT>
	
<SCRIPT language=JavaScript event=OnRowPosChanged(row) for=ds_1>
{
	if  (row < 1) return;
	div_btnquery_onclick()  
}  
</SCRIPT>
<SCRIPT language=JavaScript for=ds_1 event=OnLoadError()>
  alert("Error Code(ds_1) : " + ds_1.ErrorCode + "\n" + "Error Message : " + ds_1.ErrorMsg + "\n");
</SCRIPT>

<SCRIPT language=JavaScript for=tr_1 event=OnFail()>
  alert("Error Code(tr_1) : " + tr_1.ErrorCode + "\n" + "Error Message : " + tr_1.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_2 event=OnLoadError()>
  alert("Error Code(ds_2) : " + ds_2.ErrorCode + "\n" + "Error Message : " + ds_2.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_3 event=OnLoadError()>
  alert("Error Code(ds_3) : " + ds_3.ErrorCode + "\n" + "Error Message : " + ds_3.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_spcall event=OnLoadError()>
  alert("Error Code(ds_spcall) : " + ds_spcall.ErrorCode + "\n" + "Error Message : " + ds_spcall.ErrorMsg + "\n");
</SCRIPT>

<SCRIPT language=JavaScript for=tr_2 event=OnFail()>
  alert("Error Code(tr_2) : " + tr_2.ErrorCode + "\n" + "Error Message : " + tr_2.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_update event=OnLoadError()>
  alert("Error Code(ds_update) : " + ds_update.ErrorCode + "\n" + "Error Message : " + ds_update.ErrorMsg + "\n");
</SCRIPT>
<script language=JavaScript for=tr_1 event=OnSuccess()>
 gf_key_copy("ds_1","mtr_code@ditag@key_mtr_code@key_ditag")    // key값을 보조 key값으로 복사함. 
</SCRIPT> 
<script language=JavaScript for=tr_2 event=OnSuccess()>
 gf_key_copy("ds_2","month@key_month")    // key값을 보조 key값으로 복사함. 
</SCRIPT> 
<!-- 월별 수량입력시 금액 자동 계산(금액 입력시에는 수량 계산 안함) -->
<SCRIPT language=JavaScript  event=OnColumnChanged(row,colid) for=ds_2>
	var ll_qty,ll_chk_qty
	if (colid == "temp_month") {
		ds_2.NameValue(row,"month") = ds_2.NameValue(row,"temp_month") + '.01'
	} 

	if (colid == "this_bd_qty") {
		ll_qty = ds_2.NameSum('this_bd_qty',0,0)
		ll_chk_qty = ds_1.NameValue(ds_1.RowPosition,'bd_qty')
		if (ll_qty > ll_chk_qty) {
			alert('실행수량을 초과하실 수 없습니다...')
			ds_2.NameValue(row,'this_bd_qty') = ds_2.OrgNameValue(row,'this_bd_qty')
			return
		}
		il_amt = Math.round ( ds_1.NameValue(ds_1.RowPosition,"bd_amt") / ds_1.NameValue(ds_1.RowPosition,"bd_qty") )
				       * ds_2.NameValue(ds_2.RowPosition,"this_bd_qty") 
		ds_2.NameValue(ds_2.RowPosition,"this_bd_amt") = Math.round(il_amt)
	}
	if (colid == "this_bd_amt") {
		ll_qty = ds_2.NameSum('this_bd_amt',0,0)
		ll_chk_qty = ds_1.NameValue(ds_1.RowPosition,'bd_amt')
		if (ll_qty > ll_chk_qty) {
			alert('실행금액을 초과하실 수 없습니다...')
			ds_2.NameValue(row,'this_bd_amt') = ds_2.OrgNameValue(row,'this_bd_amt')
			return
		}
		il_amt = Math.round ( ds_1.NameValue(ds_1.RowPosition,"bd_amt") / ds_1.NameValue(ds_1.RowPosition,"bd_qty") )
				       * ds_2.NameValue(ds_2.RowPosition,"this_bd_qty") 
		ds_2.NameValue(ds_2.RowPosition,"this_bd_amt") = Math.round(il_amt)
	}
	

</SCRIPT>




<!-- ======================================================================= -->
<!--                                 Component                               -->
<!-- ======================================================================= -->
<comment id="__NSID__"><OBJECT id=ds_1 
    style="Z-INDEX: 108; LEFT: 319px; POSITION: absolute; TOP: 7px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT></OBJECT></comment> <script> __ws__(__NSID__);</script>

<comment id="__NSID__"><OBJECT id=ds_2 
    style="Z-INDEX: 108; LEFT: 319px; POSITION: absolute; TOP: 7px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT></OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=ds_3 
    style="Z-INDEX: 108; LEFT: 319px; POSITION: absolute; TOP: 7px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT></OBJECT></comment> <script> __ws__(__NSID__);</script>

<comment id="__NSID__"><Object id=ds_select
	style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
	classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49> </OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=ds_update
	style="Z-INDEX: 103; LEFT: 169px; POSITION: absolute; TOP: 3px" 
	classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49></OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=ds_spcall 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49>
</OBJECT></comment> <script> __ws__(__NSID__);</script>

<comment id="__NSID__"><OBJECT id=tr_1 
    style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
    classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:m_plan_1tr=ds_1)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>
	
<comment id="__NSID__"><OBJECT id=tr_2 
    style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
    classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:m_plan_detail_1tr=ds_2)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>
</HEAD>
<!-- ======================================================================= -->
<!--                                   Body                                  -->
<!-- ======================================================================= -->

<BODY style="FONT-SIZE: 12px; margin: 0;"  onload=setTimeout('window_onload()',1) oncontextmenu="return false" >
<div class=main_div>
<table width="100%"  height="100%"  BORDER="0"    CELLSPACING="0"  align="center"   style="FONT-SIZE: 12px; ">
	<tr height="20px">
		<td class=td_green colspan="2">
			<table border="0" width="100%" height="100%" cellspacing="0" cellpadding="0" class=main_table>
				<tr>
					<td width="15px"><img src="../../../image/bullet3.gif"></td>
					<td width="43px" class=font_green_bold>현장명</td>
					<td width="166px">
						<INPUT  id=dept_name  ondblclick="dept_name.select()" onfocus="dept_name.select()"  style="ime-mode:active" style=" FONT-SIZE: 12px;" size="25" onkeyDown="keyDown()">
					</td>
					<td width="60px">
						<INPUT  type=button  class="img_btnFind"  value=검색 onclick=dept_code_find() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;">
					</td>
					<td width="200"></td>
					<td width="15px"><img src="../../../image/bullet3.gif"></td>
					<td width="43px" class=font_green_bold>요율</td>
					<td width="40">
						<comment id="__NSID__">
						<object id=rate classid=CLSID:E6876E99-7C28-43AD-9088-315DC302C05F style="background-color:white; font-size: 12px; width:30px" >
							<param name=Text			value="0">
							<param name=Alignment		value=2>
							<param name=Numeric			value=true>
							<param name=MaxLength		value=3>
						</object></comment> <script> __ws__(__NSID__);</script>
					</td>
					<td width="17" class=font_green_bold align="center">%</td>
					<td width="60px">
						<INPUT  type=button  class="img_btn2_1" value=적용 onclick=rate_calc() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;">
					</td>
					<td align="right">
						<INPUT  id=bt_bid_sum type=button  class="img_btn4_1"  value=실행집계 onclick=bid_process() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;">
						<INPUT  id=bt_div_process type=button  class="img_btn4_1"  value=균등분할 onclick=div_process() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"> &nbsp;&nbsp;
					</td>
					<td width="50px">
	 				</td>
				</tr>                 
	      </table>
		</td>
	</tr>
	<tr width="100%" height="100%">
		<td width="75%">
			<comment id="__NSID__"><OBJECT id=gd_1 onfocus="get_focus(1)"
			    style="FONT-SIZE: 12px; Z-INDEX: 105; WIDTH:100%;  HEIGHT: 100%" 
			    classid=clsid:1F57AEAD-DB12-11D2-A4F9-00608CEBEE49>
				<PARAM NAME="MultiRowSelect" VALUE="-1">
				<PARAM NAME="AllShowEdit" VALUE="-1">
				<PARAM NAME="AutoInsert" VALUE="-1">
			   <PARAM NAME="BorderStyle"  VALUE=1>
				<PARAM NAME="Editable" VALUE="-1">
				<PARAM NAME="ColSizing" VALUE="-1">
				<PARAM NAME="DataID" VALUE="ds_1">
				<PARAM NAME="Format" VALUE=" 
				  <C> Name='자재코드' ID=mtrcode  EditStyle=Popup  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=70 </C>
				  <C> Name='명칭' ID=name Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Width=175 </C> 
				  <C> Name='규격' ID=ssize Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=150 </C> 
				  <C> Name='단위' ID=unitcode Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=50 </C> 
				  <C> Name='구분' ID=ditag Align=Center BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Width=45 
				  		EditStyle=Combo Data='1:직접재,2:간접재'</C>
				  <C> Name='수량' ID=bd_qty    BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=75 </C> 
				  <C> Name='단가' ID=comp    BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=70 
			                Value={bd_amt/bd_qty}</C>
				  <C> Name='금액' ID=bd_amt    BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=80 </C> 
			      ">
			</OBJECT></comment> <script> __ws__(__NSID__);</script>
		</td>
		<td width="24%">
			<comment id="__NSID__"><OBJECT id=gd_2 onfocus="get_focus(2)"
			    style="FONT-SIZE: 12px; Z-INDEX: 105; WIDTH:100%;  HEIGHT: 100%" 
			    classid=clsid:1F57AEAD-DB12-11D2-A4F9-00608CEBEE49>
				<PARAM NAME="MultiRowSelect" VALUE="-1">
				<PARAM NAME="AllShowEdit" VALUE="-1">
				<PARAM NAME="Editable" VALUE="-1">
			   <PARAM NAME="BorderStyle"  VALUE=1>
				<PARAM NAME="ColSizing" VALUE="-1">
				<param name="ViewSummary"    value=1>
				<PARAM NAME="DataID" VALUE="ds_2"> 
				<PARAM NAME="Format" VALUE=" 
					<C> Name='년월' ID=temp_month Align=Center  EditLimit=7 BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=60 
			          SumText='합 계'  SumColor=Black SumBgColor=Pink </C> 
					<C> Name='수량' ID=this_bd_qty BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=80 
							SumText=@sum  SumColor=Black SumBgColor=Pink </C> 
					<C> Name='금액' ID=this_bd_amt BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Width=80 
							SumText=@sum  SumColor=Black SumBgColor=Pink </C> 
			      ">
			</OBJECT></comment> <script> __ws__(__NSID__);</script>
		</td>
	</tr>
</table>
</DIV>
</BODY></HTML>
