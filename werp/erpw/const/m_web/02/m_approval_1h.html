<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- **************************************************************	-->
<!-- 1. 프로그램 id   : m_approval_1h.html				-->
<!-- 2. 유형(시나리오): 조회및 입력					-->
<!-- 3. 기 능 정 의   : 자재품의내역입력  		                -->
<!-- 4. 변 경 이 력   : 김동우 작성					-->
<!-- 5. 관련프로그램  :							-->
<!-- 6. 특 기 사 항   :							-->
<!-- *************************************************************	-->
<HTML><HEAD>
<META http-equiv=Content-Type content="text/html; charset=ks_c_5601-1987">
<META content="MSHTML 6.00.2716.2200" name=GENERATOR>
<LINK rel="stylesheet" type="text/css" href="../../../erpw.css">
<SCRIPT SRC="../../../comm_function/comm_function.js"></SCRIPT> 
<SCRIPT SRC="../../../comm_function/comm_calendar.js"></SCRIPT> 


<SCRIPT SRC="../../../comm_function/comm_wid.js"></SCRIPT>

<SCRIPT SRC="../../../comm_function/comm_wid.js"></SCRIPT>
<SCRIPT language=JavaScript>
// <LINK rel="stylesheet" type="text/css" href="../../../comm_function/env.css">
var gs_home = top.frames['security'].gs_home.value
var gs_name = top.frames['security'].gs_name.value
var gs_user_id = top.frames['security'].user_id.value
var gs_password = top.frames['security'].gs_password.value

var is_dept_code,is_long_name = ''
var is_fr_date      = top.frames['security'].gs_sysdate.value
var is_to_date      = top.frames['security'].gs_sysdate.value
var is_work_date = top.frames['security'].gs_sysdate.value
var il_screen = 1
var is_filter,is_price_class
var is_sort      = " "

var is_ds_1_addr = 'm_approval_1q.jsp?arg_date='                        //품의 목록 
var is_ds_2_addr = 'm_approval_detail_1q.jsp?arg_dept_code='                     //품의내역
var is_ds_3_addr = 'm_approval_2q.jsp?arg_dept_code='                     //선정업체
var is_ds_4_addr = 'm_approval_work_1q.jsp?arg_date='                     //작업용
var is_tr_1_addr = gs_home + '/const/m_web/02/m_approval_1tr.jsp'
var is_tr_2_addr = gs_home + '/const/m_web/02/m_approval_detail_1tr.jsp'
var is_tr_3_addr = gs_home + '/const/m_web/02/m_approval_2tr.jsp'
var is_ds_seq_addr = gs_home + '/const/m_web/00/m_spec_unq_no_1q.jsp'                 // seq_no구하기 
</SCRIPT>
<!-- ======================================================================= -->
<!--                                 Function                                -->
<!-- ======================================================================= -->
<SCRIPT language=JavaScript>
//------------------------------------------------------------------------
function btnquery_onclick()                     // 조회  
//------------------------------------------------------------------------
{
	ds_1.DataID = is_ds_1_addr + is_fr_date + '&arg_to_date=' + is_to_date +'&arg_dept_name=' + is_long_name
	ds_1.SyncLoad=true
	ds_1.Reset()
	div_btnquery_onclick()
}

//------------------------------------------------------------------------
function rpt_rtn1()                     //품의서
//------------------------------------------------------------------------
{
   var arg_temp, ls_date,ls_dept_code
   
   ls_date = em_approym.text
	ls_dept_code = ds_1.NameValue(ds_1.RowPosition,"dept_code")
	ls_seq  	= ds_1.NameString(ds_1.RowPosition,"approseq")
	ls_chg  	= ds_1.NameString(ds_1.RowPosition,"chg_cnt")
	ls_chg2  = ds_1.NameString(ds_1.RowPosition,"chg_cnt") - 1
	ls_code  = ds_3.NameString(ds_3.RowPosition,"sbcr_code")
	
/*	
	if(ls_chg > 1){ //1차수이상일때엔 변경품의서
   		arg_temp ="const_rpt/m_web/02r/m_chg_approval"        // 변경품의서

		//이전차수 청구번호 구하기
   		ll_cnt = f_select_q("SELECT DISTINCT B.REQUESTSEQ select_1, B.CHG_CNT select_2 FROM M_APPROVAL_DETAIL A, M_REQUEST_DETAIL B " +
						"WHERE " +
						"	A.DEPT_CODE = '" + ls_dept_code + "' " +
						"AND A.APPROYM = '" + ls_date + "' " +
						"AND A.APPROSEQ = " + ls_seq +
						"AND A.CHG_CNT = " + ls_chg2 +
						"AND A.DEPT_CODE = B.DEPT_CODE AND A.REQUEST_CHG_CNT = B.CHG_CNT AND A.REQUEST_UNQ_NUM = B.REQUEST_UNQ_NUM")
		if (ll_cnt > 0) {
			ls_reqseq  = ds_select.NameValue(ds_select.RowPosition,"select_1")
			ls_req_chg2 = ds_select.NameValue(ds_select.RowPosition,"select_2")
		}
		//당회차수 청구번호 구하기
   		ll_cnt = f_select_q("SELECT DISTINCT B.REQUESTSEQ select_1, B.CHG_CNT select_2 FROM M_APPROVAL_DETAIL A, M_REQUEST_DETAIL B " +
						"WHERE " +
						"	A.DEPT_CODE = '" + ls_dept_code + "' " +
						"AND A.APPROYM = '" + ls_date + "' " +
						"AND A.APPROSEQ = " + ls_seq +
						"AND A.CHG_CNT = " + ls_chg +
						"AND A.DEPT_CODE = B.DEPT_CODE AND A.REQUEST_CHG_CNT = B.CHG_CNT AND A.REQUEST_UNQ_NUM = B.REQUEST_UNQ_NUM")
		if (ll_cnt > 0) {
			ls_req_chg = ds_select.NameValue(ds_select.RowPosition,"select_2")
		}
		arg_temp = arg_temp + "&RptParams=" + ls_dept_code +
                "&RptParams=" + ls_date + "&RptParams=" + ls_seq +
                "&RptParams=" + ls_chg  + "&RptParams=" + ls_chg2 +
                "&RptParams=" + ls_reqseq  + "&RptParams=" + ls_req_chg + "&RptParams=" + ls_req_chg2

	}else{
		arg_temp ="const_rpt/m_web/02r/m_approval"     // 품의서
		//당회차수 청구번호 구하기
   		ll_cnt = f_select_q("SELECT DISTINCT B.REQUESTSEQ select_1, B.CHG_CNT select_2 FROM M_APPROVAL_DETAIL A, M_REQUEST_DETAIL B " +
						"WHERE " +
						"	A.DEPT_CODE = '" + ls_dept_code + "' " +
						"AND A.APPROYM = '" + ls_date + "' " +
						"AND A.APPROSEQ = " + ls_seq +
						"AND A.CHG_CNT = " + ls_chg +
						"AND A.DEPT_CODE = B.DEPT_CODE AND A.REQUEST_CHG_CNT = B.CHG_CNT AND A.REQUEST_UNQ_NUM = B.REQUEST_UNQ_NUM")
		if (ll_cnt > 0) {
			ls_reqseq  = ds_select.NameValue(ds_select.RowPosition,"select_1")
			ls_req_chg = ds_select.NameValue(ds_select.RowPosition,"select_2")
		}
		arg_temp = arg_temp + "&RptParams=" + ls_dept_code + 
                "&RptParams=" + ls_date + "&RptParams=" + ls_seq +
                "&RptParams=" + ls_chg   + 
                "&RptParams=" + ls_reqseq  + "&RptParams=" + ls_req_chg
   }             
 */
		arg_temp ="const_rpt/m_web/02r/m_approval"     // 품의서
		arg_temp = arg_temp + "&RptParams=" + ls_dept_code + 
                "&RptParams=" + ls_date + "&RptParams=" + ls_seq +
                "&RptParams=" + ls_chg  + "&RptParams=" + gs_name  
//   alert (arg_temp) ;
   f_crystal_report(arg_temp)   //보고서 호출
}
//------------------------------------------------------------------------
function rpt_rtn2()                     //발주서
//------------------------------------------------------------------------
{
   var arg_temp, ls_date,ls_dept_code
   
   ls_date = em_approym.text
	ls_dept_code = ds_1.NameValue(ds_1.RowPosition,"dept_code")
	ls_seq  	= ds_1.NameString(ds_1.RowPosition,"approseq")
	ls_chg  	= ds_1.NameString(ds_1.RowPosition,"chg_cnt")
	ls_chg2  = ds_1.NameString(ds_1.RowPosition,"chg_cnt") - 1
	ls_code  = ds_3.NameString(ds_3.RowPosition,"sbcr_code")
/*
	if(ls_chg > 1){ //1차수이상일때엔 변경품의서
   	arg_temp ="const_rpt/m_web/02r/m_chg_order"        // 발주서(변경)
	   arg_temp = arg_temp + "&RptParams=" + ls_dept_code + 
                "&RptParams=" + ls_date + "&RptParams=" + ls_seq + 
                "&RptParams=" + ls_chg + "&RptParams=" + ls_code 
	}else{
   	arg_temp ="const_rpt/m_web/02r/m_order"        // 발주서
	   arg_temp = arg_temp + "&RptParams=" + ls_dept_code + 
                "&RptParams=" + ls_date + "&RptParams=" + ls_seq +
                "&RptParams=" + ls_code 
   }
*/               
   	arg_temp ="const_rpt/m_web/02r/m_order"        // 발주서
	   arg_temp = arg_temp + "&RptParams=" + ls_dept_code + 
                "&RptParams=" + ls_date + "&RptParams=" + ls_seq +
                "&RptParams=" + ls_code 



   f_crystal_report(arg_temp)   //보고서 호출
}
//------------------------------------------------------------------------
function rpt_rtn3()                     //계약서
//------------------------------------------------------------------------
{
   var arg_temp, ls_date,ls_dept_code
   
   ls_date = em_approym.text
	ls_dept_code = ds_1.NameValue(ds_1.RowPosition,"dept_code")
	ls_seq  	= ds_1.NameString(ds_1.RowPosition,"approseq")
	ls_chg  	= ds_1.NameString(ds_1.RowPosition,"chg_cnt")
	ls_chg2  = ds_1.NameString(ds_1.RowPosition,"chg_cnt") - 1
	ls_code  = ds_3.NameString(ds_3.RowPosition,"sbcr_code")
/*	
	if(ls_chg > 1){ //1차수이상일때엔 변경계약서
	arg_temp ="const_rpt/m_web/02r/m_chg_cn_contract"        // 보고서 명   ---- 계약서
   arg_temp = arg_temp + "&RptParams=" + ls_dept_code + 
             "&RptParams=" + ls_date + "&RptParams=" + ls_seq + 
             "&RptParams=" + ls_chg + "&RptParams=" + ls_chg2 + "&RptParams=" + ls_code

	}else{ */
	arg_temp ="const_rpt/m_web/02r/m_cn_contract_1"        // 보고서 명   ---- 계약서
   arg_temp = arg_temp + "&RptParams=" + ls_dept_code + 
             "&RptParams=" + ls_date + "&RptParams=" + ls_seq + 
             "&RptParams=" + ls_chg + "&RptParams=" + ls_code
//   }             
//alert(arg_temp)   
   f_crystal_report(arg_temp)   //보고서 호출
}
//------------------------------------------------------------------------
function rpt_rtn4()                     //계약내역서
//------------------------------------------------------------------------
{
   var arg_temp, ls_date,ls_dept_code
   
   ls_date = em_approym.text
	ls_dept_code = ds_1.NameValue(ds_1.RowPosition,"dept_code")
	ls_seq  	= ds_1.NameString(ds_1.RowPosition,"approseq")
	ls_chg  	= ds_1.NameString(ds_1.RowPosition,"chg_cnt")
	ls_chg2  = ds_1.NameString(ds_1.RowPosition,"chg_cnt") - 1
	ls_code  = ds_3.NameString(ds_3.RowPosition,"sbcr_code")

	arg_temp ="const_rpt/m_web/02r/m_order_list"        // 발주서
	   arg_temp = arg_temp + "&RptParams=" + ls_dept_code + 
                "&RptParams=" + ls_date + "&RptParams=" + ls_seq +
                "&RptParams=" + ls_code 

   f_crystal_report(arg_temp)   //보고서 호출
}
//-----------------------------------------------------------------------
function Fn_SetColumn()   // 커서위치 세팅
//-----------------------------------------------------------------------
{
	tab_page_1.Focus();
	tab_page_1.SetColumn("em_approym");
}

//-----------------------------------------------------------------------
function init_move()                       // 초기값 세팅 
//------------------------------------------------------------------------
{
	ds_seq.SyncLoad=true;             // seq no 구하기
 	ds_seq.reset()

	ds_1.NameValue(ds_1.RowPosition,"dept_code") = is_dept_code
	ds_1.NameValue(ds_1.RowPosition,"approym") = is_work_date
	if  (ds_1.CountRow > 1) 
		ds_1.NameValue(ds_1.RowPosition,"approseq") = ds_1.NameValue(ds_1.RowPosition + 1,"approseq") + 1
	else      
		ds_1.NameValue(ds_1.RowPosition,"approseq") = 1
	ds_1.NameValue(ds_1.RowPosition,"chg_cnt") = 1
	ds_1.NameValue(ds_1.RowPosition,"app_tag") = '1'
	ds_1.NameValue(ds_1.RowPosition,"vattag") = '1'
	ds_1.NameValue(ds_1.RowPosition,"cash_rt") = 100
	ds_1.NameValue(ds_1.RowPosition,"requestseq")  = ds_seq.NameValue(1,"nextval")
	//Fn_SetColumn()
	fc_request_copy()
} 

//-----------------------------------------------------------------------
function btnadd_onclick()                       // 추가 
//------------------------------------------------------------------------
{

	btninsert_onclick()
}
//-----------------------------------------------------------------------
function btninsert_onclick()                    // 삽입
//-----------------------------------------------------------------------
{
	var ls_app_tag,ls_chg_class
	ls_app_tag   = ds_1.NameValue(ds_1.RowPosition,'app_tag')
	ls_chg_class = ds_1.NameValue(ds_1.RowPosition,'chg_class')
	if (il_screen == 3) {
		if (ls_app_tag != '1') {
			alert('품의작성중에만 업체추가 가능합니다...')
			return
		}
		if (ls_chg_class == '0' || ls_chg_class == '1' || ls_chg_class == '4') {
//			alert('업체변경 또는 단가품의에서만 업체추가 가능합니다...')
//			return
		}
		bt_vender_find()
	}
	else {
		btnsave_onclick()
		div_btnsave_onclick()
		fc_request_copy()
		btnquery_onclick()
	}
}
//---------------------------------------------------------------------
function bt_vender_find()               //견적업체 찾기
//---------------------------------------------------------------------
{
	var result;
	var array = new Array();
	var varray = new Array();
	var i,j,ls_wbs_code,ls_sbcr_code,ll_cnt,ls_fax
	
	if (ds_3.CountRow > 0 ) {
	   	for (i=1; i< ds_3.CountRow; i++){
			varray = varray + ds_3.NameValue(i,"sbcr_code") + "@"
		}
	}

	result = window.showModalDialog(gs_home + "/const/m_web/00/m_vender_find_1h.html", varray,"dialogWidth:700px;dialogHeight:510px");
	if(result == "") return;

	array = result.split("@");
	ds_3.AddRow()     
	
	ds_3.NameValue(ds_3.RowPosition,'dept_code') = ds_1.NameValue(ds_1.RowPosition,'dept_code')
	ds_3.NameValue(ds_3.RowPosition,'approym')   = ds_1.NameValue(ds_1.RowPosition,'approym')
	ds_3.NameValue(ds_3.RowPosition,'approseq')  = ds_1.NameValue(ds_1.RowPosition,'approseq')
	ds_3.NameValue(ds_3.RowPosition,'chg_cnt')   = ds_1.NameValue(ds_1.RowPosition,'chg_cnt')
	ds_3.NameValue(ds_3.RowPosition,'sbcr_code') = array[0]
	ds_3.NameValue(ds_3.RowPosition,'sbcr_name') = array[1]
	ls_sbcr_code = array[0]
	ls_wbs_code  = array[3]
	if (ls_wbs_code == ''){
		ll_cnt = f_select_q("select chrg_name1 select_1,chrg_hp select_2,fax_number select_3 " +
		                    "from s_sbcr where sbcr_code = '" + ls_sbcr_code + "'")
		if (ll_cnt > 0) {
			ds_3.NameValue(ds_3.RowPosition,'sbcr_owner') = ds_select.NameValue(ds_select.RowPosition,"select_1")
			ds_3.NameValue(ds_3.RowPosition,'tel_fax') = ds_select.NameValue(ds_select.RowPosition,"select_2") + '/' + ds_select.NameValue(ds_select.RowPosition,"select_3")
		}
	}
	else {
		ll_cnt = f_select_q("select fax_number select_1 " +
		                    "from s_sbcr where sbcr_code = '" + ls_sbcr_code + "'")
		ls_fax = ds_select.NameValue(ds_select.RowPosition,'select_1')
		
//		ll_cnt = f_select_q("select inout_name select_1,inout_tel select_2 " +
//		                    "from s_wbs_request where sbcr_code = '" + ls_sbcr_code + "'" +
//		                    " and profession_wbs_code = '" + ls_wbs_code + "'" )
		ll_cnt = f_select_q("select chrg_name1 select_1,chrg_tel_number2 select_2 " +
		                    "from s_sbcr where sbcr_code = '" + ls_sbcr_code + "'" )
		if (ll_cnt > 0) {
			ds_3.NameValue(ds_3.RowPosition,'sbcr_owner') = ds_select.NameValue(ds_select.RowPosition,"select_1")
			ds_3.NameValue(ds_3.RowPosition,'tel_fax') = ds_select.NameValue(ds_select.RowPosition,"select_2") + '/' + ls_fax
		}
	}

//	tx_sbcr_code.value = array[0]
//	tx_sbcr_name.value = array[1]
}
//------------------------------------------------------------------------
function btndelete_onclick()                    // 삭제 
//------------------------------------------------------------------------
{
	var ls_app_tag,ls_chg_class

	ls_app_tag   = ds_1.NameValue(ds_1.RowPosition,'app_tag')
	ls_chg_class = ds_1.NameValue(ds_1.RowPosition,'chg_class')

	if (il_screen == 2) return

	if (ls_app_tag != '1') {
		alert("품의중인 자료만 삭제가능합니다...")
		return
	}

	if (il_screen == 3) {
		if (ls_chg_class == '0' || ls_chg_class == '1' || ls_chg_class == '4') {
			alert('업체변경 또는 단가품의에서만 업체삭제가 가능합니다...')
			return
		}
	  	ds_3.DeleteRow(ds_3.RowPosition)
	} 
	else {
		if (ds_2.CountRow > 0) {
			if  (confirm("하위에 자료도 모두 삭제됩니다 계속하시겠습니까?")){
			}
			else {
				return
			}
	  	}
	 	var ls_dept_code,ls_approym,li_approseq,li_chg_cnt,ls_estimateyymm,li_estimateseq,li_requestseq,ls_order_class
	 	var li_tmp_chg
	 	
	 	ls_dept_code    = ds_1.NameValue(ds_1.RowPosition,'dept_code')
	 	ls_approym      = ds_1.NameValue(ds_1.RowPosition,'approym')
		li_approseq     = ds_1.NameValue(ds_1.RowPosition,'approseq')
		li_chg_cnt      = ds_1.NameValue(ds_1.RowPosition,'chg_cnt')
		ls_estimateyymm = ds_1.NameValue(ds_1.RowPosition,'estimateyymm')
		li_estimateseq  = ds_1.NameValue(ds_1.RowPosition,'estimateseq')
		ls_order_class  = ds_1.NameValue(ds_1.RowPosition,'order_class')
		li_requestseq   = ds_1.NameValue(ds_1.RowPosition,'requestseq')
		li_tmp_chg      = ds_1.NameValue(ds_1.RowPosition,'estimateseq')
	
		if (li_chg_cnt == 1) {
			if (ls_order_class == '1') {
			  	arg_cmd = " update m_estimation " +
			     		  "    set requestseq = 0 " +
			      		  "  WHERE estimateyymm = '" + ls_estimateyymm + "'" +
			      		  "    AND estimateseq = " + li_estimateseq
				f_update_sql(arg_cmd)
			}
			else {
			  	arg_cmd = " update m_request_detail " +
			     		  "    set nappr_qty = qty " +
			      		  "  WHERE dept_code = '" + ls_dept_code + "'" +
			      		  "    AND requestseq = " + li_requestseq +
			      		  "    AND chg_cnt = " + li_tmp_chg
				f_update_sql(arg_cmd)
			}
		}
		else {
		  	arg_cmd = " update m_request_detail " +
		     		  "    set nappr_qty = qty " +
		      		  "  WHERE dept_code = '" + ls_dept_code + "'" +
		      		  "    AND requestseq = " + li_requestseq +
		      		  "    AND chg_cnt = " + li_tmp_chg
			f_update_sql(arg_cmd)
		}
	  	arg_cmd = " delete from m_approval_detail " +
	      		  "  WHERE DEPT_CODE = " + "'" + ls_dept_code + "'" +
	      		  "    AND approym = " + "'" + ls_approym + "'" +
	      		  "    AND approseq = " + li_approseq +
	      		  "    AND chg_cnt = " + li_chg_cnt
		f_update_sql(arg_cmd)
	
	  	arg_cmd = " delete from m_approval_sbcr " +
	      		  "  WHERE DEPT_CODE = " + "'" + ls_dept_code + "'" +
	      		  "    AND approym = " + "'" + ls_approym + "'" +
	      		  "    AND approseq = " + li_approseq +
	      		  "    AND chg_cnt = " + li_chg_cnt
		f_update_sql(arg_cmd)
	  	ds_1.DeleteRow(ds_1.RowPosition)
	 	tr_1.Action = is_tr_1_addr
		tr_1.Post()
		ds_2.ClearData()	
		div_btnquery_onclick()
	}
}
//---------------------------------------------------------------------------
function btnsave_onclick()                       // 저장
//---------------------------------------------------------------------------
{
	if (ds_1.IsUpdated || ds_2.IsUpdated || ds_3.IsUpdated){
		if  (confirm("변경되었습니다 저장하시겠습니까?")){
			tr_1.Post()
			div_btnsave_onclick()
			return true
		}
		else {
			return false
		}
	}
	return true
}
//----------------------------------------------------------------------------
function btncancel_onclick()                     // 취소
//---------------------------------------------------------------------------- 
{
	if (il_screen > 1) {
		div_btncancel_onclick()
		return
	}   
	ds_1.Undo(ds_1.RowPosition)
}
//-----------------------------------------------------------------------
function div_Fn_SetColumn()   // 커서위치 세팅
//-----------------------------------------------------------------------
{
	gd_2.Focus();
	gd_2.SetColumn("approdetailseq");
}

//------------------------------------------------------------------------
function div_btnquery_onclick()                     // 하위 조회  
//------------------------------------------------------------------------
{
	if (ds_1.CountRow < 1){
		ds_2.ClearData()	
		return
	}
	
	ds_3.DataID = is_ds_3_addr  + ds_1.NameValue(ds_1.RowPosition,"dept_code") + 
			"&arg_date=" + ds_1.NameValue(ds_1.RowPosition,"approym") +
			"&arg_seq=" + ds_1.NameValue(ds_1.RowPosition,"approseq") +
			"&arg_chg_cnt=" + ds_1.NameValue(ds_1.RowPosition,"chg_cnt") 
	ds_3.SyncLoad=true
	ds_3.Reset()

	ds_2.DataID = is_ds_2_addr  + ds_1.NameValue(ds_1.RowPosition,"dept_code") + 
			"&arg_date=" + ds_1.NameValue(ds_1.RowPosition,"approym") +
			"&arg_seq=" + ds_1.NameValue(ds_1.RowPosition,"approseq") +
			"&arg_chg_cnt=" + ds_1.NameValue(ds_1.RowPosition,"chg_cnt") 
	ds_2.SyncLoad=true
	ds_2.Reset()
}
//---------------------------------------------------------------------
function fc_request_copy()               //견적내역 복사
//---------------------------------------------------------------------
{
	var parm,result,arg_cmd;
	var ls_estimateyymm,li_estimateseq,ls_sbcr_code,ls_copy_kind,ls_price_class,ls_tmp_code,ls_chg_class
	var ls_dept_code,li_requestseq,li_chg_cnt,ls_title,ls_order_class,ls_owner,ls_check_method,li_temp_chg=0
	var ls_approym ,li_approseq,i,ll_cnt,ld_amt,ld_vat,ls_deliverymethod,ls_deliverylimitdate,ls_paymentmethod
	var li_temp_chk,ls_vattag
	var array = new Array();
	
	ll_cnt = f_select_q("select vattag select_1 " +
	                    "from z_code_dept where dept_code = '" + ls_dept_code + "'")
	if (ds_select.ErrorCode != 0) {alert("에러발생");return;}
	if (ll_cnt > 0) {
		ls_vattag = ds_select.NameValue(ds_select.RowPosition,"select_1")
	}
	if (ls_vattag == '') {
		ls_vattag = '1'
	}
	if (ls_vattag == '2') {
		ls_vattag = '3'
	}

	parm = gs_home + '@' + is_work_date + '@'

	result = window.showModalDialog("../00/m_vender_est_find_1h.html" ,parm,"dialogWidth:"+920+"px; dialogHeight:"+510+"px");
	if(result == "") {
  		ds_1.DeleteRow(ds_1.RowPosition)
  		return
  	}

	array = result.split("@");
	ls_copy_kind = array[4]
	if (ls_copy_kind != '1') {
		ls_dept_code = array[0]
		li_requestseq = array[1]
		li_chg_cnt    = array[2]
		ls_approym = array[3]

		ll_cnt = f_select_q("select vattag select_1 " +
		                    "from z_code_dept where dept_code = '" + ls_dept_code + "'")
		if (ll_cnt > 0) {
			ls_vattag = ds_select.NameValue(ds_select.RowPosition,"select_1")
		}
		if (ls_vattag == '') {
			ls_vattag = '1'
		}
		if (ls_vattag == '2') {
			ls_vattag = '3'
		}
		if (ls_copy_kind == '2') {  // 품의순번구하기
			ll_cnt = f_select_q("select nvl(max(approseq),0) select_1 " +
			                    "from m_approval where dept_code = '" + ls_dept_code + "'" +
			                    " and to_char(approym,'yyyy.mm.dd') = " + "'" + ls_approym + "'")
			if (ll_cnt > 0) {
				li_approseq = parseInt(ds_select.NameValue(ds_select.RowPosition,"select_1")) + 1
			}
			else {
				li_approseq = 1
			}
			li_temp_chg = 1
			ls_chg_class = '3'
		}
		else {                  //변경일경우 이전품의목록을 가져와서 변경차수 추가를 한다.
			ll_cnt = f_select_q(" select to_char(max(b.approym),'YYYY.MM.DD') select_1,max(b.approseq) select_2 " +
									  "   from m_request_detail a,m_approval_detail b " +
									  "  where a.dept_code = b.dept_code " +
									  "    and a.request_unq_num = b.request_unq_num " +
									  "    and a.dept_code = '" + ls_dept_code + "'" +
									  "    and a.requestseq = " + li_requestseq + 
									  " group by b.dept_code,b.approym,b.approseq " )
			if (ll_cnt > 0){
				ls_approym = ds_select.NameValue(ds_select.RowPosition,'select_1')
				li_approseq = parseInt(ds_select.NameValue(ds_select.RowPosition,'select_2'),10)
				ll_cnt = f_select_q(" select max(a.chg_cnt) select_1 " +
										  "   from m_approval a " +
										  "  where a.dept_code = '" + ls_dept_code + "'" +
										  "    and a.approym = '" + ls_approym + "'" +
										  "    and a.approseq = " + li_approseq )
				if (ll_cnt > 0) {
					li_temp_chk = parseInt(ds_select.NameValue(ds_select.RowPosition,'select_1'),10)
					li_temp_chg = li_temp_chk  + 1;
				}
			}
			ls_chg_class = '4'
		}		
		// 청구서 제목 가져오기
		ll_cnt = f_select_q(" select approtitle select_1 , owner select_2, order_class select_3" +
								  "   from m_request " +
								  "  where dept_code = '" + ls_dept_code + "'" +
								  "    and requestseq = " + li_requestseq + 
								  "    and chg_cnt = " + li_chg_cnt )
		if (ll_cnt > 0) { 
			ls_title = ds_select.NameValue(ds_select.RowPosition,'select_1')
			ls_owner = ds_select.NameValue(ds_select.RowPosition,'select_2')
			ls_order_class = ds_select.NameValue(ds_select.RowPosition,'select_3')
		}
		if (ls_order_class == '2') {
			ll_cnt = f_select_q(" select max(mtrcode) select_1 " +
									  "   from m_request_detail " +
									  "  where dept_code = '" + ls_dept_code + "'" +
									  "    and requestseq = " + li_requestseq + 
									  "    and chg_cnt = " + li_chg_cnt )
			ls_tmp_code = ds_select.NameValue(ds_select.RowPosition,'select_1')
			ls_tmp_code = ls_tmp_code.substr(0,8)
			if (ls_tmp_code == '00100110') {
				ls_price_class = '1'
			}
			if (ls_tmp_code == '00100510') {
				ls_price_class = '2'
			}
		}
		else {
			ls_price_class = '0'
		}
		//품의목록생성
		arg_cmd = " INSERT INTO M_APPROVAL  " +
					 " VALUES ('" + ls_dept_code + "','" + ls_approym + "'," + li_approseq + "," + li_temp_chg + " ,'','" + ls_title + "'," +
					 "          '1','','" + ls_vattag + "',0,0,100,0,0,'','','','',''," + li_requestseq + ",'" + ls_owner + "','" +
					  '' + "', '" + ls_order_class + "',''," + li_chg_cnt + ",'" + ls_price_class + "',0,100,'" + ls_chg_class + "',0,0,0,0,0,'1','1', " +
					  "null,'','2',null,null,null,null )"
		f_update_sql(arg_cmd)
		
		//변경청구일 경우 이전계약 업체를 가지고 온다.
		if (ls_copy_kind == '3'){ 
					arg_cmd = " INSERT INTO m_approval_sbcr  " +
						 "      select a.dept_code,a.approym,a.approseq,'" + li_temp_chg + "',a.sbcr_code,a.sbcr_owner,a.tel_fax, " +
						 "             a.process_tag,a.const_date,a.const_no,a.bid_class,a.req_dt,a.bonsa_dt,a.sbcr_dt " +
						 "      from m_approval_sbcr a " +
						 "      where a.dept_code = '" + ls_dept_code + "'" +
						 "        and a.approym = '" + ls_approym + "'" +
						 "        and a.approseq = " + li_approseq +
						 "        and a.chg_cnt = " + li_temp_chk
			f_update_sql(arg_cmd)
			arg_cmd = " INSERT INTO M_APPROVAL_DETAIL  " +
						 "      select a.dept_code,'" + ls_approym + "'," + li_approseq + "," + li_temp_chg + ",nvl(b.approval_unq_num,m_spec_unq_no.nextval)," +
						 "             rownum,a.mtrcode,a.name,a.ssize,a.unitcode,c.qty,nvl(b.unitprice,0), " +
						 "             trunc(nvl(b.unitprice,0) * (c.qty ),0),trunc(nvl(b.unitprice,0) * (c.qty),0), " +
						 "             decode('" + ls_vattag + "','2',0,trunc(nvl(b.unitprice,0) * (c.qty) * 0.1,0)),a.spec_no_seq, " +
						 "             a.spec_unq_num,a.request_unq_num,0,a.qty ! nvl(b.noinput_qty,0),a.chg_cnt" +
						 "      from m_request_detail a, " +
						 "           m_approval_detail b ," +
						 "				(select max(dept_code) dept_code,max(requestseq) requestseq,max(request_unq_num) request_unq_num,sum(nvl(qty,0)) qty " +
						 "					from m_request_detail  " +
						 "			  	  where dept_code = '" + ls_dept_code + "'" +
						 "				    and requestseq = " + li_requestseq +
						 "			 group by dept_code,requestseq,request_unq_num) c " +
						 "      where a.dept_code = c.dept_code (!) " +
						 "        and a.requestseq = c.requestseq (!) " +
						 "        and a.request_unq_num = c.request_unq_num (!) " +
						 "        and a.dept_code = b.dept_code (!) " +
						 "        and a.request_unq_num = b.request_unq_num(!) " +
						 "        and b.chg_cnt (!) = " + li_temp_chk +
						 "        and a.dept_code = '" + ls_dept_code + "'" +
						 "        and a.requestseq = " + li_requestseq +
						 "        and a.chg_cnt = " + li_chg_cnt
			f_update_sql(arg_cmd)

			//청구내역에 미청구수량을 0로 Setting 한다.
		  	arg_cmd = " update m_request_detail " +
		     		    "    set nappr_qty = 0 " +
						 "  where dept_code = '" + ls_dept_code + "'" +
						 "    and requestseq = " + li_requestseq +
						 "    and chg_cnt = " + li_chg_cnt
			f_update_sql(arg_cmd)
		}
		else {
			// 청구자료를 복사한다		
			//품의내역생성(단가발주)
			ll_cnt = f_select_q(" select max(mtrcode) select_1 " +
									  "   from m_request_detail " +
									  "  where dept_code = '" + ls_dept_code + "'" +
									  "    and requestseq = " + li_requestseq + 
									  "    and chg_cnt = " + li_chg_cnt )
			ls_tmp_code = ds_select.NameValue(ds_select.RowPosition,'select_1')
			ls_tmp_code = ls_tmp_code.substr(0,8)

			arg_cmd = " INSERT INTO M_APPROVAL_DETAIL  " +
			          "      select a.dept_code,a.approym,a.approseq,a.temp_chg,m_spec_unq_no.nextval,rownum,a.mtrcode,a.name,a.ssize,a.unitcode, " +
			          "             a.c1,a.c2,a.c3,a.c4,a.c5,a.spec_no_seq,a.spec_unq_num,a.request_unq_num,a.c6,a.c7,a.chg_cnt " +
						 "      from (select '" + ls_dept_code + "' dept_code,'" + ls_approym + "' approym," + li_approseq + " approseq," + li_temp_chg + 
						 "                  temp_chg," +
						 "             a.mtrcode mtrcode,a.name name,a.ssize ssize,a.unitcode unitcode,1 c1,0 c2,0 c3,0 c4,0 c5, " +
						 "             nvl(b.spec_no_seq,0) spec_no_seq,nvl(b.spec_unq_num,0) spec_unq_num,nvl(b.request_unq_num,0) request_unq_num," +
						 "             0 c6,1 c7," + li_chg_cnt + " chg_cnt " +
						 "      from m_code_material a, " +
						 "           (select max(dept_code) dept_code,max(spec_no_seq) spec_no_seq,max(spec_unq_num) spec_unq_num, " +
						 "                   max(request_unq_num) request_unq_num,max(chg_cnt) chg_cnt,max(mtrcode) mtrcode " +
						 "      		  from m_request_detail " +
						 "      		 where dept_code = '" + ls_dept_code + "'" +
						 "      			and requestseq = " + li_requestseq +
						 "      			and chg_cnt = " + li_chg_cnt + 
						 "            group by mtrcode ) b " +
						 "      where a.mtrcode = b.mtrcode (+) " +
						 "      and a.mtrgrand = '" + ls_tmp_code + "'"  +
						 "     order by a.mtrcode ) a" 



			f_update_sql(arg_cmd)
			//청구내역에 미청구수량을 0로 Setting 한다.
		  	arg_cmd = " update m_request_detail " +
		     		    "    set nappr_qty = 0 " +
						 "  where dept_code = '" + ls_dept_code + "'" +
						 "    and requestseq = " + li_requestseq +
						 "    and chg_cnt = " + li_chg_cnt
			f_update_sql(arg_cmd)
		}
		
		//금액 및 부가세를 구하여 품의목록에 저장
		ll_cnt = f_select_q("select nvl(sum(amt),0) select_1,nvl(sum(vatamt),0) select_2 " +
		                    "from m_approval_detail where dept_code = '" + ls_dept_code + "'" +
		                    " and to_char(approym,'yyyy.mm.dd') = " + "'" + ls_approym + "'" +
		                    " and approseq = " + li_approseq  + " and chg_cnt = " + li_temp_chg )
		if (ll_cnt > 0) {
			ld_amt = parseInt(ds_select.NameValue(ds_select.RowPosition,"select_1")) 
			ld_vat = parseInt(ds_select.NameValue(ds_select.RowPosition,"select_2")) 
		}
		else {
			ld_amt = 0;
			ld_vat = 0;
		}
	  	arg_cmd = " update m_approval " +
	     		    "    set amt = " + ld_amt + ", vatamt = " + ld_vat + 
	      		 "  WHERE dept_code = '" + ls_dept_code + "'" +
	      		 "    AND approym = '" + ls_approym + "'" +
	      		 "    and approseq = " + li_approseq +
	      		 "    and chg_cnt = " + li_temp_chg
		f_update_sql(arg_cmd)
	}
	if (ls_copy_kind == '1') {
		ls_estimateyymm = array[0]
		li_estimateseq = array[1]
		ls_sbcr_code = array[2]
		ls_approym = array[3]
		
		ds_4.DataID = is_ds_4_addr + ls_estimateyymm + '&arg_seq=' + li_estimateseq
		ds_4.SyncLoad=true
		ds_4.Reset()

		if ( ds_4.CountRow > 0 ) {
			for(i=1;i <= ds_4.CountRow;i++) {
				ls_dept_code    = ds_4.NameValue(i,"dept_code")
				ls_requestseq   = ds_4.NameValue(i,"requestseq")
				li_chg_cnt      = ds_4.NameValue(i,"chg_cnt")
				ls_title        = ds_4.NameValue(i,"approtitle")
				ls_title        = ls_title.replace("&","%26").replace("'","%27")
				ls_order_class  = ds_4.NameValue(i,"order_class")
				ls_owner        = ds_4.NameValue(i,"owner")
				ls_check_method = ds_4.NameValue(i,"check_method")
	
				ll_cnt = f_select_q("select vattag select_1 " +
				                    "from z_code_dept where dept_code = '" + ls_dept_code + "'")
				if (ll_cnt > 0) {
					ls_vattag = ds_select.NameValue(ds_select.RowPosition,"select_1")
				}
				if (ls_vattag == '') {
					ls_vattag = '1'
				}
				if (ls_vattag == '2') {
					ls_vattag = '3'
				}
				ll_cnt = f_select_q("select nvl(max(approseq),0) select_1 " +
				                    "from m_approval where dept_code = '" + ls_dept_code + "'" +
				                    " and to_char(approym,'yyyy.mm.dd') = " + "'" + ls_approym + "'")
				if (ll_cnt > 0) {
					li_approseq = parseInt(ds_select.NameValue(ds_select.RowPosition,"select_1")) + 1
				}
				else {
					li_approseq = 1
				}
				//품의목록생성
				arg_cmd = " INSERT INTO M_APPROVAL  " +
							 " VALUES ('" + ls_dept_code + "','" + ls_approym + "'," + li_approseq + ",1,'','" + ls_title + "'," +
							 "          '1','','" + ls_vattag + "',0,0,100,0,0,'','','','',''," + ls_requestseq + ",'" + ls_owner + "','" +
							  ls_check_method + "', '" + ls_order_class + "','" + ls_estimateyymm + "'," + li_estimateseq + ",'0',0,100,'0',0,0,0,0,0,'1','1', " +
							  "null,'','2',null,null,null,null )"
				f_update_sql(arg_cmd)
	
				//품의내역생성
				arg_cmd = " INSERT INTO M_APPROVAL_DETAIL  " +
							 "      select a.dept_code,'" + ls_approym + "'," + li_approseq + ",1,m_spec_unq_no.nextval," +
							 "             rownum,b.mtrcode,b.name,b.ssize,b.unitcode,b.qty,c.chgprice,trunc(b.qty * c.chgprice,0), " +
							 "             trunc(b.qty * c.chgprice,0)," +
						    "             decode('" + ls_vattag + "','2',0,trunc(nvl(c.chgprice,0) * b.qty * 0.1,0)),b.spec_no_seq, " +
							 "             b.spec_unq_num,a.request_unq_num,b.est_unq_num,b.qty,a.chg_cnt" +
							 "      from m_request_detail a, " +
							 "      	  m_est_detail b, " +
							 "      	  m_vender_est_detail c " +
							 "      where a.dept_code = b.dept_code (!) " +
							 "        and a.request_unq_num = b.request_unq_num (!) " +
							 "        and b.estimateyymm = '" + ls_estimateyymm  + "'" +
							 "        and b.estimateseq = " + li_estimateseq +
							 "        and b.estimateyymm = c.estimateyymm " +
							 "        and b.estimateseq  = c.estimateseq " +
							 "        and b.est_unq_num  = c.est_unq_num " +
							 "        and c.sbcr_code = '" + ls_sbcr_code + "'" +
							 "        and a.dept_code = '" + ls_dept_code + "'" +
							 "        and a.requestseq = " + ls_requestseq +
							 "        and a.chg_cnt = " + li_chg_cnt
				f_update_sql(arg_cmd)
				
				//품의선정업체생성
				arg_cmd = " INSERT INTO M_APPROVAL_SBCR  " +
							 "      select '" + ls_dept_code + "','" + ls_approym + "'," + li_approseq + ",1," +
							 "             a.sbcr_code,b.chrg_name1," +
							 "             b.chrg_hp || '/' || b.fax_number," +
							 "             '1',null,'','1',null,null,null " +
							 "	       from m_vender_est a," +
							 "             s_sbcr b " +
							 "	      where a.sbcr_code = b.sbcr_code " +
							 "         and a.estimateyymm = '" + ls_estimateyymm + "'" +
							 "	        and a.estimateseq = " + li_estimateseq +
							 "	        and a.choicetag = 'Y'"
				f_update_sql(arg_cmd)
				
				//견적에 처리여부저장(견적품의번호에 1을 입력함)
			  	arg_cmd = " update m_estimation " +
			     		    "    set requestseq = 1 " +
			      		 "  WHERE estimateyymm = " + "'" + ls_estimateyymm + "'" +
			      		 "    AND estimateseq = " + li_estimateseq
				f_update_sql(arg_cmd)
	
				//금액 및 부가세를 구하여 품의목록에 저장
				ll_cnt = f_select_q("select nvl(sum(amt),0) select_1,nvl(sum(vatamt),0) select_2 " +
				                    "from m_approval_detail where dept_code = '" + ls_dept_code + "'" +
				                    " and to_char(approym,'yyyy.mm.dd') = " + "'" + ls_approym + "'" +
				                    " and approseq = " + li_approseq  + " and chg_cnt = 1 ")
				if (ll_cnt > 0) {
					ld_amt = parseInt(ds_select.NameValue(ds_select.RowPosition,"select_1")) 
					ld_vat = parseInt(ds_select.NameValue(ds_select.RowPosition,"select_2")) 
				}
				else {
					ld_amt = 0;
					ld_vat = 0;
				}
				ll_cnt = f_select_q("select deliverycondition select_1,to_char(deliverylimitdate,'yyyy.mm.dd') select_2,paycondition select_3 " +
				                    "from m_estimation where estimateyymm = '" + ls_estimateyymm + "'" +
				                    " and estimateseq = " + li_estimateseq )
				if (ll_cnt > 0 ) {
					ls_deliverymethod = ds_select.NameValue(ds_select.RowPosition,"select_1")
					ls_deliverylimitdate = ds_select.NameValue(ds_select.RowPosition,"select_2")
					ls_paymentmethod = ds_select.NameValue(ds_select.RowPosition,"select_3")
				}
			  	arg_cmd = " update m_approval " +
			     		    "    set amt = " + ld_amt + ", vatamt = " + ld_vat + 
			     		    "       ,deliverymethod = '" + ls_deliverymethod + "', deliverylimitdate = '" + 
			     		    		ls_deliverylimitdate + "',paymentmethod = '" + ls_paymentmethod + "'" +
			      		 "  WHERE dept_code = '" + ls_dept_code + "'" +
			      		 "    AND approym = '" + ls_approym + "'" +
			      		 "    and approseq = " + li_approseq +
			      		 "    and chg_cnt = 1 "
				f_update_sql(arg_cmd)
			}
		}
	}
}
//---------------------------------------------------------------------------
function div_btnsave_onclick()                  //하위 저장 
//---------------------------------------------------------------------------
{
	var ls_chk=0
	
	tr_2.Action = is_tr_2_addr
	tr_3.Action = is_tr_3_addr
	
	if (ds_2.IsUpdated || ds_3.IsUpdated){
		if (ds_2.IsUpdated) {
       	tr_2.Post()
		}
		if (ds_3.IsUpdated) {
       	tr_3.Post()
		}
	}
}
//-------------------------------------------------------------------------------
function sp_call()                  //Stored Procedure Call 
//--------------------------------------------------------------------------------
{
 	var ls_date,li_seq
        ls_date = ds_1.NameValue(ds_1.RowPosition,"estimateyymm")
        li_seq  = ds_1.NameValue(ds_1.RowPosition,"estimateseq")
       	ds_spcall.DataID = 'y_m_vender_est_cmpt_procedure.jsp?arg_dept_code=' + is_dept_code + '&arg_date=' + ls_date + '&arg_seq=' + li_seq
        ds_spcall.SyncLoad = true
        ds_spcall.reset()
}
//----------------------------------------------------------------------------
function div_btncancel_onclick()                     // 취소
//---------------------------------------------------------------------------- 
{
	ds_2.Undo(ds_2.RowPosition)
}
//--------------------------------------------------------------------------
function   sbcr_search()
//----------------------------------------------------------------
{
	if (tx_dept_search_name.value == '') {
		is_long_name = ''
	}
	else {
		is_long_name = tx_dept_search_name.value
	}
	btnquery_onclick()
}
//----------------------------------------------------------------------------
function btnexit_onclick(ls_arg)                 // 종료 
//-----------------------------------------------------------------------------
{
	if (ds_1.IsUpdated) {
		if  (confirm("변경되었습니다 저장하시겠습니까?")) 
		{  //저장 routine
		}   
	
	}     
	top.frames['main_ct'].location.href(ls_arg)
	top.frames['main_title'].div_r.style.visibility="hidden"             
	top.frames['main_title'].div_u.style.visibility="hidden"             
	
	// top.frames['main_ct'].window.close()     
}
//-------------------------------------------------------------------------------
function select_yymm()                  //년월 선택 
//--------------------------------------------------------------------------------
{
   is_fr_date = em_select_yymm.text
   is_to_date = em_select_to_yymm.text
   il_screen = 1
   btnquery_onclick()
 
}  
//-------------------------------------------------------------------------------
function price_chg()                  //단가변경 
//--------------------------------------------------------------------------------
{
	if (ds_1.RowPosition < 1) return
	if (ds_1.NameValue(ds_1.RowPosition,'app_tag') == '1') {
		alert('선택한 품의내역이 완료되지않아 처리하실 수 없습니다...')
		return
	}
	if  (confirm("단가변경을 하시겠습니까?")) {
	}
	else {
		return
	}
	chg_rtn('1')
}
//-------------------------------------------------------------------------------
function sbcr_chg()                  //업체변경 
//--------------------------------------------------------------------------------
{
	if (ds_1.RowPosition < 1) return
	if (ds_1.NameValue(ds_1.RowPosition,'app_tag') == '1') {
		alert('선택한 품의내역이 완료되지않아 처리하실 수 없습니다...')
		return
	}
	if  (confirm("업체변경을 하시겠습니까?")) {
	}
	else {
		return
	}
	chg_rtn('2')
}
//------------------------------------------------------------------------
function chg_rtn(arg_class) // gd가 포커스를 받을때 동작.
//------------------------------------------------------------------------
{
	var arg_cmd,ls_dept_code,ls_approym,li_approseq,li_chg_cnt,li_tmp_chg,li_chk

	ls_dept_code = ds_1.NameValue(ds_1.RowPosition,'dept_code')
	ls_approym   = ds_1.NameValue(ds_1.RowPosition,'approym')
	li_approseq  = ds_1.NameValue(ds_1.RowPosition,'approseq')
	li_chg_cnt   = ds_1.NameValue(ds_1.RowPosition,'chg_cnt')
	li_tmp_chg = li_chg_cnt + 1;
	ll_cnt = f_select_q("select nvl(count(*),0) select_1 from m_approval " +
							  "	  where dept_code = '" + ls_dept_code + "'" +
							  "     and approym = '" + ls_approym + "'" +
							  "     and approseq = " + li_approseq +
							  "     and chg_cnt = " + li_tmp_chg )

	if (ll_cnt > 0 ){
		li_chk = ds_select.NameValue(ds_select.RowPosition,'select_1')
		if (li_chk > 0 ) {
			alert('선택한 내역이 최종품의내역이 아니어서 변경차수를 생성하실수없습니다...')
			return
		}
	}
	arg_cmd = " INSERT INTO m_approval  " +
				 "  SELECT DEPT_CODE,APPROYM,APPROSEQ," + li_tmp_chg + ",APPRODATE,APPROTITLE,'1',CHARGE,VATTAG," +
				 "			  AMT,VATAMT,CASH_RT,BILL_RT,PREPAYMENT,DELIVERYMETHOD,DELIVERYLIMITDATE,DELIVERYCONDITION," +
				 "			  PAYMENTMETHOD,REMARK1,REQUESTSEQ,OWNER,CHECK_METHOD,ORDER_CLASS,ESTIMATEYYMM,ESTIMATESEQ," +
				 "			  PRICE_CLASS,PRICE_SUP_CLASS,PRICE_RT,'" + arg_class + "',pre_pay_dat,const_guar_amt,as_guar_amt,as_term,delay_amt,const_class,process_tag," +
				 "         const_date,const_no,bid_class,req_dt,bonsa_dt,sbcr_dt " +
				 "    FROM M_APPROVAL  " +
				 "	  where dept_code = '" + ls_dept_code + "'" +
				 "     and approym = '" + ls_approym + "'" +
				 "     and approseq = " + li_approseq +
				 "     and chg_cnt = " + li_chg_cnt
	f_update_sql(arg_cmd)
	
	
	arg_cmd = " INSERT INTO M_APPROVAL_DETAIL  " +
				 "  SELECT DEPT_CODE,APPROYM,APPROSEQ," + li_tmp_chg + ",APPROVAL_UNQ_NUM,APPRODETAILSEQ,MTRCODE, " +   
				 "			  NAME,SSIZE,UNITCODE,QTY,UNITPRICE,AMT,CONF_AMT,VATAMT,SPEC_NO_SEQ,SPEC_UNQ_NUM, " +   
				 "			  REQUEST_UNQ_NUM,EST_UNQ_NUM,NOINPUT_QTY ,request_chg_cnt " +
             "    FROM M_APPROVAL_DETAIL  " +
				 "	  where dept_code = '" + ls_dept_code + "'" +
				 "     and approym = '" + ls_approym + "'" +
				 "     and approseq = " + li_approseq +
				 "     and chg_cnt = " + li_chg_cnt
	f_update_sql(arg_cmd)
             
	arg_cmd = " INSERT INTO M_APPROVAL_SBCR  " +
     			 "  SELECT DEPT_CODE,APPROYM,APPROSEQ," + li_tmp_chg + ",SBCR_CODE,SBCR_OWNER,TEL_FAX , " +
     			 "         process_tag,const_date,const_no,bid_class,req_dt,bonsa_dt,sbcr_dt " +
             "    FROM M_APPROVAL_SBCR  " +
				 "	  where dept_code = '" + ls_dept_code + "'" +
				 "     and approym = '" + ls_approym + "'" +
				 "     and approseq = " + li_approseq +
				 "     and chg_cnt = " + li_chg_cnt
	f_update_sql(arg_cmd)
	btnquery_onclick()
}
//------------------------------------------------------------------------
function price_comp()                       //단가 적용
//------------------------------------------------------------------------
{
	var ll_row,ls_dept_code,ls_approym,li_approseq,li_chg_cnt,ls_name,ls_class,arg_cmd,li_rt
	if (ds_1.RowPosition < 1) return
	if (btnsave_onclick()){
	}
	else {
		alert('저장을 하지않아 단가적용이 처리되지 않았습니다...')
		return
	}
	if  (confirm("단가적용을 하시겠습니까?")) {
	}
	else {
		return
	}
	ll_row = ds_1.RowPosition
	ls_dept_code = ds_1.NameValue(ll_row,'dept_code')
	ls_approym   = ds_1.NameValue(ll_row,'approym')
	li_approseq  = ds_1.NameValue(ll_row,'approseq')
	li_chg_cnt   = ds_1.NameValue(ll_row,'chg_cnt')
	ls_name      = 'b.price' + parseInt(ds_1.NameValue(ll_row,'price_sup_class'),10)
	ls_class     = ds_1.NameValue(ll_row,'price_class')
	li_rt        = ds_1.NameValue(ll_row,'price_rt')
	
 	arg_cmd = " UPDATE m_approval_detail  a " +
	          "    SET a.unitprice =  " + 
	          "		 ( SELECT nvl(" + ls_name + ",0) " +
	          "			  from m_mtr_price b " + 
	          "			 where a.mtrcode = b.mtrcode (!) " +
	          "          and b.price_class = '" + ls_class + "' )"  +
	          " WHERE a.dept_code = '" + ls_dept_code + "'" +
	          "   AND a.approym   = '" + ls_approym + "'" +
	          "   AND a.approseq  =  " + li_approseq +
	          "   AND a.chg_cnt   =  " + li_chg_cnt +
	          "	  AND EXISTS (SELECT nvl(sum(b.price1),0) " +
	          "	       		    from m_mtr_price b " + 
	          "	 		         where a.mtrcode = b.mtrcode (!) " +
	          "                  and b.price_class = '" + ls_class + "' )"  
	f_update_sql(arg_cmd)
	
	if (ls_class == '2'){
		arg_cmd = " UPDATE m_approval_detail " +
		          "    SET unitprice =  trunc(unitprice * " + li_rt + " * 0.0001,0) * 100" + 
		          "  WHERE dept_code = '" + ls_dept_code + "'" +
		          "    AND approym   = '" + ls_approym + "'" +
		          "    AND approseq  =  " + li_approseq +
		          "    AND chg_cnt   =  " + li_chg_cnt 
		f_update_sql(arg_cmd)
	}
	arg_cmd = " UPDATE m_approval_detail " +
	          "    SET amt =  trunc(qty * unitprice,0)," + 
	          "        conf_amt = trunc(qty * unitprice,0) " +
	          "  WHERE dept_code = '" + ls_dept_code + "'" +
	          "    AND approym   = '" + ls_approym + "'" +
	          "    AND approseq  =  " + li_approseq +
	          "    AND chg_cnt   =  " + li_chg_cnt 
	f_update_sql(arg_cmd)
	
	arg_cmd = " UPDATE m_approval " +
	          "    SET amt = ( select nvl(sum(amt),0) " + 
	          "                  from m_approval_detail  " +
	          "                 WHERE dept_code = '" + ls_dept_code + "'" +
	          "                   AND approym   = '" + ls_approym + "'" +
	          "                   AND approseq  =  " + li_approseq +
	          "                   AND chg_cnt   =  " + li_chg_cnt + ")" +
	          "  WHERE dept_code = '" + ls_dept_code + "'" +
	          "    AND approym   = '" + ls_approym + "'" +
	          "    AND approseq  =  " + li_approseq +
	          "    AND chg_cnt   =  " + li_chg_cnt 
	f_update_sql(arg_cmd)
	btnquery_onclick()
	ds_1.RowPosition = ll_row
	
}
//------------------------------------------------------------------------
function ok_rtn()                       //품의완료
//------------------------------------------------------------------------
{
	var ls_app_tag,ll_sa_row,ll_cnt,ls_approym,ls_approseq,ls_chg_cnt,ls_dept_code
	var ls_request_num,arg_cmd
	
	if( ds_1.RowPosition < 1) return
	if (ds_3.CountRow < 1) {
		alert('업체를 선정하셔야지만 품의완료 처리를 하실 수 있습니다...')
		return
	}
	ls_app_tag = ds_1.NameValue(ds_1.RowPosition,'app_tag')
	if (ls_app_tag != '1') {
		alert('품의중에서만 품의완료 처리를 하실 수있습니다...')
		return
	}
	if  (confirm("품의완료처리를 하시면 자료를 수정하실 수 없습니다 \n\n                      계속하시겠습니까?")) {
	}
	else {
		return
	}
	if (ds_1.IsUpdated || ds_2.IsUpdated || ds_3.IsUpdated){
		btnsave_onclick()
		div_btnsave_onclick()
	}

	ds_1.NameValue(ds_1.RowPosition,'approdate') = is_work_date
	ds_1.NameValue(ds_1.RowPosition,'app_tag') = '3'
	tr_1.Post()
	ls_dept_code = ds_1.NameValue(ds_1.RowPosition,'dept_code')
	ls_approym  = ds_1.NameValue(ds_1.RowPosition,'approym')
	ls_approseq = ds_1.NameValue(ds_1.RowPosition,'approseq')
	ls_chg_cnt  = ds_1.NameValue(ds_1.RowPosition,'chg_cnt')
	ll_cnt = f_select_q("select max(request_unq_num) select_1 " +
		                    "from m_approval_detail where dept_code = '" + ls_dept_code + "'" +
		                    " and to_char(approym,'yyyy.mm.dd') = " + "'" + ls_approym + "'" +
		                    " and approseq = " + ls_approseq  + " and chg_cnt = " + ls_chg_cnt )
	if (ll_cnt > 0) {
		ls_request_num = ds_select.NameValue(ds_select.RowPosition,"select_1")
		ll_cnt = f_select_q("select max(requestseq) select_1,max(chg_cnt) select_2 " +
			                    "from m_request_detail where dept_code = '" + ls_dept_code + "'" +
			                    " and request_unq_num = " + ls_request_num )
		if (ll_cnt > 0) {
			ls_request_num = ds_select.NameValue(ds_select.RowPosition,"select_1")
			ls_chg_cnt = ds_select.NameValue(ds_select.RowPosition,"select_2")
			arg_cmd = " UPDATE m_request " +
			          "    SET approve_class = '7' " + 
			          "  WHERE dept_code = '" + ls_dept_code + "'" +
			          "    AND requestseq = " + ls_request_num + 
			          "    AND chg_cnt   =  " + ls_chg_cnt 
			f_update_sql(arg_cmd)
		}
	}	
//	ll_sa_row = ds_1.RowPosition
//	btnquery_onclick()
//	ds_1.RowPosition = ll_sa_row

	gf_protect_on('tab_page_1')
	gd_2.Editable=0
	gd_3.Editable=0
	
	alert('정상처리되었습니다')
}
//------------------------------------------------------------------------
function ok_cancel()                       //품의취소
//------------------------------------------------------------------------
{
	
	var ls_app_tag,ll_sa_row,ls_approym,ls_approseq,ls_chg_cnt,ls_dept_code
	var ls_request_num,arg_cmd,ls_chk_tag
	
	if( ds_1.RowPosition < 1) return
	ls_app_tag = ds_1.NameValue(ds_1.RowPosition,'app_tag') 

	if (ls_app_tag != '3') {
		alert('품의완료인 자료만 품의취소 처리를 하실 수있습니다...')
		return
	}
	ds_1.NameValue(ds_1.RowPosition,'approdate') = ''
	ds_1.NameValue(ds_1.RowPosition,'app_tag') = '1'
	tr_1.Post()
	ls_dept_code = ds_1.NameValue(ds_1.RowPosition,'dept_code')
	ls_approym  = ds_1.NameValue(ds_1.RowPosition,'approym')
	ls_approseq = ds_1.NameValue(ds_1.RowPosition,'approseq')
	ls_chg_cnt  = ds_1.NameValue(ds_1.RowPosition,'chg_cnt')
	if (ds_1.Namevalue(ds_1.RowPosition,'price_class') == '0') {
		ls_chk_tag = '6'
	}
	else {
		ls_chk_tag = '4'
	}
	ll_cnt = f_select_q("select max(request_unq_num) select_1 " +
		                    "from m_approval_detail where dept_code = '" + ls_dept_code + "'" +
		                    " and to_char(approym,'yyyy.mm.dd') = " + "'" + ls_approym + "'" +
		                    " and approseq = " + ls_approseq  + " and chg_cnt = " + ls_chg_cnt )
	if (ll_cnt > 0) {
		ls_request_num = ds_select.NameValue(ds_select.RowPosition,"select_1")
		ll_cnt = f_select_q("select max(requestseq) select_1,max(chg_cnt) select_2 " +
			                    "from m_request_detail where dept_code = '" + ls_dept_code + "'" +
			                    " and request_unq_num = " + ls_request_num )
		if (ll_cnt > 0) {
			ls_request_num = ds_select.NameValue(ds_select.RowPosition,"select_1")
			ls_chg_cnt = ds_select.NameValue(ds_select.RowPosition,"select_2")
			arg_cmd = " UPDATE m_request " +
			          "    SET approve_class = '" + ls_chk_tag + "' " + 
			          "  WHERE dept_code = '" + ls_dept_code + "'" +
			          "    AND requestseq = " + ls_request_num + 
			          "    AND chg_cnt   =  " + ls_chg_cnt 
			f_update_sql(arg_cmd)
		}
	}	
	
	
//	ll_sa_row = ds_1.RowPosition
//	btnquery_onclick()
//	ds_1.RowPosition = ll_sa_row
	gf_protect_off('tab_page_1')
	gd_2.Editable=-1
	gd_3.Editable=-1
	alert('정상처리되었습니다')
}
//------------------------------------------------------------------------
function order_rtn()                       //발주처리
//------------------------------------------------------------------------
{
	var ls_app_tag,ll_sa_row
	
	if( ds_1.RowPosition < 1) return
	
	ls_app_tag = ds_1.NameValue(ds_1.RowPosition,'app_tag')
	if (ls_app_tag != '2') {
		alert('품의완료된 자료만 발주 처리를 하실 수있습니다...')
		return
	}
	//ds_1.NameValue(ds_1.RowPosition,'approdate') = is_work_date
	ds_1.NameValue(ds_1.RowPosition,'app_tag') = '3'
	tr_1.Post()
//	ll_sa_row = ds_1.RowPosition
//	btnquery_onclick()
//	ds_1.RowPosition = ll_sa_row
	alert('정상처리되었습니다')
}

//------------------------------------------------------------------------
function order_cancel()                       //발주취소
//------------------------------------------------------------------------
{
	var ls_app_tag,ll_sa_row,ls_dept_code,ls_approym,ll_approseq,ll_chg_cnt,ll_cnt,ll_count
	
	if( ds_1.RowPosition < 1) return
	
	ls_app_tag = ds_1.NameValue(ds_1.RowPosition,'app_tag')
	if (ls_app_tag != '3') {
		alert('발주된 자료만 발주취소 처리를 하실 수있습니다...')
		return
	}
	
	ls_dept_code = ds_1.NameValue(ds_1.RowPosition,'dept_code')
	ls_approym   = ds_1.NameValue(ds_1.RowPosition,'approym')
	ll_approseq  = ds_1.NameValue(ds_1.RowPosition,'approseq')
	ll_chg_cnt   = ds_1.NameValue(ds_1.RowPosition,'chg_cnt')

	ll_cnt = f_select_q(" select nvl(count(*),0) select_1 " +
							  "  from m_approval_detail a, " +
							  "       m_input_detail b " +
							  " where a.dept_code = b.dept_code " +
							  "   and a.approval_unq_num = b.approval_unq_num  " +
	                    "   and a.dept_code = '" + ls_dept_code + "'" +
	                    "   and to_char(a.approym,'yyyy.mm.dd') = '" + ls_approym + "'" +
	                    "   and a.approseq = " + ll_approseq + 
	                    "   and a.chg_cnt = " + ll_chg_cnt )
	                    
	ll_count = ds_select.NameValue(ds_select.RowPosition,'select_1')
	
	if (ll_count != 0) {
		alert('이미 입고된 자료가 있어 처리를 하실 수있습니다...')
		if (top.frames['security'].user_id.value == "kilee") {
			if (!confirm("발주취소 하시겠습니까?")) return
		} else {
			return
		}
	}

	//ds_1.NameValue(ds_1.RowPosition,'approdate') = is_work_date
	ds_1.NameValue(ds_1.RowPosition,'app_tag') = '2'
	tr_1.Post()
	
//	ll_sa_row = ds_1.RowPosition
//	btnquery_onclick()
//	ds_1.RowPosition = ll_sa_row
	alert('정상처리되었습니다')
}
//---------------------------------------------------------------------------
function guljae_rtn11()                      // 전자결재
//---------------------------------------------------------------------------
{
   if (report_kind[0].checked) 
		approval_rtn()
	else if (report_kind[1].checked) 
		order_list_rtn()		
}
//---------------------------------------------------------------------------
function approval_rtn()                      // 구매 품의서 전자결재
//---------------------------------------------------------------------------
{
 ls_dept_code = ds_1.NameValue(ds_1.RowPosition,"dept_code")
 ls_date = em_approym.text
 ls_seq  = ds_1.NameString(ds_1.RowPosition,"approseq")

 tr_m_approval_01.Action = gs_home + '/const/m_web/02/m_approval_01_1tr.jsp'
 ds_m_approval_01.DataID = 'm_approval_01_1q.jsp?arg_dept=' + ls_dept_code + 
                                     '&arg_date=' +  ls_date +
                                     '&arg_seq=' +  ls_seq
 tr_m_approval_02.Action = gs_home + '/const/m_web/02/m_approval_02_1tr.jsp'
 ds_m_approval_02.DataID = 'm_approval_02_1q.jsp?arg_dept=' + ls_dept_code+ 
                                     '&arg_date=' +  ls_date +
                                     '&arg_seq=' +  ls_seq

 tr_m_approval_03.Action = gs_home + '/const/m_web/02/m_approval_03_1tr.jsp'
 ds_m_approval_03.DataID = 'm_approval_03_1q.jsp?arg_dept=' + ls_dept_code + 
                                     '&arg_date=' +  ls_date +
                                     '&arg_seq=' +  ls_seq
 tr_m_approval_04.Action = gs_home + '/const/m_web/02/m_approval_04_1tr.jsp'
 ds_m_approval_04.DataID = 'm_approval_04_1q.jsp'

 ds_m_approval_01.SyncLoad=true
 ds_m_approval_01.Reset()
 if (ds_m_approval_01.CountRow < 1) {
   alert('결재할 건이 없습니다')
   return
 }
 ll_cnt = f_ds_select_q('ds_seq_1','select s_confirm_unq_seq.nextval select_1 from dual')
 ll_temp = ds_seq_1.NameValue(1,'select_1')
 ll_temp = parseInt(ll_temp,10)
 ds_m_approval_01.NameValue(1,'unq_num') = ll_temp

 var ls_title		
 ls_title = '(' + ds_m_approval_01.NameValue(1,'name') + ')'		// 품명명
 ds_m_approval_01.NameValue(1,'title') = ls_title 
 ds_m_approval_01.UserStatus(1) = 1  // 강제로 삽입모드로 바꿈.   
 tr_m_approval_01_success = 'N'   // 성공적이 아니다 (저장하였을경우 정상이면 'Y')
 tr_m_approval_01.Post()

 if (tr_m_approval_01_success == 'N') {
   alert('전자결재가(approval_01) 잘못되었습니다(전산실)')
   return
 }  

 ds_m_approval_02.SyncLoad=true
 ds_m_approval_02.Reset()
 var i
 for (i=1;i<=ds_m_approval_02.CountRow;i++) {
    ds_m_approval_02.UserStatus(i) = 1  // 강제로 삽입모드로 바꿈.   
    ds_m_approval_02.NameValue(i,'unq_num') = ll_temp
    ds_m_approval_02.NameValue(i,'no_seq')  = i
 }     
 tr_m_approval_02_success = 'N'   // 성공적이 아니다 (저장하였을경우 정상이면 'Y')
 tr_m_approval_02.Post()

 if (tr_m_approval_02_success == 'N') {
    alert('전자결재가(approval_02) 잘못되었습니다(전산실)')
    return
 }

 ds_m_approval_03.SyncLoad=true
 ds_m_approval_03.Reset()
 var i
 for (i=1;i<=ds_m_approval_03.CountRow;i++) {
    ds_m_approval_03.UserStatus(i) = 1  // 강제로 삽입모드로 바꿈.   
    ds_m_approval_03.NameValue(i,'unq_num') = ll_temp
    ds_m_approval_03.NameValue(i,'no_seq')  = i
 }     
 tr_m_approval_03_success = 'N'   // 성공적이 아니다 (저장하였을경우 정상이면 'Y')
 if (ds_m_approval_03.IsUpdated) {
    tr_m_approval_03.Post()
    if (tr_m_approval_03_success == 'N') {
       alert('전자결재가(approval_03) 잘못되었습니다(전산실)')
       return
    }
 }     
 
 ds_m_approval_04.SyncLoad=true
 ds_m_approval_04.Reset()
 ds_m_approval_04.ClearData()
 
 var crystal_rpt
 var arg_temp
 var w, h

 crystal_rpt = top.frames['security'].gs_crystal_addr.value 
                
// 자재청구서를 불러오기위한 청구번호 구하기
	ls_reqnum = ds_2.NameValue(ds_2.RowPosition,"request_unq_num")
	ll_cnt = f_ds_select_q("ds_num", " select requestseq select_1 from m_request_detail " +
										"  where request_unq_num = " + ls_reqnum + " ")
	ls_requestseq = ds_num.NameValue(1,"select_1")
 
 var i
 for (i=1;i<=5;i++) {
   ds_m_approval_04.AddRow()
   ds_m_approval_04.NameValue(i,'unq_num') = ll_temp
   ds_m_approval_04.NameValue(i,'no_seq') = i

   if (i == 1) {
      ds_m_approval_04.NameValue(i,'name') = '1.자재청구서'
      ds_m_approval_04.NameValue(ds_m_approval_04.RowPosition,'url') = crystal_rpt + 
                                 "Rptname=" + "const_rpt/m_web/01r/m_request_list" + 
                                 "&RptParams=" + is_dept_code + "&RptParams=" + ls_requestseq
   }                               
   if (i == 2) {
      ds_m_approval_04.NameValue(i,'name') = '2.현장설명서'
   }                               
   if (i == 3) {
      ds_m_approval_04.NameValue(i,'name') = '3.예산대비표'
		print_condition_query()
		ls_yymm 	= ds_1.NameValue(ds_1.RowPosition,"estimateyymm")
		ls_seq	= ds_1.NameValue(ds_1.RowPosition,"estimateseq")
  		ls_title = ds_1.NameValue(ds_1.RowPosition,"approtitle") + "[" + ls_yymm + " - " + ls_seq + "]"

      ds_m_approval_04.NameValue(ds_m_approval_04.RowPosition,'url') = crystal_rpt + 
                                 "Rptname=" + "const_rpt/m_web/02r/m_esti_com"   + 
                                 "&RptParams=" + ls_title + "&RptParams=" + ls_sbcr_1 +
                                 "&RptParams=" + ls_sbcr_2 + "&RptParams=" + ls_sbcr_3 +
                                 "&RptParams=" + ls_yymm + "&RptParams=" + ls_seq
   }
   if (i == 4) {
      ds_m_approval_04.NameValue(i,'name') = '4.내역서'
   }
   if (i == 5) {
      ds_m_approval_04.NameValue(i,'name') = '5.(일반,특기)시방서'
   }    
 }                             

 tr_m_approval_04_success = 'N'   // 성공적이 아니다 (저장하였을경우 정상이면 'Y')
 tr_m_approval_04.Post()
 if (tr_m_approval_04_success == 'N') {
    alert('전자결재가(approval_04) 잘못되었습니다(전산실)')
    return
 }
 
// alert(ll_temp)
// alert('성공')
 var ls_addr
 ls_addr = 'https://www.worldro.net/loginsso.aspx?ui='
 ls_addr = ls_addr + gs_user_id + ':' + gs_password + '&unq=' + ll_temp + '&type=Y03'
 ll_height = screen.availHeight  -  40
 ll_width  = screen.availWidth 
 window.showModalDialog(ls_addr,"","status:no;dialogWidth:777px;dialogHeight:737px;edge sunken;scroll:no"); 

} 
//---------------------------------------------------------------------------
function guljae_rtn()                      // 전자결재
//---------------------------------------------------------------------------
{

	alert('아직 적용 테스트 중입니다.');

	var ls_addr,ll_temp

	ls_date = em_approym.text
	ls_dept_code = ds_1.NameValue(ds_1.RowPosition,"dept_code")
	ls_seq  	= ds_1.NameString(ds_1.RowPosition,"approseq")
	ls_chg  	= ds_1.NameString(ds_1.RowPosition,"chg_cnt")
	ls_chg2  = ds_1.NameString(ds_1.RowPosition,"chg_cnt") - 1
	ls_code  = ds_3.NameString(ds_3.RowPosition,"sbcr_code")

	if (report_kind[0].checked) {
		if(ls_chg > 1){ //1차수이상일때엔 변경품의서
			//이전차수 청구번호 구하기
	   		ll_cnt = f_select_q("SELECT DISTINCT B.REQUESTSEQ select_1, B.CHG_CNT select_2 FROM M_APPROVAL_DETAIL A, M_REQUEST_DETAIL B " +
							"WHERE " +
							"	A.DEPT_CODE = '" + ls_dept_code + "' " +
							"AND A.APPROYM = '" + ls_date + "' " +
							"AND A.APPROSEQ = " + ls_seq +
							"AND A.CHG_CNT = " + ls_chg2 +
							"AND A.DEPT_CODE = B.DEPT_CODE AND A.REQUEST_CHG_CNT = B.CHG_CNT AND A.REQUEST_UNQ_NUM = B.REQUEST_UNQ_NUM")
			if (ll_cnt > 0) {
				ls_reqseq  = ds_select.NameValue(ds_select.RowPosition,"select_1")
				ls_req_chg2 = ds_select.NameValue(ds_select.RowPosition,"select_2")
			}
			//당회차수 청구번호 구하기
	   		ll_cnt = f_select_q("SELECT DISTINCT B.REQUESTSEQ select_1, B.CHG_CNT select_2 FROM M_APPROVAL_DETAIL A, M_REQUEST_DETAIL B " +
							"WHERE " +
							"	A.DEPT_CODE = '" + ls_dept_code + "' " +
							"AND A.APPROYM = '" + ls_date + "' " +
							"AND A.APPROSEQ = " + ls_seq +
							"AND A.CHG_CNT = " + ls_chg +
							"AND A.DEPT_CODE = B.DEPT_CODE AND A.REQUEST_CHG_CNT = B.CHG_CNT AND A.REQUEST_UNQ_NUM = B.REQUEST_UNQ_NUM")
			if (ll_cnt > 0) {
				ls_req_chg = ds_select.NameValue(ds_select.RowPosition,"select_2")
			}
			ll_temp = ls_dept_code + '@' + ls_date + '@' + ls_seq + '@' + ls_chg + '@' + ls_chg2 + '@' + ls_reqseq + '@' + ls_req_chg + '@' + ls_req_chg2

			ls_addr = 'https://www.worldro.net/loginsso.aspx?ui='
			ls_addr = ls_addr + gs_user_id + ':' + gs_password + '&unq=' + ll_temp + '&type=Y11'
		} else {
			//당회차수 청구번호 구하기
			ll_cnt = f_select_q("SELECT DISTINCT B.REQUESTSEQ select_1, B.CHG_CNT select_2 FROM M_APPROVAL_DETAIL A, M_REQUEST_DETAIL B " +
						"WHERE " +
						"	A.DEPT_CODE = '" + ls_dept_code + "' " +
						"AND A.APPROYM = '" + ls_date + "' " +
						"AND A.APPROSEQ = " + ls_seq +
						"AND A.CHG_CNT = " + ls_chg +
						"AND A.DEPT_CODE = B.DEPT_CODE AND A.REQUEST_CHG_CNT = B.CHG_CNT AND A.REQUEST_UNQ_NUM = B.REQUEST_UNQ_NUM")
			if (ll_cnt > 0) {
				ls_reqseq  = ds_select.NameValue(ds_select.RowPosition,"select_1")
				ls_req_chg = ds_select.NameValue(ds_select.RowPosition,"select_2")
			}
			ll_temp = ls_dept_code + '@' + ls_date + '@' + ls_seq + '@' + ls_chg + '@' + ls_reqseq + '@' + ls_req_chg

			ls_addr = 'https://www.worldro.net/loginsso.aspx?ui='
			ls_addr = ls_addr + gs_user_id + ':' + gs_password + '&unq=' + ll_temp + '&type=Y10'
		}
		ll_height = screen.availHeight  -  40
		ll_width  = screen.availWidth
		window.showModalDialog(ls_addr,"","status:no;dialogWidth:777px;dialogHeight:737px;edge sunken;scroll:no");
	}
}
//------------------------------------------------------------------------
function print_condition_query()                     //견적상위3업체선택 
//------------------------------------------------------------------------
{
	ls_yymm 	= ds_1.NameValue(ds_1.RowPosition,"estimateyymm")
	ls_seq	= ds_1.NameValue(ds_1.RowPosition,"estimateseq")
	dr_1.DataID = 'm_esti_sbcr_1q.jsp?arg_yymm=' + ls_yymm + 
	             								 "&arg_seq=" + ls_seq
	dr_1.SyncLoad=true
	dr_1.Reset()
	if(dr_1.CountRow > 0){
		ls_sbcr_1 = dr_1.NameValue(1,"sbcr_1")
		ls_sbcr_2 = dr_1.NameValue(2,"sbcr_1")
		ls_sbcr_3 = dr_1.NameValue(3,"sbcr_1")
	}else{
		ls_sbcr_1 = "A"
		ls_sbcr_2 = "A"
		ls_sbcr_3 = "A"
	}	
	if (ls_sbcr_1 == undefined )	ls_sbcr_1 = "A"
	if (ls_sbcr_2 == undefined )	ls_sbcr_2 = "A"
	if (ls_sbcr_3 == undefined )	ls_sbcr_3 = "A"
	
}

//---------------------------------------------------------------------------
function order_list_rtn()                      // 물품 발주서 전자결재
//---------------------------------------------------------------------------
{
 ls_dept_code = ds_1.NameValue(ds_1.RowPosition,"dept_code")
 ls_date = em_approym.text
 ls_seq  = ds_1.NameString(ds_1.RowPosition,"approseq")

 tr_m_order.Action = gs_home + '/const/m_web/02/m_order_1tr.jsp'
 ds_m_order.DataID = 'm_order_1q.jsp?arg_dept=' + ls_dept_code + 
                                     '&arg_date=' +  ls_date +
                                     '&arg_seq=' +  ls_seq

 ds_m_order.SyncLoad=true
 ds_m_order.Reset()
 if (ds_m_order.CountRow < 1) {
   alert('결재할 건이 없습니다')
   return
 }
 ll_cnt = f_ds_select_q('ds_seq','select s_confirm_unq_seq.nextval select_1 from dual')
 ll_temp = ds_seq.NameValue(1,'select_1')
 ll_temp = parseInt(ll_temp,10)

 var i
 for (i=1;i<=ds_m_order.CountRow;i++) {
    ds_m_order.UserStatus(i) = 1  // 강제로 삽입모드로 바꿈.   
    ds_m_order.NameValue(i,'unq_num') = ll_temp
    ds_m_order.NameValue(i,'no_seq')  = i
 }     

 tr_m_order_success = 'N'   // 성공적이 아니다 (저장하였을경우 정상이면 'Y')
 tr_m_order.Post()

 if (tr_m_order_success == 'N') {
   alert('전자결재가(m_order) 잘못되었습니다(전산실)')
   return
 }  

// alert(ll_temp)
// alert('성공')
 var ls_addr
 ls_addr = 'https://www.worldro.net/loginsso.aspx?ui='
 ls_addr = ls_addr + gs_user_id + ':' + gs_password + '&unq=' + ll_temp + '&type=Y04'
 ll_height = screen.availHeight  -  40
 ll_width  = screen.availWidth 
 window.showModalDialog(ls_addr,"","status:no;dialogWidth:777px;dialogHeight:737px;edge sunken;scroll:no"); 
}
//------------------------------------------------------------------------
function keyDown()                       //검색어 입력후 enter를 쳤을경우
//------------------------------------------------------------------------
{
	if (window.event.keyCode == 13) { 
		sbcr_search();
	} 
}
//---------------------------------------------------------------------------
function dept_code_find()                       //현장 찾기 
//---------------------------------------------------------------------------
{
	result = f_dept_code_find(tx_dept_search_name.value)
	if (result==false)return
	
//	is_dept_code = top.frames['security'].gs_dept_code.value
	is_dept_name = top.frames['security'].gs_dept_name.value

	tx_dept_search_name.value = is_dept_name
	sbcr_search()
}     

//------------------------------------------------------------------------
function get_focus(focus) // gd가 포커스를 받을때 동작.
//------------------------------------------------------------------------
{
	il_screen = focus
}

//---------------------------------------------------------------------------
function window_onload()                      // window open event
//---------------------------------------------------------------------------
{
  if (f_reject_window()) return 
   top.frames['main_title'].mouse_over()
	tr_1.Action = is_tr_1_addr
	tr_2.Action = is_tr_2_addr
	tr_3.Action = is_tr_3_addr

  	ds_seq.DataID = is_ds_seq_addr                       // SEQ NO 의 DATAID
	is_fr_date = is_fr_date.substr(0,7) + ".01"
	em_select_yymm.text = is_fr_date
	em_select_to_yymm.text = is_to_date
	
	is_sec = gf_initial_security()
	if (is_sec == 'r') {
	   button_1.style.visibility='hidden'
	   button_2.style.visibility='hidden'
	   button_3.style.visibility='hidden'
	   button_4.style.visibility='hidden'
	   button_5.style.visibility='hidden'
	   button_6.style.visibility='hidden'
	   button_7.style.visibility='hidden'
	}
	
	btnquery_onclick()
}
</SCRIPT>
<!-- ======================================================================= -->
<!--                                   Event                                 -->
<!-- ======================================================================= -->
<script language=JavaScript for=gd_1 event=onClick(row,colid)>
  if (row == 0) {
  		if (is_sort == "+" + colid)
   	  ds_1.SortExpr = "-" + colid;
  	   else
   	  ds_1.SortExpr = "+" + colid;
   	  
  	  is_sort = ds_1.SortExpr;
  	  ds_1.Sort();
  }   
</script>
<script language=JavaScript for=gd_2 event=OnExit(row,colid,olddata)>

	if (colid == "conf_amt" ) {
		if (ds_1.NameValue(ds_1.RowPosition,"vattag") == '1') {
        		ds_2.NameValue(row,"vatamt") = parseInt(ds_2.NameValue(row,"conf_amt") * 0.1)
			ds_1.NameValue(ds_1.RowPosition,"vatamt") = ds_2.NameSum('vatamt',0,0)
        	}
		ds_1.NameValue(ds_1.RowPosition,"amt") = ds_2.NameSum('amt',0,0)
	}   
	if (colid == "vatamt" ) {
		ds_1.NameValue(ds_1.RowPosition,"vatamt") = ds_2.NameSum('vatamt',0,0)
	}   
</SCRIPT>
<script language=JavaScript for=em_cash_rt event=onKillFocus()>
	if ((em_cash_rt.Modified)) {
		if (em_cash_rt.text > 100) {
			alert("현금율이 100%을 초과할 수 없습니다")
			em_cash_rt.text = ds_1.OrgNameValue(ds_1.RowPosition,"cash_rt")
		}
		else {
			ds_1.NameValue(ds_1.RowPosition,"bill_rt") =  100 - parseFloat(em_cash_rt.text)
		}
	}
</SCRIPT>
<script language=JavaScript for=ccom_vattag event=onCloseUp()>
	var i,ll_sa_vatamt,ll_chk_vatamt,ll_row,ls_codevalue
	if (ds_2.CountRow < 1) return
	
	ls_codevalue = ccom_vattag.CodeValue

	if (ccom_vattag.CodeValue == '2'){
		for(i=1;i <= ds_2.CountRow;i++) {
			ds_2.NameValue(i,"vatamt") = 0;
		}
		ds_1.NameValue(ds_1.RowPosition,"vatamt") = 0;
	}
	else{
		for(i=1;i <= ds_2.CountRow;i++) {
			ds_2.NameValue(i,"vatamt") = parseInt(ds_2.NameValue(i,"conf_amt") * 0.1);
		}
		ll_sa_vatamt = parseInt(ds_1.NameValue(ds_1.RowPosition,"amt") * 0.1);
		ll_chk_vatamt =  ds_2.NameSum('vatamt',0,0);
		if (ll_sa_vatamt != ll_chk_vatamt) {
			ll_row = ds_2.NameMax('amt',0,0);
			ll_row = ds_2.NameValueRow('amt',ll_row);
			if (ll_row == 0) {
				ll_row = ds_2.CountRow;
			}
			ds_2.NameValue(ll_row,"vatamt") = ds_2.NameValue(ll_row,"vatamt") + ll_sa_vatamt - ll_chk_vatamt;
		}
		ds_1.NameValue(ds_1.RowPosition,"vatamt") = ll_sa_vatamt;
	}
	ccom_vattag.CodeValue = ls_codevalue

	tr_1.Post()
	tr_2.Post()
</script>
<script language=JavaScript for=ccom_app_tag event=onSelChange()>
	if (ccom_app_tag.CodeValue == '1'){
		gd_3.Editable=-1
	}
	else{
		gd_3.Editable=0
	}
</script>
<script language=JavaScript for=gd_1 event=OnKeyPress(kcode)>
if (kcode == 13) {
    if (ds_1.RowPosition == ds_1.CountRow)  
        btnadd_onclick()
    else     
        ds_1.RowPosition++
}
</SCRIPT>
<script language=JavaScript for=gd_2 event=OnKeyPress(kcode)>
if (kcode == 13) {
    if (ds_2.RowPosition == ds_2.CountRow)  
        div_btnadd_onclick()
    else     
        ds_2.RowPosition++
}
</SCRIPT>
<SCRIPT language=JavaScript event=OnRowPosChanged(row) for=ds_1>
{
	if  (row < 1) return;
	if ( ds_2.IsUpdated || ds_3.IsUpdated){
		if  (confirm("변경되었습니다 저장하시겠습니까?")){
			div_btnsave_onclick()
		}
	}
	if (ds_1.NameValue(row,"app_tag") == '1') {
		gf_protect_off('tab_page_1')
		gd_3.Editable=-1
		ccom_app_tag.Enable=0
//		ccom_order_class.Enable=0
		if (ds_1.NameValue(row,'chg_cnt') > 1){
			ccom_vattag.Enable=0
		}
		em_amt.ReadOnly=true
		em_vatamt.ReadOnly=true
		em_approseq.ReadOnly=true
		em_chg_cnt.ReadOnly=true
		if (ds_1.NameValue(row,'chg_class') == '0' || ds_1.NameValue(row,'chg_class') == '2' ){
			gd_2.Editable=0
		}
		else {
			gd_2.Editable=-1
		}
	}
	else{
		gf_protect_on('tab_page_1')
//		ccom_const_class.Enable=-1   // 추후삭제 요망(이경일대리귀하)
		gd_3.Editable=0
		gd_2.Editable=0
	}
	if (ds_1.NameValue(row,'price_class') == '1') {
		if (is_price_class != '1'){
			f_select1_q("select etc_code select_1,child_name select_2 from z_code_etc_child where class_tag = '030' " )
			is_price_class = '1'
		}
		if (ds_1.NameValue(row,"app_tag") == '1') {
//			ccom_price_sup_class.Enable=-1
//			em_price_rt.Enable=0
//			bt_price.disabled=false
		}
	}
	else {
		if (ds_1.NameValue(row,'price_class') == '2') {
			if (is_price_class != '2'){
				f_select1_q("select etc_code select_1,child_name select_2 from z_code_etc_child where class_tag = '031' " )
				is_price_class = '2'
			}
			if (ds_1.NameValue(row,"app_tag") == '1') {
//				ccom_price_sup_class.Enable=-1
//				em_price_rt.Enable=-1
//				bt_price.disabled=false
			}
		}
		else {
			f_select1_q("select 0 select_1,'' select_2 from dual " )
			is_price_class = ''
//			ccom_price_sup_class.Enable=0
//			em_price_rt.Enable=0
//			bt_price.disabled=true
		}
	}

	
	div_btnquery_onclick()  
}  
</SCRIPT>
<script language=JavaScript for=gd_2 event=OnUserColor(row,eventid)>
	if(eventid == "ucolor") {
		if (ds_1.NameValue(ds_1.RowPosition,"app_tag") == '1'){
			if (ds_1.NameValue(ds_1.RowPosition,'chg_class') == '0' || ds_1.NameValue(ds_1.RowPosition,'chg_class') == '2' ){
				return "#EFEFEF"
			}
			else {
				return "White"
			}
		}
		else {
			return "#EFEFEF"
		}
	}
//				if (ds_2.NameValue(row,'pre_request_qty') != 0 && ds_1.NameValue(ds_1.RowPosition,'chg_class') == '4') {
//					return "#EFEFEF"
//					
//				}
//				else {
//					return "White"
//				}
</script>
<SCRIPT language=JavaScript event=OnRowPosChanged(row) for=ds_2>
	if (ds_1.NameValue(ds_1.RowPosition,"app_tag") == '1'){
		if (ds_1.NameValue(ds_1.RowPosition,'chg_class') == '0' || ds_1.NameValue(ds_1.RowPosition,'chg_class') == '2' ){
			gd_2.ColumnProp('unitprice', 'Edit')= 'None'
		}
		else {
			gd_2.ColumnProp('unitprice', 'Edit') = ''
		}
	}
	else {
		gd_2.ColumnProp('unitprice', 'Edit')= 'None'
	}
</script>
<script language=JavaScript for=ds_2 event=OnColumnChanged(row,colid)>
	if (colid == 'unitprice') {
		ds_2.NameValue(row,'amt') = parseInt(ds_2.NameValue(row,'qty') * ds_2.NameValue(row,'unitprice'),10)
		ds_2.NameValue(row,'conf_amt') = parseInt(ds_2.NameValue(row,'qty') * ds_2.NameValue(row,'unitprice'),10)
		ds_2.NameValue(row,'vatamt') = parseInt(ds_2.NameValue(row,'qty') * ds_2.NameValue(row,'unitprice') * 0.1,10)
		ds_1.NameValue(ds_1.RowPosition,"amt") = ds_2.NameSum('amt',0,0)
		ds_1.NameValue(ds_1.RowPosition,"vatamt") = parseInt(ds_2.NameSum('amt',0,0) * 0.1,10)
	}
</script>
<SCRIPT language=JavaScript for=em_select_yymm event=onKillFocus()>
        if (em_select_yymm.Modified){ 
	   select_yymm()
	   }
</SCRIPT>        	
<SCRIPT language=JavaScript for=em_select_yymm event=onKeyDown(kcode,scode)>
        if ((em_select_yymm.Modified) && kcode == 13 ){ 
	   select_yymm()
	   }
</SCRIPT>        	
<SCRIPT language=JavaScript for=em_select_to_yymm event=onKillFocus()>
        if (em_select_to_yymm.Modified){ 
	   select_yymm()
	   }
</SCRIPT>        	
<SCRIPT language=JavaScript for=em_select_to_yymm event=onKeyDown(kcode,scode)>
        if ((em_select_to_yymm.Modified) && kcode == 13 ){ 
	   select_yymm()
	   }
</SCRIPT>        	
<SCRIPT language=JavaScript for=ds_1 event=OnLoadError()>
  alert("Error Code(ds_1) : " + ds_1.ErrorCode + "\n" + "Error Message : " + ds_1.ErrorMsg + "\n");
</SCRIPT>

<SCRIPT language=JavaScript for=tr_1 event=OnFail()>
  alert("Error Code(tr_1) : " + tr_1.ErrorCode + "\n" + "Error Message : " + tr_1.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_2 event=OnLoadError()>
  alert("Error Code(ds_2) : " + ds_2.ErrorCode + "\n" + "Error Message : " + ds_2.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_3 event=OnLoadError()>
  alert("Error Code(ds_3) : " + ds_3.ErrorCode + "\n" + "Error Message : " + ds_3.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_4 event=OnLoadError()>
  alert("Error Code(ds_4) : " + ds_4.ErrorCode + "\n" + "Error Message : " + ds_4.ErrorMsg + "\n");
</SCRIPT>

<SCRIPT language=JavaScript for=tr_2 event=OnFail()>
  alert("Error Code(tr_2) : " + tr_2.ErrorCode + "\n" + "Error Message : " + tr_2.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_3 event=OnFail()>
  alert("Error Code(tr_3) : " + tr_3.ErrorCode + "\n" + "Error Message : " + tr_3.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_spcall event=OnLoadError()>
  alert("Error Code(ds_spcall) : " + ds_spcall.ErrorCode + "\n" + "Error Message : " + ds_spcall.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_update event=OnLoadError()>
  alert("Error Code(ds_update) : " + ds_update.ErrorCode + "\n" + "Error Message : " + ds_update.ErrorMsg + "\n");
</SCRIPT>

<SCRIPT language=JavaScript for=ds_m_approval_01  event=OnLoadError()>
  alert("Error Code(ds_m_approval_01) : " + ds_m_approval_01.ErrorCode + "\n" + "Error Message : " + ds_m_approval_01.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_m_approval_01 event=OnFail()>
  alert("Error Code(tr_m_approval_01) : " + tr_m_approval_01.ErrorCode + "\n" + "Error Message : " + tr_m_approval_01.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_m_approval_01 event=OnSuccess()>
 tr_m_approval_01_success = 'Y' 
 </SCRIPT>
<SCRIPT language=JavaScript for=ds_m_approval_02  event=OnLoadError()>
  alert("Error Code(ds_m_approval_02) : " + ds_m_approval_02.ErrorCode + "\n" + "Error Message : " + ds_m_approval_02.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_m_approval_02 event=OnFail()>
  alert("Error Code(tr_m_approval_02) : " + tr_m_approval_02.ErrorCode + "\n" + "Error Message : " + tr_m_approval_02.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_m_approval_02 event=OnSuccess()>
 tr_m_approval_02_success = 'Y' 
 </SCRIPT>
<SCRIPT language=JavaScript for=ds_m_approval_03  event=OnLoadError()>
  alert("Error Code(ds_m_approval_03) : " + ds_m_approval_03.ErrorCode + "\n" + "Error Message : " + ds_m_approval_03.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_m_approval_03 event=OnFail()>
  alert("Error Code(tr_m_approval_03) : " + tr_m_approval_03.ErrorCode + "\n" + "Error Message : " + tr_m_approval_03.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_m_approval_03 event=OnSuccess()>
 tr_m_approval_03_success = 'Y' 
 </SCRIPT>
<SCRIPT language=JavaScript for=ds_m_approval_04  event=OnLoadError()>
  alert("Error Code(ds_m_approval_04) : " + ds_m_approval_04.ErrorCode + "\n" + "Error Message : " + ds_m_approval_04.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_m_approval_04 event=OnFail()>
  alert("Error Code(tr_m_approval_04) : " + tr_m_approval_04.ErrorCode + "\n" + "Error Message : " + tr_m_approval_04.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_m_approval_04 event=OnSuccess()>
 tr_m_approval_04_success = 'Y' 
 </SCRIPT>

<SCRIPT language=JavaScript for=ds_m_order  event=OnLoadError()>
  alert("Error Code(ds_m_order) : " + ds_m_order.ErrorCode + "\n" + "Error Message : " + ds_m_order.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_m_order event=OnFail()>
  alert("Error Code(tr_m_order) : " + tr_m_order.ErrorCode + "\n" + "Error Message : " + tr_m_order.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_m_order event=OnSuccess()>
alert('bb')
 tr_m_order_success = 'Y' 
 </SCRIPT>
<!-- ======================================================================= -->
<!--                                 Component                               -->
<!-- ======================================================================= -->
 <comment id="__NSID__"><Object id=ds_seq_1
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>
 <comment id="__NSID__"><Object id=ds_num
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=dr_1 
	style="Z-INDEX: 108; LEFT: 319px; POSITION: absolute; TOP: 7px" 
	classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT></OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><Object id=ds_m_approval_01
	style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
	classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=tr_m_approval_01 
	style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
	classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:m_approval_01_1tr=ds_m_approval_01)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><Object id=ds_m_approval_02
	style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
	classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=tr_m_approval_02 
	style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
	classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:m_approval_02_1tr=ds_m_approval_02)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><Object id=ds_m_approval_03
	style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
	classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=tr_m_approval_03 
	style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
	classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:m_approval_03_1tr=ds_m_approval_03)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><Object id=ds_m_approval_04
	style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
	classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=tr_m_approval_04 
	style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
	classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:m_approval_04_1tr=ds_m_approval_04)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>

 <comment id="__NSID__"><Object id=ds_m_order
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>
 <comment id="__NSID__"><OBJECT id=tr_m_order 
      style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
      classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
  	<PARAM NAME="Action" VALUE="">
  	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
  	<PARAM NAME="KeyValue" VALUE="JSP(I:m_order_1tr=ds_m_order)">
  	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>

<comment id="__NSID__"><OBJECT id=ds_1
    style="Z-INDEX: 103; LEFT: 169px; POSITION: absolute; TOP: 3px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
	 <param name=SortExpr       value="-APPROYM">
    <param name=UseFilter       value=true></OBJECT></comment> <script> __ws__(__NSID__);</script>

<comment id="__NSID__"><OBJECT id=ds_2 
    style="Z-INDEX: 108; LEFT: 319px; POSITION: absolute; TOP: 7px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT></OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=ds_3 
    style="Z-INDEX: 108; LEFT: 319px; POSITION: absolute; TOP: 7px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT></OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=ds_4 
    style="Z-INDEX: 108; LEFT: 319px; POSITION: absolute; TOP: 7px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT></OBJECT></comment> <script> __ws__(__NSID__);</script>

<comment id="__NSID__"><OBJECT id=ds_seq 
    style="Z-INDEX: 102; LEFT: 244px; POSITION: absolute; TOP: 1px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT></OBJECT></comment> <script> __ws__(__NSID__);</script>

<comment id="__NSID__"><OBJECT id=ds_spcall 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
</OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=ds_update
    style="Z-INDEX: 103; LEFT: 169px; POSITION: absolute; TOP: 3px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT></OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><Object id=ds_select
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><Object id=ds_select1
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>
 <comment id="__NSID__"><Object id=ds_process
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT> </OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=tr_1 
    style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
    classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:m_approval_1tr=ds_1)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>
	
<comment id="__NSID__"><OBJECT id=tr_2 
    style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
    classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:m_approval_detail_1tr=ds_2)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=tr_3 
    style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
    classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:m_approval_2tr=ds_3)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>

<!-- ======================================================================= -->
<!--                                   Body                                  -->
<!-- ======================================================================= -->

<BODY style="FONT-SIZE: 12px; margin: 0;"  onload=setTimeout('window_onload()',1) oncontextmenu="return false" >
<div class=main_div>
<table width="100%"  height="100%"  BORDER="0" cellpadding=0 CELLSPACING="0"  align="center"   style="FONT-SIZE: 12px; ">
	<tr>
		<td width="100%"  class=td_green height="20" colspan=3>
	      <table  height="100%"  BORDER="0"  cellpadding=0 CELLSPACING="0" style="FONT-SIZE: 12px">
	         <tr> 
		         <td width="15px"><img src="../../../image/bullet3.gif" align="absmiddle" ></td>
	  				<td width="50" class=font_green_bold>현장명</td>
					<td width="80"> 
						<INPUT id=tx_dept_search_name  tabIndex=1 size=13  align="absmiddle" onkeyDown="keyDown()" >
					</td>
					<td width="110" >		  	
						<INPUT id=bt_sbcr_name type=button  class="img_btnFind" align="absmiddle"  value=검색 onclick=sbcr_search() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;">
		         <td width="15px"><img src="../../../image/bullet3.gif" align="absmiddle" ></td>
	  				<td width="65" class=font_green_bold>조회기간</td>
					<td width="80" > 
						<comment id="__NSID__"><OBJECT id=em_select_yymm 
						       style="Z-INDEX: 101; WIDTH: 75px ;background-color:white" 
						      classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
							    <PARAM NAME="Alignment" VALUE="1">
							    <PARAM NAME="IsComma"   VALUE="0">
							    <PARAM NAME="MaxLength" VALUE="6">
							    <PARAM NAME="Format"    VALUE="YYYY-MM-DD">
						       <param name=ClipMode    value=false>
							    <PARAM NAME="Numeric"   VALUE="0">
							    <PARAM NAME="SelectAll" VALUE="-1">
						</OBJECT></comment> <script> __ws__(__NSID__);</script></td>
	  				<td width="15" >~</td>
					<td width="80" > 
						<comment id="__NSID__"><OBJECT id=em_select_to_yymm 
						       style="Z-INDEX: 101; WIDTH: 75px ;background-color:white" 
						      classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
							    <PARAM NAME="Alignment" VALUE="1">
							    <PARAM NAME="IsComma"   VALUE="0">
							    <PARAM NAME="MaxLength" VALUE="6">
							    <PARAM NAME="Format"    VALUE="YYYY-MM-DD">
				             <param name=ClipMode    value=false>
							    <PARAM NAME="Numeric"   VALUE="0">
							    <PARAM NAME="SelectAll" VALUE="-1">
						</OBJECT></comment> <script> __ws__(__NSID__);</script></td>
					<td width="80"></td>	
					<td><INPUT   type=button style="CURSOR: hand;" class="img_btn4_1"  value=품의완료 onclick=ok_rtn() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"></td>
					<td><INPUT   type=button style="CURSOR: hand;" class="img_btn4_1"  value=품의취소 onclick=ok_cancel() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"></td>
					<td><INPUT   type=button style="" class="img_btnRpt3_1"  value=품의서 onclick=rpt_rtn1() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"></td>
					<td><INPUT   type=button style="" class="img_btnRpt3_1"  value=발주서 onclick=rpt_rtn2() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"></td>
					<td><INPUT   type=button style="" class="img_btnRpt3_1"  value=계약서 onclick=rpt_rtn3() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"></td>
	         </tr>                 
	      </table>
	   </td>
	</tr>     
	<tr>
		<td rowspan="2" width="503" height="418">
			<comment id="__NSID__"><OBJECT id=gd_1 onfocus="get_focus(1)"
			    style="FONT-SIZE: 12px; Z-INDEX: 105; WIDTH:100%; HEIGHT: 100%" 
			    classid=clsid:1F57AEAD-DB12-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
				<PARAM NAME="MultiRowSelect" VALUE="-1">
				<PARAM NAME="AllShowEdit" VALUE="-1">
			   <PARAM NAME="BorderStyle"  VALUE=1>
				<PARAM NAME="AutoInsert" VALUE="-1">
				<PARAM NAME="Editable" VALUE="0">
				<PARAM NAME="ColSizing" VALUE="-1">
				<PARAM NAME="DataID" VALUE="ds_1">
				<PARAM NAME="Format" VALUE=" 
				  <C> Name='현장명' ID=long_name Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Width=150 </C>
				  <C> Name='품의일자' ID=approym Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Width=70 </C> 
				  <C> Name='품의번호' ID=appro_no Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Width=50 </C> 
				  <C> Name='제목' ID=approtitle Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Width=160 </C>
				  <C> Name='구분' ID=app_tag Edit=None Align=Center BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Width=55 
				  		EditStyle=Combo Data='1:품의중,3:품의완료 '</C>
			      ">
			</OBJECT></comment> <script> __ws__(__NSID__);</script>
		</td>
		<td width="5"></td>
		<td width="495" height="280">
			<DIV id=tab_page_1 style="WIDTH: 100%; HEIGHT: 100%; BACKGROUND-COLOR: #FFFFFF">
				<table width="100%"  BORDER="3" height="100%"  CELLSPACING="0"  align="center"   style="FONT-SIZE: 12px">
					<tr BGCOLOR="white"> 
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK" colspan=3 > 
							<div align="right">*품의일자</div></td>
						<td width="20%" colspan=4> 
							<comment id="__NSID__"><OBJECT id=em_approym tabIndex=1 
								style="WIDTH: 80px; " 
								classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="1">
								<PARAM NAME="ReadOnly" VALUE="-1">
			                                    	<param name=ReadOnlyBackColor     value="#F2F2F2">
								<PARAM NAME="Format" VALUE="YYYY-MM-DD">
								<PARAM NAME="SelectAll" VALUE="-1">
								<PARAM NAME="PromptChar" VALUE="">
							</OBJECT></comment> <script> __ws__(__NSID__);</script></td>
						<td width="15%"   BGCOLOR="#CA7944" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">품의구분</div></td>
						<td width="15%" colspan=3> 
							<comment id="__NSID__"><object id=ccom_app_tag 
								classid=CLSID:FD4C6571-DD20-11D2-973D-00104B15E56F
			                                        height=106 width=60 VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="1">
								<param name=Data     value="1^품의중,3^품의완료">
			               <param name=ReadOnlyBackColor     value="#F2F2F2">
			               <param name=Auto     value=false>
								<param name=Enable   value=false>
								<param name=DataID     value=ds_1>
								<param name=CodeColumn value=app_tag>
							</OBJECT></comment> <script> __ws__(__NSID__);</script></td>
			<!--			<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">청구구분</div></td>
						<td width="15%"  colspan=3> 
							<comment id="__NSID__"><object id=ccom_order_class 
								classid=CLSID:FD4C6571-DD20-11D2-973D-00104B15E56F
			                                        height=106 width=60 VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="1">
								<param name=Data     value="1^총액,2^단가">
			               <param name=ReadOnlyBackColor     value="#F2F2F2">
			               <param name=Auto     value=false>
								<param name=Enable   value=false>
								<param name=DataID     value=ds_1>
								<param name=CodeColumn value=order_class>
							</OBJECT></comment> <script> __ws__(__NSID__);</script></td>-->
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">*품의번호</div></td>
						<td width="10%"  colspan=2> 
							<comment id="__NSID__"><OBJECT id=em_approseq tabIndex=-1
								style="WIDTH: 40px;" 
								classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="1">
								<PARAM NAME="ReadOnly" VALUE="-1">
			               <param name=ReadOnlyBackColor     value="#F2F2F2">
								<PARAM NAME="MaxLength" VALUE="13">
								<PARAM NAME="SelectAll" VALUE="-1">
								<PARAM NAME="PromptChar" VALUE="">
							</OBJECT></comment> <script> __ws__(__NSID__);</script> </td>
						<td width="10%" colspan=2> 
							<comment id="__NSID__"><OBJECT id=em_chg_cnt tabIndex=-1
								style="WIDTH: 40px;" 
								classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="1">
								<PARAM NAME="ReadOnly" VALUE="-1">
			               <param name=ReadOnlyBackColor     value="#F2F2F2">
								<PARAM NAME="MaxLength" VALUE="13">
								<PARAM NAME="SelectAll" VALUE="-1">
								<PARAM NAME="PromptChar" VALUE="">
							</OBJECT></comment> <script> __ws__(__NSID__);</script></td>
			         	</tr>                 
					<tr BGCOLOR="white"> 
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">*제목</div></td>
						<td width="50%" colspan=10> 
			        		<INPUT id=tx_approtitle readonly MAXLENGTH=100 tabIndex=3 size=30></td>
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">발주일자</div></td>
						<td width="20%" colspan=4> 
							<comment id="__NSID__"><OBJECT id=em_approdate 
								style="WIDTH: 80px;" 
								classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="1">
								<PARAM NAME="ReadOnly" VALUE="-1">
			               <param name=ReadOnlyBackColor     value="#F2F2F2">
								<PARAM NAME="Format" VALUE="YYYY-MM-DD">
								<PARAM NAME="SelectAll" VALUE="-1">
								<PARAM NAME="PromptChar" VALUE="">
							</OBJECT></comment> <script> __ws__(__NSID__);</script></td>
			         	</tr>                 
			<!--		<tr BGCOLOR="white"> 
						<td width="15%"   BGCOLOR="#CA7944" style="COLOR: WHITE"  colspan=3 > 
							<div align="right">계약구분</div></td>
						<td width="20%" colspan=4> 
							<comment id="__NSID__"><object id=ccom_const_class 
								classid=CLSID:FD4C6571-DD20-11D2-973D-00104B15E56F
			                                        height=106 width=90 VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="1">
								<param name=Data     value="1^일반계약,2^발주,3^전자계약">
			               <param name=ReadOnlyBackColor     value="#F2F2F2">
			               <param name=Auto     value=false>
								<param name=Enable   value=false>
								<param name=DataID     value=ds_1>
								<param name=CodeColumn value=const_class>
							</OBJECT></comment> <script> __ws__(__NSID__);</script></td>
			     	</tr>                 
					<tr BGCOLOR="white"> 
						<td width="15%"   BGCOLOR="#CA7944" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">단가적용</div></td>
						<td width="35%" colspan=7> 
							<comment id="__NSID__"><object id=ccom_price_sup_class
								classid=CLSID:FD4C6571-DD20-11D2-973D-00104B15E56F
			                                        height=106 width=166 VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="1">
								<param name=ComboDataID         value=ds_select1>
			               <param name=CodeCColumn        value=select_1>
			               <param name=DataCColumn         value=select_2>
			               <param name=ReadOnlyBackColor     value="#F2F2F2">
			               <param name=Auto     value=false>
								<param name=Enable   value=false>
							</OBJECT></comment> <script> __ws__(__NSID__);</script></td>
						<td width="15%"   BGCOLOR="#CA7944" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">적용율(%)</div></td>
						<td width="15%" colspan=3> 
							<comment id="__NSID__"><OBJECT id=em_price_rt
								style="WIDTH: 60px;" 
								classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="1">
								<param name=Numeric                 value=true>
								<PARAM NAME="PromptChar" VALUE="">
								<param name=MaxDecimalPlace   value=2>
							</OBJECT></comment> <script> __ws__(__NSID__);</script>
							</td>
						<td width="20%" colspan=4> 
						  	<INPUT id=bt_price type=button value=단가적용 onclick=price_comp()>
							</td>
			     	</tr>        -->         
					<tr BGCOLOR="white"> 
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">현장담당자</div></td>
						<td width="35%" colspan=7 > 
			                  		<INPUT id=tx_charge  MAXLENGTH=100 tabIndex=5 size=22></td>
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">부가세구분</div></td>
						<td width="35%" colspan=7 > 
							<comment id="__NSID__"><object id=ccom_vattag 
								classid=CLSID:FD4C6571-DD20-11D2-973D-00104B15E56F
			                                        height=106 width=166 VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="1">
								<param name=Data     value="1^매입과세,2^매입면세,3^매입불공제,4^매입공통">
			               <param name=Auto     value=false>
								<param name=Enable   value=true>
								<param name=DataID     value=ds_1>
								<param name=CodeColumn value=vattag>
							</OBJECT></comment> <script> __ws__(__NSID__);</script></td>
			         	</tr>                 
					<tr BGCOLOR="white"> 
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK" colspan=3  > 
							<div align="right">금액</div></td>
						<td width="35%"  colspan=7> 
							<comment id="__NSID__"><OBJECT id=em_amt tabIndex=-1 
								style="WIDTH: 166px;" 
								classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="2">
								<PARAM NAME="ReadOnly" VALUE="-1">
								<PARAM NAME="PromptChar" VALUE="">
							</OBJECT></comment> <script> __ws__(__NSID__);</script></td>
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">부가세</div></td>
						<td width="35%"  colspan=7 > 
							<comment id="__NSID__"><OBJECT id=em_vatamt tabIndex=-1 
								style="WIDTH: 166px;" 
								classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="2">
								<PARAM NAME="ReadOnly" VALUE="-1">
								<PARAM NAME="PromptChar" VALUE="">
							</OBJECT></comment> <script> __ws__(__NSID__);</script></td>
			         	</tr>                 
					<tr BGCOLOR="white"> 
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">납기일자</div></td>
						<td width="35%" colspan=7> 
							<comment id="__NSID__"><OBJECT id=em_deliverylimitdate tabIndex=8 
								style="WIDTH: 166px;" 
								classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="1">
								<PARAM NAME="Format" VALUE="YYYY-MM-DD">
								<PARAM NAME="SelectAll" VALUE="-1">
								<PARAM NAME="PromptChar" VALUE="">
							</OBJECT></comment> <script> __ws__(__NSID__);</script></td>
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK" colspan=3  > 
							<div align="right">하자조건</div></td>
						<td width="35%" colspan=7> 
			          		<INPUT id=tx_check_method  MAXLENGTH=20 tabIndex=9 size=22></td>
			         	</tr>                 
					<tr BGCOLOR="white"> 
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">지불조건</div></td>
						<td width="35%" colspan=7> 
			         		<INPUT id=tx_deliverymethod  MAXLENGTH=100 tabIndex=10 size=22></td>
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">결제조건</div></td>
								<td width="35%" colspan=7> 
			      		<INPUT id=tx_paymentmethod  MAXLENGTH=100 tabIndex=11 size=22></td>
			   	</tr>                 
					<tr BGCOLOR="white"> 
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">선급금</div></td>
						<td width="35%" colspan=7> 계약체결 후 
			         		<INPUT id=tx_pre_pay_dat  MAXLENGTH=100 tabIndex=12 size=2>일 이내</td>
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">하자기간</div></td>
						<td width="35%" colspan=7> 납품완료일로부터 
			         		<INPUT id=tx_as_term  MAXLENGTH=100 tabIndex=13 size=2>개월</td>
			   	</tr>                 
					<tr BGCOLOR="white"> 
						<td width="15%"   BGCOLOR="#53A9FF" style="COLOR: WHITE"  colspan=3 > 
							<div align="right">보증율(%)</div></td>
						<td width="10%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=2 > 
							<div align="right">계약</div></td>
						<td width="15%" colspan=3> 
							<comment id="__NSID__"><OBJECT id=em_const_guar_amt tabIndex=14 
								style="WIDTH: 50px;" 
								classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="2">
								<param name=Numeric                 value=true>
								<PARAM NAME="PromptChar" VALUE="">
						      <PARAM NAME="MaxLength" VALUE="6">
								<param name=MaxDecimalPlace   value=3>
							</OBJECT></comment> <script> __ws__(__NSID__);</script>%</td>
						<td width="10%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=2 > 
							<div align="right">하자</div></td>
						<td width="15%" colspan=3> 
							<comment id="__NSID__"><OBJECT id=em_as_guar_amt tabIndex=15 
								style="WIDTH: 50px;" 
								classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="2">
								<param name=Numeric                 value=true>
								<PARAM NAME="PromptChar" VALUE="">
						      <PARAM NAME="MaxLength" VALUE="6">
								<param name=MaxDecimalPlace   value=3>
							</OBJECT></comment> <script> __ws__(__NSID__);</script>%</td>
						<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK"  colspan=3 > 
							<div align="right">지체보상율</div></td>
						<td width="20%" colspan=4> 
							<comment id="__NSID__"><OBJECT id=em_delay_amt tabIndex=16 
								style="WIDTH: 50px;" 
								classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
								<PARAM NAME="Alignment" VALUE="2">
								<param name=Numeric                 value=true>
								<PARAM NAME="PromptChar" VALUE="">
						      <PARAM NAME="MaxLength" VALUE="6">
								<param name=MaxDecimalPlace   value=3>
							</OBJECT></comment> <script> __ws__(__NSID__);</script>%</td>
			   	</tr>                 
					<tr BGCOLOR="white"> 
			       		<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK" colspan=3  > 
			           		<div align="right">선정경위</div></td>
			       		<td width="85%" colspan=17> 
			              	<TEXTAREA id=tx_remark2 rows=3 tabIndex=17 cols=55></TEXTAREA></td>
			   	</tr>                 
					<tr BGCOLOR="white"> 
			       		<td width="15%"   BGCOLOR="#BBE0F4" style="COLOR: BLACK" colspan=3  > 
			           		<div align="right">특기사항</div></td>
			       		<td width="85%" colspan=17> 
			              	<TEXTAREA id=tx_remark1 rows=3 tabIndex=18 cols=55></TEXTAREA></td>
			   	</tr>
				</table>    
			</DIV>
		</td>
	</tr>
	<tr>
	   <td width="5" ></td>
		<td width="495" height="90">
		   <comment id="__NSID__"><OBJECT id=gd_3 onfocus="get_focus(3)"
			    style="FONT-SIZE: 12px; Z-INDEX: 105; WIDTH:100%; HEIGHT: 100%" 
			    classid=clsid:1F57AEAD-DB12-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
				<PARAM NAME="MultiRowSelect" VALUE="-1">
			   <PARAM NAME="BorderStyle"  VALUE=1>
				<PARAM NAME="AllShowEdit" VALUE="-1">
				<PARAM NAME="Editable" VALUE="-1">
				<PARAM NAME="ColSizing" VALUE="-1">
				<PARAM NAME="DataID" VALUE="ds_3">
				<PARAM NAME="Format" VALUE=" 
					  <C> Name='선정업체명' ID=sbcr_name Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Width=170  BgColor=#F2F2F2  </C>
					  <C> Name='공급담당자' ID=sbcr_owner   BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Width=130  </C> 
					  <C> Name='전화/Fax번호' ID=tel_fax  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=150  </C> 
			      ">
			</OBJECT></comment> <script> __ws__(__NSID__);</script>
		</td>
	</tr>
	<tr><td height="5"></td></tr>
   <tr>
   	<td width="100%" height="25%" colspan=3>
			<comment id="__NSID__"><OBJECT id=gd_2 onfocus="get_focus(2)"
			    style="FONT-SIZE: 12px; Z-INDEX: 105; WIDTH:100%; height:100%" 
			    classid=clsid:1F57AEAD-DB12-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
				<PARAM NAME="MultiRowSelect" VALUE="-1">
			   <PARAM NAME="BorderStyle"  VALUE=1>
				<PARAM NAME="AllShowEdit" VALUE="-1">
				<PARAM NAME="Editable" VALUE="-1">
				<PARAM NAME="ColSizing" VALUE="-1">
			   <param name="ViewSummary"    value=1>
				<PARAM NAME="DataID" VALUE="ds_2">
				<PARAM NAME="Format" VALUE=" 
					  <FC> Name='순번' ID=approdetailseq Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Width=30  BgColor=#F2F2F2  </C>
					  <FC> Name='*자재코드' ID=mtrcode  Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=80  BgColor=#F2F2F2 
			             SumText='합 계'  SumColor=Black SumBgColor=Pink  </C>
					  <C> Name='*명칭' ID=name Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Width=200  BgColor=#F2F2F2 </C> 
					  <C> Name='규격' ID=ssize Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=150  BgColor=#F2F2F2 </C> 
					  <C> Name='단위' ID=unitcode Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=40  BgColor=#F2F2F2 </C> 
					  <C> Name='수량' ID=qty Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=80  BgColor=#F2F2F2 
					  		   SumText=@sum   SumColor=Black SumBgColor=Pink </C> 
					   <C> Name='단가' ID=unitprice  BgColor=@ucolor  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=80 </C> 
					   <C> Name='금액' ID=amt Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=80  BgColor=#F2F2F2 
					  			SumText=@sum  SumColor=Black SumBgColor=Pink </C> 
					   <C> Name='투입내역' ID=spec_name Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=220  BgColor=#F2F2F2 </C> 
			      ">
			</OBJECT></comment> <script> __ws__(__NSID__);</script>
		</td>
	</tr>
</table>		  
</div>

<comment id="__NSID__"><OBJECT id=bd_data 
    	style="Z-INDEX: 108; LEFT: 124px; WIDTH: 22px; POSITION: absolute; TOP: -37px; HEIGHT: 18px" 
    	classid=clsid:9C9AB433-EA85-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
	<PARAM NAME="DataID" VALUE="ds_1">
	<PARAM NAME="BindInfo" VALUE="
	    	<C>Col=approym      	 Ctrl=em_approym Param=text Enable=enable</C>
		<C>Col=approseq       	 Ctrl=em_approseq Param=text Enable=enable</C>
		<C>Col=chg_cnt       	 Ctrl=em_chg_cnt Param=text Enable=enable</C>
		<C>Col=approtitle        Ctrl=tx_approtitle Param=value Enable=enable</C>
		<C>Col=approdate      	 Ctrl=em_approdate Param=text Enable=enable</C>
		<C>Col=charge        	 Ctrl=tx_charge Param=value Enable=enable</C>
		<C>Col=amt            	 Ctrl=em_amt Param=text Enable=enable</C>
		<C>Col=vatamt            Ctrl=em_vatamt Param=text Enable=enable</C>
		<C>Col=prepayment        Ctrl=em_prepayment Param=text Enable=enable</C>
		<C>Col=cash_rt           Ctrl=em_cash_rt Param=text Enable=enable</C>
		<C>Col=bill_rt           Ctrl=em_bill_rt Param=text Enable=enable</C>
		<C>Col=deliverylimitdate Ctrl=em_deliverylimitdate Param=text Enable=enable</C>
		<C>Col=deliverycondition Ctrl=tx_deliverycondition Param=value Enable=enable</C>
		<C>Col=deliverymethod    Ctrl=tx_deliverymethod Param=value Enable=enable</C>
		<C>Col=paymentmethod     Ctrl=tx_paymentmethod Param=value Enable=enable</C>
		<C>Col=remark1         	 Ctrl=tx_remark1 Param=value Enable=enable</C>
		<C>Col=remark2         	 Ctrl=tx_remark2 Param=value Enable=enable</C>
		<C>Col=check_method    	 Ctrl=tx_check_method Param=value Enable=enable</C>
    	<C>Col=price_sup_class   Ctrl=ccom_price_sup_class Param=codevalue Enable=enable</C>
    	<C>Col=price_rt      	 Ctrl=em_price_rt Param=text Enable=enable</C>
		<C>Col=pre_pay_dat    	 Ctrl=tx_pre_pay_dat Param=value Enable=enable</C>
    	<C>Col=const_guar_amt  	 Ctrl=em_const_guar_amt Param=text Enable=enable</C>
    	<C>Col=as_guar_amt     	 Ctrl=em_as_guar_amt Param=text Enable=enable</C>
    	<C>Col=delay_amt      	 Ctrl=em_delay_amt Param=text Enable=enable</C>
		<C>Col=as_term		    	 Ctrl=tx_as_term Param=value Enable=enable</C>
	" >
</OBJECT></comment> <script> __ws__(__NSID__);</script>

</BODY></HTML>
