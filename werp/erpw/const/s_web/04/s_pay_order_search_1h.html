<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- **************************************************************		-->
<!-- 1. 프로그램 id   : s_pay_order_search_1h.html 								-->
<!-- 2. 유형(시나리오):  찾기														-->
<!-- 3. 기 능 정 의   :  해당기성차수에 등록되어있지않는 계약내역 찾기										-->
<!-- 4. 변 경 이 력   :  박두현 작성																		-->
<!-- 5. 관련프로그램  :																						-->
<!-- 6. 특 기 사 항   :																							-->
<!-- *************************************************************		-->
<HTML><HEAD>
<META http-equiv=Content-Type content="text/html; charset=ks_c_5601-1987">
<META content="MSHTML 6.00.2716.2200" name=GENERATOR>
<LINK rel="stylesheet" type="text/css" href="../../../erpw.css">
<SCRIPT SRC="../../../comm_function/comm_function.js"></SCRIPT> 
<TITLE> 계약 찾기 </TITLE>

<SCRIPT SRC="../../../comm_function/comm_wid.js"></SCRIPT>

<SCRIPT SRC="../../../comm_function/comm_wid.js"></SCRIPT>
<SCRIPT language=JavaScript>

var is_ds_1_addr = 's_pay_order_search_1q.jsp' 
var is_confirm_check = 'no'
var is_dept_code
var is_date_seq
//------------------------------------------------------------------------
function keyDown()                       //검색어 입력후 enter를 쳤을경우
//------------------------------------------------------------------------
{
	if (window.event.keyCode == 13) { 
		btnquery_onclick();
	} 
}

//---------------------------------------------------------------
function btnquery_onclick()               //조회 
//---------------------------------------------------------------
{
	var i,ll_order_number,ll_cnt,ls_chk,ls_reson,ls_guarantee_yn,ls_to_date
	
	ds_1.DataID = is_ds_1_addr + "?arg_dept_code=" + is_dept_code + "&arg_date_seq=" + is_date_seq 
	ds_1.SyncLoad=true
	ds_1.reset()
  
	if (ds_1.CountRow > 0) {
		for (i=1 ; i <= ds_1.CountRow ;i++){
//			if (ds_1.NameValue(i,'order_class') != '2') { // 현재 납품설치도 통제함.
				ll_order_number = ds_1.NameValue(i,'order_number')
				ls_guarantee_yn = ds_1.NameValue(i,'guarantee_yn')
				if (ls_guarantee_yn == 'N') {
					ll_cnt = f_select_q("select send_yn select_1,nosend_reson select_2,to_char(guarantee_end_dt,'YYYYMM') select_3 " +
					                     " from s_guarantee_accept " +
					                     " where dept_code = '" + is_dept_code + "'" +
					                     "   and order_number = " + ll_order_number +
					                     "   and guarantee_class = '1' ")
	 				if (ll_cnt < 1 ) {
						ds_1.NameValue(i,'temp_chk') = 'Y'
					}
					else {
						ls_chk     = ds_select.NameValue(ds_select.RowPosition,'select_1')
						ls_reson   = ds_select.NameValue(ds_select.RowPosition,'select_2')
						ls_to_date = ds_select.NameValue(ds_select.RowPosition,'select_3')
						if ( ls_to_date < is_date_seq.substr(0,6) ){
							ds_1.NameValue(i,'temp_chk') = 'Y'
						}
					}
				}
				if (ds_1.NameValue(i,'order_class') != '2') {
					ll_cnt = f_select_q("select send_yn select_1,nosend_reson select_2 " +
					                     " from s_guarantee_accept " +
					                     " where dept_code = '" + is_dept_code + "'" +
					                     "   and order_number = " + ll_order_number +
					                     "   and guarantee_class = '4' ")
					if (ll_cnt < 1) {
						ds_1.NameValue(i,'temp_chk') = 'Y'
					}
					else {
						ls_chk   = ds_select.NameValue(ds_select.RowPosition,'select_1')
						ls_reson = ds_select.NameValue(ds_select.RowPosition,'select_2')
					}
				}
//			}
		}
	}          

 
}
//----------------------------------------------------------------
function Button_close_onclick()               //닫기
//----------------------------------------------------------------
{
 window.returnValue = "";
 window.close();
}
//--------------------------------------------------------------------
function Button_confirm_onclick()               //확인
//--------------------------------------------------------------------
{
  is_confirm_check = 'yes'
  var ls_return="",i
  
 for (i=1 ; i <= ds_1.CountRow ;i++){
   if (ds_1.RowMark(i) == 1){
//kdw 적용후 풀것   	if (ds_1.NameValue(i,'temp_chk') == 'N') {
	      ls_return = ls_return + ds_1.NameValue(i,'order_number') + '@' 
//      }
   }
 }          
 window.returnValue = ls_return
 window.close();
  
}
//----------------------------------------------------------------
function window_onload()                  // window open event 
//-----------------------------------------------------------------
{
 var result;
 var array = new Array();
 result = window.dialogArguments;
 array = result.split("@");
 is_dept_code= array[0]   //부서코드 
 is_date_seq = array[1]   //현월 + seq   ex)2003011
 btnquery_onclick()
}
//-----------------------------------------------------------------
function window_onunload()     // windoe.close()문장을 만나면 이루틴은 자동으로 수행됨으로 복사여부를 체크.
//-----------------------------------------------------------------
{
  if (is_confirm_check == 'no')
      window.returnValue = ""
}

</SCRIPT>

</HEAD>
<BODY style="FONT-SIZE: 12px" onload=setTimeout('window_onload()',1)  onunload=window_onunload()>
<SCRIPT language=JavaScript for=ds_1 event=OnLoadError()>
  alert("Error Code(ds_1) : " + ds_1.ErrorCode + "\n" + "Error Message : " + ds_1.ErrorMsg + "\n");
</SCRIPT>
<script language=JavaScript for=gd_1 event=OnDblClick(row,colid)>
	ds_1.RowPosition=row
	Button_confirm_onclick()
</SCRIPT>
<comment id="__NSID__"><OBJECT id=ds_1 
    style="Z-INDEX: 101; LEFT: 156px; POSITION: absolute; TOP: 3px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 ></OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><Object id=ds_select
   style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 10px" 
   classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49> </OBJECT></comment> <script> __ws__(__NSID__);</script>

<BR>    
보증서 미접수 업체는 추가하실 수 없습니다...
<INPUT  id=Button_query style="LEFT: 280px; POSITION: absolute; TOP: 7px" type=button  class="img_btnFind"  value=조회 onclick=btnquery_onclick() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;">
<INPUT  id=Button_confrim style="LEFT: 360px; POSITION: absolute; TOP: 7px" type=button  class="img_btnOk"  value=확인 onclick=Button_confirm_onclick() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;">
<INPUT  id=Button_close style="LEFT: 410px; POSITION: absolute; TOP: 7px" type=button  class="img_btnClose"  value=닫기 onclick=Button_close_onclick() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;">
<comment id="__NSID__"><OBJECT id=gd_1 
    style="Z-INDEX: 105; LEFT: 10px; WIDTH: 560px; POSITION: absolute; TOP: 35px; HEIGHT: 500px" 
    classid=clsid:1F57AEAD-DB12-11D2-A4F9-00608CEBEE49 >
	<PARAM NAME="AutoInsert" VALUE="0">
	<PARAM NAME="AllShowEdit" VALUE="0">
	 <param name="MultiRowSelect"   value="-1">
   <PARAM NAME="BorderStyle"  VALUE=4>
	<PARAM NAME="Editable" VALUE="0">
	<PARAM NAME="ColSizing" VALUE="-1">
	<PARAM NAME="DataID" VALUE="ds_1">
	<PARAM NAME="Format" VALUE="
	   <C> Name=보증서여부 ID=temp_chk Align=Center HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK   Width=80 
	   		EditStyle=Combo Data='N:접수,Y:미접수 '</C>
	   <C> Name=발주번호 ID=order_number HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK   Width=60 </C>
	   <C> Name='계약명' ID=sbc_name HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK   Width=320 </C>&#13;&#10;&#9; 
	   <C> Name='기성년월' ID=yymm HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK   Width=60 </C>&#13;&#10;&#9; 
       ">&#13;&#10;&#9; 
 	</OBJECT></comment> <script> __ws__(__NSID__);</script>
</BODY></HTML>
