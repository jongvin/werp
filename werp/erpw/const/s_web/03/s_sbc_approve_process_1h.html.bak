<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- **************************************************************		-->
<!-- 1. 프로그램 id   : s_sbc_approve_process_1h.html				-->
<!-- 2. 유형(시나리오): shared window 조회및 입력					-->
<!-- 3. 기 능 정 의   : 외주계약승인 프로세스  	  				-->
<!-- 4. 변 경 이 력   : 김 동우 작성						-->
<!-- 5. 관련프로그램  :								-->
<!-- 6. 특 기 사 항   :								-->
<!-- *************************************************************		-->
<HTML><HEAD>
<META http-equiv=Content-Type content="text/html; charset=ks_c_5601-1987">
<META content="MSHTML 6.00.2716.2200" name=GENERATOR>
<LINK rel="stylesheet" type="text/css" href="../../../erpw.css">
<SCRIPT SRC="../../../comm_function/comm_calendar.js"></SCRIPT> 
<SCRIPT SRC="../../../comm_function/comm_function.js"></SCRIPT> 


<SCRIPT SRC="../../../comm_function/comm_wid.js"></SCRIPT>
<SCRIPT language=JavaScript>

var gs_home = top.frames['security'].gs_home.value
var is_user = top.frames['security'].user_id.value
var is_ds_1_addr = gs_home + '/const/s_web/03/s_sbc_approve_process_1q.jsp?arg_class='
var is_tr_1_addr = gs_home + '/const/s_web/03/s_sbc_approve_process_1tr.jsp'
var is_dept_code,is_long_name = ''
var is_format_1              
var is_format_2              
var is_class = "2"

is_format_1 ="<C> Name='요청일자' ID=request_dt Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Color=#CC0066  Width=70 </C> " +
     "<C> Name='계약일자' ID=sbc_dt Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Color=#CC0066  Width=70 </C> " +
	  "<C> Name='상태' ID=approve_class Edit=None Align=Center EditStyle=Lookup Data='ds_select:select_1:select_2'  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK    Width=50 </C> " +
	  "<C> Name='현 장 명' ID=long_name  Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK    Width=170 </C> " +
	  "<C> Name='발주번호' ID=order_number Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=55 </C> " +
	  "<C> Name='계약차수' ID=chg_degree Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=55 </C> " +
	  "<C> Name='구    분' ID=order_class EditStyle=Combo Data='1:외주,2:납품설치'  Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=60 </C> " +
	  "<C> Name='발 주 명' ID=order_name Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=140 </C> " +
	  "<C> Name='계 약 명' ID=sbc_name Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=140 </C> " +
	  "<C> Name='계약금액' ID=sbc_amt Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=90 </C> " +
	  "<C> Name='부가세'   ID=vat Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=70 </C> " +
	  "<C> Name='계약업체' ID=sbcr_name Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=140 </C> " + 
//	  "<C> Name='전자계약' ID=ebid_yn EditStyle=Combo Data='1:예,2:아니오'  Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=60 </C> " +
	  "<C> Name='전문공종' ID=profession_wbs_name Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=140 </C> "  
	  
is_format_2 = "<C> Name='승인일자' ID=approve_dt Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Color=#CC0066  Width=70 </C> " +
     "<C> Name='계약일자' ID=sbc_dt Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK Color=#CC0066  Width=70 </C> " +
	  "<C> Name='상태' ID=approve_class Edit=None Align=Center EditStyle=Lookup Data='ds_select:select_1:select_2'  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK    Width=50 </C> " +
	  "<C> Name='현 장 명' ID=long_name  Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK    Width=170 </C> " +
	  "<C> Name='발주번호' ID=order_number Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=55 </C> " +
	  "<C> Name='계약차수' ID=chg_degree Edit=None Align=Center  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=55 </C> " +
	  "<C> Name='구    분' ID=order_class EditStyle=Combo Data='1:외주,2:납품설치'  Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=60 </C> " +
	  "<C> Name='발 주 명' ID=order_name Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=140 </C> " +
	  "<C> Name='계 약 명' ID=sbc_name Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=140 </C> " +
	  "<C> Name='계약금액' ID=sbc_amt Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=90 </C> " +
	  "<C> Name='부가세'   ID=vat Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=70 </C> " +
	  "<C> Name='계약업체' ID=sbcr_name Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=140 </C> " + 
//	  "<C> Name='전자계약' ID=ebid_yn EditStyle=Combo Data='1:예,2:아니오'  Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=60 </C> " +
	  "<C> Name='전문공종' ID=profession_wbs_name Edit=None  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK  Width=140 </C> "  
</SCRIPT>

<!-- ======================================================================= -->
<!--                                 Function                                -->
<!-- ======================================================================= -->
<SCRIPT language=JavaScript>	  
//------------------------------------------------------------------------
function btnquery_onclick()                     // 조회  
//------------------------------------------------------------------------
{
   is_from_date = em_from_date.text.substr(0,4) + "." + em_from_date.text.substr(4,2)  + "." +  em_from_date.text.substr(6,2)
   is_to_date = em_to_date.text.substr(0,4) + "." + em_to_date.text.substr(4,2)  + "." +  em_to_date.text.substr(6,2)

	ds_1.DataID = is_ds_1_addr + is_class + '&arg_dept_name=' + is_long_name + 
	                            '&arg_from_date=' +  is_from_date + '&arg_to_date=' + is_to_date + '&arg_sbcr_name=' + tx_sbcr_search_name.value +
	                            '&arg_wbs_name=' + tx_wbs_name.value
	ds_1.SyncLoad=true
	ds_1.Reset()
	if (is_class == "2") {
		ds_1.SortExpr = "-request_dt" 
	}
	else {
		ds_1.SortExpr = "-approve_dt"
	}
	ds_1.Sort();
}
//--------------------------------------------------------------------------
function   dept_search()
//----------------------------------------------------------------
{
	if (dept_name.value == '') {
		is_long_name = ''
	}
	else {
		is_long_name = dept_name.value
	}
	btnquery_onclick()
}
//-----------------------------------------------------------------------
function Fn_SetColumn()   // 커서위치 세팅
//-----------------------------------------------------------------------
{
	gd_1.Focus();
//	gd_1.SetColumn("vat");
} 
//-----------------------------------------------------------------------
function init_move()               // 초기값세팅
//-----------------------------------------------------------------------
{
	 Fn_SetColumn()
}
//-----------------------------------------------------------------------
function btnadd_onclick()                       // 추가 
//------------------------------------------------------------------------
{
//	 ds_1.AddRow()
//	 init_move()
}
//-----------------------------------------------------------------------
function btninsert_onclick()                    // 삽입
//-----------------------------------------------------------------------
{
//	 ds_1.InsertRow(ds_1.RowPosition)
//	 init_move()
}

//------------------------------------------------------------------------
function btndelete_onclick()                    // 삭제 
//------------------------------------------------------------------------
{
//	  if  (gd_1.MultiRowSelect){               // multi row select 일 경우
//	     for (i=ds_1.CountRow ;i >0 ;i--)
//	     {
//	        if (ds_1.RowMark(i) == 1)
//	               ds_1.DeleteRow(i)
//	    }   
//	    ds_1.MarkRows(ds_1.RowPosition,ds_1.RowPosition)  //삭제작업완료후 MARK
//	   } 
//	  else
//	     ds_1.DeleteRow(ds_1.RowPosition)  
 }
//---------------------------------------------------------------------------
function btnsave_onclick()                       // 저장
//---------------------------------------------------------------------------
{
//var ls_chk=0
//	if (ds_1.IsUpdated){
//	   if  (confirm("변경되었습니다 저장하시겠습니까?")){
//     		tr_1.Post()
//	   }
// 	} 
}
//----------------------------------------------------------------------------
function btncancel_onclick()                     // 취소
//---------------------------------------------------------------------------- 
{
	ds_1.Undo(ds_1.RowPosition)
}
//----------------------------------------------------------------
function gd_1_request()                   //요청자료조회
//----------------------------------------------------------------
{
		is_class = "2"
	   gd_1.format = is_format_1             
	   bt_sungin.style.visibility="visible"	
	btnquery_onclick()
}
//----------------------------------------------------------------
function gd_1_approve()                   //승인자료조회
//----------------------------------------------------------------
{
		is_class = "6"
	   gd_1.format = is_format_2             
	   bt_sungin.style.visibility="hidden"	
	   	
	btnquery_onclick()
}
//----------------------------------------------------------------
function gd_1_approve_sbc()                   //계약요청자료조회
//----------------------------------------------------------------
{
		is_class = "3"
	   gd_1.format = is_format_2             
	   bt_sungin.style.visibility="hidden"	
	   	
	btnquery_onclick()
}
//----------------------------------------------------------------
function request_cancel()                   //요청취소
//----------------------------------------------------------------
{
	var ls_approve_class,ls_dept_code,li_order_number,li_chg_degree,ll_row
	
	if (ds_1.RowPosition < 1) return
	
	ll_row = ds_1.RowPosition
	
	ls_approve_class = ds_1.NameValue(ll_row,"approve_class")
	
	if (ls_approve_class != '2') {
		alert('요청자료가 아니어서 취소할 수 없습니다...')
		return
	}
	
	ls_dept_code = ds_1.NameValue(ll_row,"dept_code")
	li_order_number = ds_1.NameValue(ll_row,"order_number")
	li_chg_degree    = ds_1.NameValue(ll_row,"chg_degree")

	if  (confirm("취소처리를 계속하시겠습니까?")) {
	   arg_cmd = "UPDATE s_chg_cn_list  " +   
	              "  SET approve_class  = '1', approve_dt = null " + 
	              "  where  dept_code = '" + ls_dept_code + "'  and "   + 
	              "         order_number = " + li_order_number + " and  " +
	              "         chg_degree = " + li_chg_degree
	   f_update_sql(arg_cmd)
		btnquery_onclick()
		alert('정상처리되었습니다...')
	}
}
//----------------------------------------------------------------
function approve_cancel()                   //승인취소
//----------------------------------------------------------------
{
	var ls_approve_class,ls_dept_code,li_order_number,li_chg_degree,ll_row,ls_ebid_yn,ll_cnt,ll_chk
	
	if (ds_1.RowPosition < 1) return
	
	ll_row = ds_1.RowPosition
	
	ls_approve_class = ds_1.NameValue(ll_row,"approve_class")
	ls_ebid_yn       = ds_1.NameValue(ll_row,"ebid_yn")

	
	if (ls_approve_class != '6' && ls_approve_class != '3') {
		alert('승인자료가 아니어서 취소할 수 없습니다...')
		return
	}
	
	if (ls_ebid_yn == '1') {
		if (ls_approve_class != '3') {
			alert('전자계약자료는 취소할 수 없습니다...')
			return
		}
	}

	ls_dept_code = ds_1.NameValue(ll_row,"dept_code")
	li_order_number = ds_1.NameValue(ll_row,"order_number")
	li_chg_degree    = ds_1.NameValue(ll_row,"chg_degree")
	if (li_chg_degree > 1) {
		alert('변경계약일 경우 승인취소를 할 수 없습니다...')
		return
	}

	ll_cnt = f_select1_q("select nvl(count(*),0) select_1 " +
							   "  from s_pay " +
							   " where dept_code = '" + ls_dept_code + "'" +
	                     "   and order_number = " + li_order_number ) //기성자료존재여부
	if (ds_select1.ErrorCode != 0) {alert("에러발행");return;}
	if (ll_cnt > 0){
		ll_chk = ds_select1.NameValue(ds_select1.RowPosition,'select_1')
		if (ll_chk > 0) {
			alert('이미 기성자료가 존재하여 승인취소할 수 없습니다...')
			return
		}
	}

	ll_cnt = f_select1_q("select nvl(count(*),0) select_1 " +
							   "  from s_chg_cn_list " +
							   " where dept_code = '" + ls_dept_code + "'" +
	                     "   and order_number = " + li_order_number +
						 "   and chg_degree > 1") //변경계약존재여부
	if (ds_select1.ErrorCode != 0) {alert("에러발행");return;}
	if (ll_cnt > 0){
		ll_chk = ds_select1.NameValue(ds_select1.RowPosition,'select_1')
		if (ll_chk > 0) {
			alert('변경계약이 존재하여 승인취소할 수 없습니다...')
			return
		}
	}

	if  (confirm("취소처리를 계속하시겠습니까?")) {
	   arg_cmd =  " delete from s_cn_detail where dept_code = '" + ls_dept_code + "'" +
	   			  "         and order_number = " + li_order_number +
	   			  "@ delete from s_cn_parent where dept_code = '" + ls_dept_code + "'" +
	   			  "         and order_number = " + li_order_number +
	   			  "@ delete from s_cn_list where dept_code = '" + ls_dept_code + "'" +
	   			  "         and order_number = " + li_order_number +
	              "@ UPDATE s_chg_cn_list  " +   
	              "  SET approve_class  = '2', approve_dt = null " + 
	              "  where  dept_code = '" + ls_dept_code + "'  and "   + 
	              "         order_number = " + li_order_number + " and  " +
	              "         chg_degree = " + li_chg_degree

	   f_update_sql_multy(arg_cmd)
		btnquery_onclick()
		alert('정상처리되었습니다...')
	}
}
//----------------------------------------------------------------------------
function btnexit_onclick(ls_arg)                 // 종료 
//-----------------------------------------------------------------------------

{
	if (ds_1.IsUpdated) {
	   if  (confirm("변경되었습니다 저장하시겠습니까?")) 
	       {  //저장 routine
	       }   
 
}     
top.frames['main_ct'].location.href(ls_arg)
top.frames['main_title'].div_r.style.visibility="hidden"             
top.frames['main_title'].div_u.style.visibility="hidden"             

// top.frames['main_ct'].window.close()     
}
//------------------------------------------------------------------------
function keyDown()                       //검색어 입력후 enter를 쳤을경우
//------------------------------------------------------------------------
{
	if (window.event.keyCode == 13) { 
		dept_search();
	} 
}
//---------------------------------------------------------------------------
function chg_budget()                        //내역 들어가기 
//---------------------------------------------------------------------------
{
   if (ds_1.RowPosition < 1) { 
      alert("선택한 내역이 없기때문에 들어갈수 없습니다")
      return
   }   

   ls_data = ds_1.NameValue(ds_1.RowPosition,"dept_code") + "@" + ds_1.NameValue(ds_1.RowPosition,"long_name") + "@" + 
             ds_1.NameValue(ds_1.RowPosition,"order_number") + "@" + 
             ds_1.NameValue(ds_1.RowPosition,"chg_degree") + "@" + gs_home + "/const/s_web/03/s_sbc_approve_process_1h.html"
	makeCookie("@s_chg_cn_list_ret@",ls_data)
	top.frames['main_ct'].location.href(gs_home + "/const/s_web/03/s_chg_cn_list_1h.html" +"?"+'u')
}
//-------------------------------------------------------------------------------
function sp_call()                  //Stored Procedure Call 
//--------------------------------------------------------------------------------
{
	var ls_dept_code,li_order_number,li_chg_degree,ls_ebid_yn,arg_cmd
	
	if (is_class !=  "2") {
		alert("요청자료만 승인처리 가능합니다")
		return
	}
	ll_row = ds_1.RowPosition
	if (ll_row < 1) {
		alert("승인할 자료를 선택하시오")
		return
	}
	ls_dept_code = ds_1.NameValue(ll_row,"dept_code")
	li_order_number = ds_1.NameValue(ll_row,"order_number")
	li_chg_degree    = ds_1.NameValue(ll_row,"chg_degree")
	ls_ebid_yn       = ds_1.NameValue(ll_row,"ebid_yn")

	ll_cnt = f_select1_q("SELECT f_cn_list_chk('" + ls_dept_code + "'," + li_order_number + "," + li_chg_degree + ") select_1 from dual")
	if (ds_select1.ErrorCode != 0 || ll_cnt == 0) {alert("에러발생");alert(ds_select1.ErrorMsg);return;}
	if (ds_select1.NameValue(ds_select1.RowPosition,'select_1') > 1) {
		//1은 정상적인 에러임 (계약요청시 작성중 체크) 계약완료시기 때문에 작성중인 계약은 없음
		alert(ds_select1.NameValue(ds_select1.RowPosition,'select_1'))
		alert("계약금액과 계약내역금액 합계가 틀립니다. 확인해주세요");return;
	}

	ll_cnt = f_select1_q("SELECT nvl(count(*),0) select_1 FROM S_PAY A, " +
	                     "   	(SELECT a.DEPT_CODE, a.ORDER_NUMBER, a.YYMM, MAX(a.SEQ) SEQ  " +
								"        FROM S_PAY a, " +
           					"             (select dept_code,order_number,max(yymm) yymm " +
              				"                from s_pay " +
            				"       group by dept_code,order_number) b " +
    							" WHERE a.dept_code = b.dept_code " +
      						"   AND a.order_number = b.order_number " +
      						"   AND a.yymm = b.yymm " +
  								"GROUP BY a.DEPT_CODE, a.ORDER_NUMBER) B " +
						 " WHERE A.DEPT_CODE = B.DEPT_CODE AND A.ORDER_NUMBER = B.ORDER_NUMBER AND A.YYMM = B.YYMM AND A.SEQ = B.SEQ " +
						 " AND A.INVOICE_NUM is null  " +
						 "AND A.DEPT_CODE = '" + ls_dept_code + "' AND A.ORDER_NUMBER = " + li_order_number)
	if (ds_select1.ErrorCode != 0 || ll_cnt == 0) {alert("에러발생");alert(ds_select1.ErrorMsg);return;}
	if (ds_select1.NameValue(ds_select1.RowPosition,'select_1') > 1) {
		alert("기성작성중인 자료가 존재합니다. 현장에 확인해 주세요");return;
	}

	if  (confirm("승인처리를 계속하시겠습니까?")) {
		if (ls_ebid_yn == 2) {		
			ds_spcall.DataID = 's_sbc_approve_procedure.jsp?arg_dept_code=' + ls_dept_code + 
																		'&arg_order_number=' + li_order_number + 
																		'&arg_chg_degree=' + li_chg_degree
			ds_spcall.SyncLoad = true
			ds_spcall.reset()
		}
		else {
		   arg_cmd = "UPDATE s_chg_cn_list  " +   
		              "  SET approve_class  = '3', approve_dt = sysdate " + 
		              "  where  dept_code = '" + ls_dept_code + "'  and "   + 
		              "         order_number = " + li_order_number + " and  " +
		              "         chg_degree = " + li_chg_degree
		   f_update_sql(arg_cmd)
		}
		btnquery_onclick()
		alert("정상처리되었습니다...")
	}
}
//------------------------------------------------------------------------
function sbcr_keyDown()                       //검색어 입력후 enter를 쳤을경우
//------------------------------------------------------------------------
{
	if (window.event.keyCode == 13) { 
		sbcr_search();
	} 
}

//--------------------------------------------------------------------------
function   sbcr_search()
//----------------------------------------------------------------
{
	if (tx_sbcr_search_name.value == '') {
		is_sbcr_name = ''
	}
	else {
		is_sbcr_name = tx_sbcr_search_name.value
	}
	btnquery_onclick()
}
//---------------------------------------------------------------------
function wbs_search()                     //전문 공종 찾기 
//---------------------------------------------------------------------
{
	var result;
	var array = new Array();
	result = window.showModalDialog(gs_home + "/const/s_web/00/s_profession_wbs_search_1h.html", tx_wbs_name.value,"dialogWidth:600px;dialogHeight:500px");
	if(result == "") return;

	array = result.split("@");
	tx_wbs_name.value = array[1]
	btnquery_onclick()
}
//---------------------------------------------------------------------------
function f_set_resize()
//---------------------------------------------------------------------------
{
	var objArr = new Array('gd_1');
	var xArr   = new Array(true);
	var yArr   = new Array(true);

	f_reSize(objArr, xArr, yArr);
}  
//---------------------------------------------------------------------------
function window_onload()                      // window open event
//---------------------------------------------------------------------------
{
  if (f_reject_window()) return 
   top.frames['main_title'].mouse_over()
   top.frames['main_title'].title_name.value = " " + "계약승인처리"  

 ll_cnt = f_select_q("select etc_code select_1, child_name select_2  from z_code_etc_child where class_tag = '022' order by etc_code") //승인구분
	tr_1.Action = is_tr_1_addr 
        top.frames['main_title'].div_r.style.visibility="visible"
        top.frames['main_title'].div_u.style.visibility="hidden"
        gd_1.format = is_format_1 

 ll_cnt = f_ds_select_q('ds_sysdate',"select to_char(trunc(add_months(sysdate,0),'mm'),'yyyymmdd') select_1 from dual")
 em_from_date.text = ds_sysdate.NameValue(1,'select_1')
// ll_cnt = f_ds_select_q('ds_sysdate',"select to_char(add_months(sysdate,-1) + 25,'yyyymmdd') select_1 from dual")
 ll_cnt = f_ds_select_q('ds_sysdate',"select sysdate select_1 from dual")
 em_to_date.text = ds_sysdate.NameValue(1,'select_1')
        
 btnquery_onclick()
}
</SCRIPT>

<!-- ======================================================================= -->
<!--                                   Event                                 -->
<!-- ======================================================================= -->
<SCRIPT language=JavaScript for=ds_1 event=OnLoadError()>
  alert("Error Code : " + ds_1.ErrorCode + "\n" + "Error Message : " + ds_1.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_spcall event=OnLoadError()>
  alert("Error Code : " + ds_spcall.ErrorCode + "\n" + "Error Message : " + ds_spcall.ErrorMsg + "\n");
</SCRIPT>

<SCRIPT language=JavaScript for=tr_1 event=OnFail()>
  alert("Error Code : " + tr_1.ErrorCode + "\n" + "Error Message : " + tr_1.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_update event=OnLoadError()>
  alert("Error Code(ds_update) : " + ds_update.ErrorCode + "\n" + "Error Message : " + ds_update.ErrorMsg + "\n");
</SCRIPT>

<script language=JavaScript for=gd_1 event=OnKeyPress(kcode)>
if (kcode == 13) {
    if (ds_1.RowPosition == ds_1.CountRow)  
        btnadd_onclick()
    else     
        ds_1.RowPosition++
}
</SCRIPT>
<SCRIPT language=JavaScript for=gd_1 event=OnDblClick(row,colid)>
ds_1.RowPosition=row
chg_budget()
</SCRIPT>
<SCRIPT language=JavaScript event=OnSelChanged(nIndex) for=tb_1>
  if (nIndex == 1 ) {
		gd_1_request()
	}
	else{
		gd_1_approve()	
	}
</SCRIPT>

<!-- ======================================================================= -->
<!--                                 Component                               -->
<!-- ======================================================================= -->
<Object id=ds_select
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49> </OBJECT>
 <Object id=ds_sysdate
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49> </OBJECT>
 <Object id=ds_select1
      style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
      classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49> </OBJECT>
<OBJECT id=ds_1 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49></OBJECT>
<OBJECT id=ds_spcall 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49>
</OBJECT>
<OBJECT id=ds_update 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49>
</OBJECT>

<OBJECT id=tr_1 
    classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
   <PARAM NAME="Action" VALUE="">
	<PARAM NAME="KeyName" VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:y_approve_process_1tr=ds_1)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT>	

</HEAD>

<!-- ======================================================================= -->
<!--                                   Body                                  -->
<!-- ======================================================================= -->
<BODY style="FONT-SIZE: 12px; margin: 0px;" onload=setTimeout('window_onload()',1) oncontextmenu="return false" >
 <div class=main_div> 
<table border="0" width="100%" height="100%" cellspacing="0">
	<tr height="40px">
		<td class=td_green>
			<table border="0" cellspacing="0" cellpadding="0" class=main_table>
				<tr height="25px">
					<td width="15px"><img src="../../../image/bullet3.gif"></td>
					<td width="43px" class=font_green_bold align="center">현장명</td>
					<td width="166px">
						<INPUT style="FONT-SIZE:12px;" id=dept_name  ondblclick="dept_name.select()" onfocus="dept_name.select()"   style="ime-mode:active"   style=" FONT-SIZE: 12px" style="ime-mode:active " size=25 onkeyDown="keyDown()"></td>
					<td width="70px">
						<INPUT  type=button  class="img_btnFind"  value=검색 onclick=dept_search() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"></td>
					<td width="60px">&nbsp;</td>
					<td width="15px"><img src="../../../image/bullet3.gif"></td>
					<td width="54px" class=font_green_bold align="center">기&nbsp;&nbsp;&nbsp;&nbsp;간</td>
					<td width="80px">
						<comment id="__NSID__"><OBJECT id=em_from_date  
                   style="WIDTH: 75px; background: white;"
			          classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
			   			  <PARAM NAME="Alignment" VALUE="1">
					        <param name=Format value="YYYY-MM-DD">
		                 <param name=ReadOnly   value=false>
		                 <param name=Numeric value=false></OBJECT></comment> <script> __ws__(__NSID__);</script> </td>
		         <td width="20px" align="center">~</td>
	            <td width="80px">
	            	<comment id="__NSID__"><OBJECT id=em_to_date 
                   style="WIDTH: 75px; background: white;"
			          classid=clsid:E6876E99-7C28-43AD-9088-315DC302C05F VIEWASTEXT>
			   			  <PARAM NAME="Alignment" VALUE="1">
					        <param name=Format value="YYYY-MM-DD">
		                 <param name=ReadOnly   value=false>
		                 <param name=Numeric value=false></OBJECT></comment> <script> __ws__(__NSID__);</script></td>
		         <td width="*" align="right">
		         	<INPUT  type=button  class="img_btn4_1"  value=요청취소 onclick=request_cancel() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;">
						<INPUT  id=bt_sungin type=button  class="img_btn4_1"  value=승인처리 onclick=sp_call() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;">
						<INPUT  type=button  class="img_btn4_1"  value=승인취소 onclick=approve_cancel() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"> &nbsp;&nbsp;
					</td>
				</tr>
				<tr height="25px">
					<td width="15px"><img src="../../../image/bullet3.gif"></td>
					<td width="43px" class=font_green_bold align="center">업&nbsp;&nbsp;체</td>
					<td width="166px">
						<INPUT style="FONT-SIZE:12px;" id=tx_sbcr_search_name   size=25 onchange="sbcr_search()"  onkeyDown="sbcr_keyDown()" >
					</td>
					<td width="70px">
						<INPUT  id=bt_sbcr_name type=button  class="img_btnFind"  value=검색 onclick=sbcr_search() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"></td>
					<td width="60px">&nbsp;</td>
					<td width="15px"><img src="../../../image/bullet3.gif"></td>
					<td width="54px" class=font_green_bold align="center">발주공종</td>
					<td width="180px" colspan=3 >
						<INPUT style="FONT-SIZE:12px;" id=tx_wbs_name size=10>
		 				<INPUT  id=bt_profession_wbs_code type=button  class="img_btnFind"  value=검색 onclick=wbs_search() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;">
					</td>
					<td  width="*" align="right">
						<INPUT  type=button  class="img_btn6_1"  value=계약사항보기 onclick=chg_budget() onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"> &nbsp;&nbsp;
					</td>
	         </tr>                 
	      </table>
	   </td>
	</tr>
	<tr height="*">
		<td>
			<table border="0" width="100%" height="100%" cellspacing="0" cellpadding="0">
				<tr height="20px">
					<td>
						<comment id="__NSID__"><OBJECT id=tb_1 
							style="FONT-SIZE: 12px; Z-INDEX: 200; WIDTH: 100%; HEIGHT: 100%" 
							classid=clsid:ED382953-E907-11D3-B694-006097AD7252 VIEWASTEXT>
								<param name="BackColor"  value="#BBE0F4">
								<param name="TextColor"  value="BLACK">
								<PARAM NAME="Format" VALUE="
									<T>divid=tab_page_1 title=요청자료</T>
									<T>divid=tab_page_2 title=승인자료</T>
								">
						</OBJECT></comment> <script> __ws__(__NSID__);</script>
					</td>
				</tr>
				<tr height="*">
					<td>
						<comment id="__NSID__"><OBJECT id=gd_1 
						    style="FONT-SIZE: 12px; Z-INDEX: 102;  WIDTH: 100%; POSITION: absolute; HEIGHT:100%;" 
						    classid=clsid:1F57AEAD-DB12-11D2-A4F9-00608CEBEE49>
							<PARAM NAME="MultiRowSelect" VALUE="0">
							<PARAM NAME="AutoInsert" VALUE="0">
						   <PARAM NAME="BorderStyle"  VALUE=1>
							<PARAM NAME="AllShowEdit" VALUE="0">
							<PARAM NAME="Editable" VALUE="0">
							<PARAM NAME="ColSizing" VALUE="-1">
							<PARAM NAME="DataID" VALUE="ds_1"></OBJECT></comment> <script> __ws__(__NSID__);</script>
					</td>
				</tr>
			</table>
		</td>
	</tr>
</table></div>
</BODY></HTML>
