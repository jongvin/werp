<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- **************************************************************	-->
<!-- 1. 프로그램 id   : v_waster_matter_input_1h.html						-->
<!-- 2. 유형(시나리오): 															-->
<!-- 3. 기 능 정 의   : 		      											-->
<!-- 4. 변 경 이 력   : 황보은영 작성											-->
<!-- 5. 관련프로그램  :																-->
<!-- 6. 특 기 사 항   :																-->
<!-- **************************************************************	-->
<HTML><HEAD>
<META http-equiv=Content-Type content="text/html; charset=ks_c_5601-1987">
<META content="MSHTML 6.00.2716.2200" name=GENERATOR>
<LINK rel="stylesheet" type="text/css" href="../../../erpw.css">
<SCRIPT SRC="../../../comm_function/comm_calendar.js"></SCRIPT> 
<SCRIPT SRC="../../../comm_function/comm_function.js"></SCRIPT> 
<SCRIPT SRC="../../../comm_function/comm_wid.js"></SCRIPT>
<SCRIPT language=JavaScript>
var gs_home = top.frames['security'].gs_home.value
var is_dept_code = top.frames['security'].gs_dept_code.value
var is_dept_name = top.frames['security'].gs_dept_name.value

var is_ds_1_addr = gs_home + '/const/v_web/06/v_waste_matter_master_1q.jsp?arg_dept_code='
var is_ds_2_addr = gs_home + '/const/v_web/06/v_waste_matter_input_1q.jsp?arg_dept_code='
var is_tr_1_addr = gs_home + '/const/v_web/06/v_waste_matter_master_1tr.jsp'
var is_tr_2_addr = gs_home + '/const/v_web/06/v_waste_matter_input_1tr.jsp'

var arg_search = ""
var il_focus = 1
var check_save = 0
</SCRIPT>
<!-- ======================================================================= -->
<!--                                 Function                                -->
<!-- ======================================================================= -->
<SCRIPT language=JavaScript>
//------------------------------------------------------------------------
function btnquery_onclick()                     // 조회  
//------------------------------------------------------------------------
{
	ds_1.DataID = is_ds_1_addr + is_dept_code
 	ds_1.SyncLoad = true
 	ds_1.Reset()
 	
}
//------------------------------------------------------------------------
function div_btnquery_onclick()                     // 조회  
//------------------------------------------------------------------------
{
	ds_2.DataID = is_ds_2_addr + arg_search
 	ds_2.SyncLoad = true
 	ds_2.Reset()
}
//-----------------------------------------------------------------------
function init_move()                            // 초기값세팅
//-----------------------------------------------------------------------
{
	ds_1.NameValue(ds_1.RowPosition, "dept_code") = is_dept_code
}
//-----------------------------------------------------------------------
function div_init_move()                            // 초기값세팅
//-----------------------------------------------------------------------
{
	check_save = check_save + 1
	ds_2.NameValue(ds_2.RowPosition, "dept_code") = ds_1.NameValue(ds_1.RowPosition, "dept_code")
	ds_2.NameValue(ds_2.RowPosition, "waste_matter_code") = ds_1.NameValue(ds_1.RowPosition, "waste_matter_code")
	if (check_save == 1) {
		ll_cnt = f_ds_select_q("ds_seq", "select decode(max(seq),null,1,max(seq)+1) select_1 from v_waste_matter where dept_code='" + is_dept_code + "' and waste_matter_code='" + ds_1.NameValue(ds_1.RowPosition, "waste_matter_code") + "' order by seq desc")
		ds_2.NameValue(ds_2.RowPosition, "seq") = ds_seq.NameValue(1, "select_1")
	}
	else
		ds_2.NameValue(ds_2.RowPosition, "seq") = ds_2.NameValue(ds_2.CountRow - 1, "seq") + 1
}
//------------------------------------------------------------------------
function get_focus(focus) // gd가 포커스를 받을때 동작.
//------------------------------------------------------------------------
{
	il_focus = focus
}
//-----------------------------------------------------------------------
function btnadd_onclick()                       // 추가 
//------------------------------------------------------------------------
{
	if (il_focus == 1) {
		if (ds_2.IsUpdated) {
			alert("내역이 변경되었습니다: 저장하시기 바랍니다")
			return
		}
		ds_1.AddRow()
		init_move()
	}
	else
		div_btnadd_onclick()
}
//-----------------------------------------------------------------------
function div_btnadd_onclick()                       // 추가 
//------------------------------------------------------------------------
{
	if (il_focus == 2) {
		if (ds_1.IsUpdated) {
			alert("폐기물종류가 변경되었습니다: 저장하시기 바랍니다")
			return
		}
		
	   if ( ds_1.CountRow < 1  ) return ;
	
		ds_2.AddRow()
		div_init_move()
		gd_2.SetColumn("gen_dt")
	}
}
//-----------------------------------------------------------------------
function btninsert_onclick()                    // 삽입
//-----------------------------------------------------------------------
{
	if (il_focus == 1)
		ds_1.InsertRow(ds_1.RowPosition)
	if (il_focus == 2) 
		ds_2.InsertRow(ds_2.RowPosition)
}

//------------------------------------------------------------------------
function btndelete_onclick()                    // 삭제 
//------------------------------------------------------------------------
{
	if (il_focus == 1) {
		if (ds_2.CountRow > 0) {
			alert("해당 폐기물의 내역이 존재하므로 삭제는 불가능합니다")
			return
		}
		else {
			if (confirm("삭제하시겠습니까?"))
				ds_1.DeleteRow(ds_1.RowPosition)
		}
			
	}
	if (il_focus == 2) {
		if (confirm("삭제하시겠습니까?"))
			ds_2.DeleteRow(ds_2.RowPosition)
	}
}

//---------------------------------------------------------------------------
function btnsave_onclick()                       // 저장
//---------------------------------------------------------------------------
{
if (ds_1.IsUpdated || ds_2.IsUpdated )
{
	if (confirm("변경되었습니다 저장하시겠습니까?")) 
	{
			if (ds_1.IsUpdated) 
			{
				var ll_dup
				ll_dup = f_dup_chk("ds_1","waste_matter_code")
				if (ll_dup > 0) {
				  alert("이미 등록된 폐기물종류가 있습니다: 수정하십시요 ")
				  ds_1.RowPosition = ll_dup
				  return
				}
				tr_1.Post()
			}


   		if (ds_2.IsUpdated) 
   		{
			   for ( i = 0 ; i <= ds_2.CountRow ; i++ )
				{
					if (f_check_date(ds_2.NameValue(i,"gen_dt")) == false)
					{
						alert("유효하지 않는 발생내역 일자입니다.")
						gd_2.focus()
						gd_2.SetColumn("gen_dt")
						ds_2.RowPosition = i
						return
					}
					if ((f_check_date(ds_2.NameValue(i,"self_disp_dt"))== false ) &&(ds_2.NameValue(i,"self_disp_dt")> ''))
					{
						alert("유효하지 않는 자가처리내역 일자입니다.")
						gd_2.focus()
						gd_2.SetColumn("self_disp_dt")
						ds_2.RowPosition = i
						return
					}
				   if ((f_check_date(ds_2.NameValue(i, "commit_dt"))== false) &&(ds_2.NameValue(i,"commit_dt")> ''))
					{
						alert("유효하지 않는 위탁처리내역 일자입니다.")
						gd_2.focus()
						gd_2.SetColumn("commit_dt")
						ds_2.RowPosition = i
						return
					}
				}
	          tr_2.Post()
		      check_save = 0
		   }

	}	
}
}
//------------------------------------------------------------------------
function keyDown()                       //검색어 입력후 enter를 쳤을경우
//------------------------------------------------------------------------
{
	if (window.event.keyCode == 13)
		dept_code_find()
}
//---------------------------------------------------------------------------
function dept_code_find()                       //현장 찾기 
//---------------------------------------------------------------------------
{
	result = f_dept_code_find(dept_name.value)
	if (result==false)return
	
	is_dept_code = top.frames['security'].gs_dept_code.value
	is_dept_name = top.frames['security'].gs_dept_name.value

	dept_name.value = is_dept_name

	btnquery_onclick()
} 
//----------------------------------------------------------------------------
function btncancel_onclick()                     // 취소
//---------------------------------------------------------------------------- 
{
	if (il_focus == 1) 
		ds_1.Undo(ds_1.RowPosition)
	if (il_focus == 2) 
		ds_2.Undo(ds_2.RowPosition)
}

//----------------------------------------------------------------------------
function btnexit_onclick(ls_arg)                 // 종료 
//-----------------------------------------------------------------------------
{
}

//---------------------------------------------------------------------------
function window_onload()                      // window open event
//---------------------------------------------------------------------------
{
	if (f_reject_window()) return 
 	top.frames['main_title'].mouse_over()
 	
 	is_dept_code = top.frames['security'].gs_dept_code.value
	is_dept_name = top.frames['security'].gs_dept_name.value
	
	dept_name.value = is_dept_name
	
	ds_1.DataID = is_ds_1_addr + is_dept_code
 	ds_1.SyncLoad = true
 	ds_1.Reset()
 	
 	tr_1.Action = is_tr_1_addr
 	tr_2.Action = is_tr_2_addr
 	
 	ll_cnt = f_ds_select_q("ds_waste_code", "select waste_matter_code select_1, waste_matter_name select_2 from v_waste_matter_code where section='1' order by waste_matter_name")
 	ds_waste_code.SyncLoad = true
 	ds_waste_code.Reset()
}
</SCRIPT>

<!-- ======================================================================= -->
<!--                                   Event                                 -->
<!-- ======================================================================= -->
<SCRIPT language=JavaScript for=ds_1 event=OnLoadError()>
  alert("Error Code(ds_1) : " + ds_1.ErrorCode + "\n" + "Error Message : " + ds_1.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_2 event=OnLoadError()>
  alert("Error Code(ds_2) : " + ds_2.ErrorCode + "\n" + "Error Message : " + ds_2.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_waste_code event=OnLoadError()>
  alert("Error Code(ds_waste_code) : " + ds_waste_code.ErrorCode + "\n" + "Error Message : " + ds_waste_code.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_1 event=OnFail()>
  alert("Error Code(tr_1) : " + tr_1.ErrorCode + "\n" + "Error Message : " + tr_1.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=tr_2 event=OnFail()>
  alert("Error Code(tr_2) : " + tr_2.ErrorCode + "\n" + "Error Message : " + tr_2.ErrorMsg + "\n");
</SCRIPT>
<SCRIPT language=JavaScript for=ds_1 event=OnRowPosChanged(row)>
	if (row < 0) return
	
	var w_code = ""
	w_code = ds_1.NameValue(row, "waste_matter_code")	
	arg_search = is_dept_code + "&arg_waste_code=" + w_code	
	div_btnquery_onclick()
	
	if (ds_2.CountRow > 0)
		gd_1.ColumnProp("key_waste_matter_name", "Edit") = 'none'
	else
		gd_1.ColumnProp("key_waste_matter_name", "Edit") = ''
</SCRIPT>
<SCRIPT language=JavaScript for=tr_1 event=OnSuccess()>
	gf_key_copy("ds_1","waste_matter_code@key_waste_matter_code")
</SCRIPT>
<SCRIPT language=JavaScript for=ds_1 event=OnColumnChanged(row,colid)>
	if (row < 0)  return
	if (colid == "key_waste_matter_name") {
		ll_cnt = f_ds_select_q("ds_waste_code", "select waste_matter_code select_1, waste_matter_name select_2 from v_waste_matter_code where section='1' and waste_matter_code='" + ds_1.NameValue(row, "key_waste_matter_name") + "' ")
		ds_1.NameValue(row, "waste_matter_code") = ds_waste_code.NameValue(1, "select_1")
		ds_1.NameValue(row, "waste_matter_name") = ds_waste_code.NameValue(1, "select_2")
	}
</SCRIPT>
<SCRIPT language=JavaScript for=ds_2 event=OnColumnChanged(row,colid)>
	if (colid == "mid_disp_amt" || colid == "fin_disp_amt") {
		ds_2.NameValue(row, "self_disp_amt") = ds_2.NameValue(row, "mid_disp_amt") + ds_2.NameValue(row, "fin_disp_amt")
	}
</SCRIPT>

<!-- ======================================================================= -->
<!--                                 Component                               -->
<!-- ======================================================================= -->
<comment id="__NSID__"><OBJECT id=ds_1 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
</OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=ds_2 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
</OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=ds_seq 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
</OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=ds_waste_code 
    style="Z-INDEX: 100; LEFT: 339px; POSITION: absolute; TOP: 13px" 
    classid=clsid:3267EA0D-B5D8-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
</OBJECT></comment> <script> __ws__(__NSID__);</script>
<comment id="__NSID__"><OBJECT id=tr_1 
    style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
    classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action"   VALUE="">
	<PARAM NAME="KeyName"  VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:v_waste_matter_master_1tr=ds_1)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>
</HEAD>
<comment id="__NSID__"><OBJECT id=tr_2 
    style="Z-INDEX: 103; LEFT: 477px; POSITION: absolute; TOP: 2px" 
    classid=clsid:0A2233AD-E771-11D2-973D-00104B15E56F VIEWASTEXT>
	<PARAM NAME="Action"   VALUE="">
	<PARAM NAME="KeyName"  VALUE="toinb_dataid4">
	<PARAM NAME="KeyValue" VALUE="JSP(I:v_waste_matter_input_1tr=ds_2)">
	<PARAM NAME="Protocol" VALUE="1"></OBJECT></comment> <script> __ws__(__NSID__);</script>
</HEAD>


<!-- ======================================================================= -->
<!--                                   Body                                  -->
<!-- ======================================================================= -->
<BODY style="FONT-SIZE: 12px; margin: 0;"  onload=setTimeout('window_onload()',1) oncontextmenu="return false" >
<div class=main_div>
<table width="100%"  height="100%"  BORDER="0"  CELLSPACING="0"  align="center"   style="FONT-SIZE: 12px; ">
	<tr class=td_green>
		<td colspan=3 height=24 >
			<table width="100%" BORDER="0"  CELLSPACING="0" cellspacing="0" >
				<tr>
               <td width="15"><img src="../../../image/bullet3.gif" align="absmiddle" ></td>
					<td align="left" width="47"  class=font_green_bold >현장명</td>
					<td>
						<table border="0" width="100%" height="100%" cellpadding="0" cellspacing="0">
							<tr>
								<td width="147">
									<INPUT id=dept_name ondblclick="dept_name.select()" onfocus="dept_name.select()" style="ime-mode:active" style=" FONT-SIZE: 12px;" size=22 onkeyDown="keyDown()">
								</td>
								<td>
									<input type="button" value="검색" onclick=dept_code_find() class="img_btnFind" onmouseover="this.style.color=MOUSE_OVER;" onmouseout="this.style.color=MOUSE_OUT;"></td>
							   <td align="right">(단위 : 톤)</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<TR>
		<TD width="18%">
			<comment id="__NSID__"><OBJECT id=gd_1 onfocus="get_focus(1)"
				 style="FONT-SIZE: 12px; Z-INDEX: 100; WIDTH:100%; HEIGHT: 100%" 
				 classid=clsid:1F57AEAD-DB12-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
				<PARAM NAME="MultiRowSelect" VALUE="-1">
				<PARAM NAME="AutoInsert"     VALUE="-1">
				<PARAM NAME="BorderStyle"    VALUE=1>
				<PARAM NAME="AllShowEdit"    VALUE="-1">
				<PARAM NAME="Editable"       VALUE="-1">
				<PARAM NAME="UsingOneClick"  VALUE="1">
				<PARAM NAME="ColSizing"      VALUE="-1">
				<PARAM NAME="DataID"         VALUE="ds_1">
				<PARAM NAME="Format"         VALUE="
					<C> Name='*폐기물 종류'  id=key_waste_matter_name EditStyle=Lookup Data='ds_waste_code:select_1:select_2' width=155  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
				">
			</OBJECT></comment> <script> __ws__(__NSID__);</script>
		</TD>
		<td width="5"></td>
		<TD width="82%">
			<comment id="__NSID__"><OBJECT id=gd_2 onfocus="get_focus(2)"
				 style="FONT-SIZE: 12px; Z-INDEX: 100; WIDTH:100%; HEIGHT: 100%" 
				 classid=clsid:1F57AEAD-DB12-11D2-A4F9-00608CEBEE49 VIEWASTEXT>
				<PARAM NAME="MultiRowSelect" VALUE="-1">
				<PARAM NAME="AutoInsert"     VALUE="-1">
				<PARAM NAME="BorderStyle"    VALUE=1>
				<PARAM NAME="AllShowEdit"    VALUE="-1">
				<PARAM NAME="Editable"       VALUE="-1">
				<PARAM NAME="UsingOneClick"  VALUE="1">
				<PARAM NAME="ColSizing"      VALUE="-1">
				<PARAM NAME="DataID"         VALUE="ds_2">
				<PARAM NAME="Format"         VALUE="
				  <X>	Name='발생 내역' HeadBgColor=#BBE0F4
					  <C> Name='*일자'        id=gen_dt  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK align=center </C>
				     <C> Name='성상'        id=mat_status  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
				     <C> Name='발생량'      id=gen_amt  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
				     <C> Name='발생량누계'  id=tot_amt Edit='none' width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
				  </X>
				  <X> Name='자가처리 내역' HeadBgColor=#BBE0F4
				     <C> Name='일자'        id=self_disp_dt  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK align=center </C>
				     <C> Name='처리량'      id=self_disp_amt Edit='none' width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
				     <G> Name='중간처리' HeadBgColor=#BBE0F4
					     <C> Name='처리방법'    id=mid_disp_method  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
					     <C> Name='처리량'      id=mid_disp_amt  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
					  </G>
					  <G> Name='최종처리' HeadBgColor=#BBE0F4
					     <C> Name='처리방법'    id=fin_disp_method  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
					     <C> Name='처리량'      id=fin_disp_amt  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
					  </G>
				     <C> Name='처리량누계'  id=self_tot_amt Edit='none' width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
				  </X>
				  <X> Name='위탁처리 내역' HeadBgColor=#BBE0F4
				     <C> Name='일자'        id=commit_dt  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK align=center </C>
				     <C> Name='위탁처리량'  id=commit_amt  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
				     <C> Name='운반자'      id=commit_carrier  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
				     <C> Name='처리자'      id=commit_disp  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
				     <C> Name='처리방법'    id=commit_method  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
				     <C> Name='위탁처리량누계'  id=commit_tot Edit='none' width=85  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
				  </X>
			     <C> Name='보관량'  id=keep_amt  width=70  BgColor={decode(currow-tointeger(currow/2)*2,0,'#F4F2D8',1,'ffffff')}  HeadAlign=Center HeadBgColor=#BBE0F4  HeadColor=BLACK </C>
				">
			</OBJECT></comment> <script> __ws__(__NSID__);</script>
		</TD>
	</TR>
</table>
</div>
</BODY>
</HTML>